(function(){define("modules/clean/account_photo_modal/account_header",["jquery","modules/clean/require_wrapper"],function(e,t){var s,r;return r=t.RequireWrapper,s=function(){function t(){}return t.init=function(t,s,o){return e(t).add(s).on("click",function(e){return e.preventDefault(),r.require(["modules/clean/account_photo_modal/controller"],function(e){return e.show()})}),e(document).on("db:account_photo:photo_set",function(t){return e(s).addClass(o)}),e(document).on("db:account_photo:photo_deleted",function(t){return e(s).removeClass(o)})},t.initialize_module=function(e){return t.init(e.open_modal_button_selector,e.add_photo_link_selector,e.hide_add_photo_link_class)},t}()})}).call(this),function(){define("modules/clean/components/loading_indicator",["external/classnames","external/underscore","external/react","modules/core/accessible_announce","modules/core/i18n"],function(e,t,s,r,o){var n,i,a,l;return a=o._,l=s.DOM,i={DOTS:"dots",SPINNER:"spinner",BLUE_SPINNER:"blue_spinner"},n=s.createClass({displayName:"LoadingIndicator",statics:{LoadingIndicatorStyle:i},propTypes:{style:s.PropTypes.oneOf(t.values(i)),className:s.PropTypes.string,startMessage:s.PropTypes.string,finishMessage:s.PropTypes.string,shouldAnnounceMessage:s.PropTypes.bool},getDefaultProps:function(){return{style:i.DOTS,className:"",startMessage:a("Loading…"),finishMessage:null,shouldAnnounceMessage:!0}},componentDidMount:function(){return this.props.shouldAnnounceMessage?r.polite(this.props.startMessage):void 0},componentWillUnmount:function(){return this.props.finishMessage&&this.props.shouldAnnounceMessage?r.polite(this.props.finishMessage):void 0},render:function(){var s;return s={},this.props.className&&(s=t.object(this.props.className.split(" ").map(function(e){return[e,!0]}))),s=t.extend(s,{"c-loader":!0,"c-loader--spinner":this.props.style===i.SPINNER,"c-loader--spinner--blue":this.props.style===i.BLUE_SPINNER}),l.div({className:e(s)},this.props.startMessage)}})})}.call(this),function(){define("modules/clean/dropbox_nav",["jquery","modules/clean/analytics","modules/clean/photos/photos_engagement_logger"],function(e,t,s){var r;return r=function(){function r(){e(".carousel-nav-item").click(function(e){return function(){return e.log_click("carousel_nav_link_click")}}(this)),e(".composer-nav-item").click(function(e){return function(){return e.log_click("composer_nav_link_click")}}(this)),e(".mailbox-nav-item").click(function(e){return function(){return e.log_click("mailbox_nav_link_click")}}(this)),e(".carousel-nav-item").click(function(){return s.log_and_send(s.CAROUSEL_NAV_LINK_CLICK)}),e(".photos-nav-item").click(function(){return s.log_and_send(s.PHOTOS_NAV_LINK_CLICK)})}return r.prototype.log_click=function(e){return t.WebMiscActivityLogger.log(e)},r}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/growth/admin_console_ad",["jquery","modules/clean/analytics","modules/clean/dbmodal","modules/core/browser"],function(t,s,r,o){var n;return n=function(){function n(s,o,n){this.cta_selector=n,this._handleLinkClick=e(this._handleLinkClick,this),this.modal=new r.DBModal({element_id:o}),t(s).click(this._handleLinkClick)}return n.prototype._handleLinkClick=function(e){return e.preventDefault(),s.TeamsWebActionsLogger.log("click_admin_console_ad"),this.modal.show(),t(this.cta_selector).off(),t(this.cta_selector).click(this._handleCTAClick)},n.prototype._handleCTAClick=function(e){var r;return e.preventDefault(),r=t(e.target).attr("href"),s.TeamsWebActionsLogger.log("click_admin_console_ad_cta",{},function(){return o.redirect(r)})},n}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function r(){this.constructor=e}for(var o in t)s.call(t,o)&&(e[o]=t[o]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},s={}.hasOwnProperty;define("modules/clean/legacy_pyxl_controllers/bubble_menu",["jquery","modules/clean/keycode","modules/clean/legacy_pyxl_controllers/bubble_dropdown"],function(s,r,o){var n;return n=function(o){function n(t,s,r,o){this.$root=t,this.arrow_direction=s,this.show_on_hover=r,this.top_adjustment=null!=o?o:0,this.onKeyDown=e(this.onKeyDown,this),this.onMouseEnter=e(this.onMouseEnter,this),this.$target=this.$root.find(".bubble-dropdown-target"),this.$target.on("keydown",this.onKeyDown),this.$menu=this.$root.find('*[role="menu"]'),this.$menuitems=this.$root.find('*[role="menuitem"]'),this.$menuitems.attr("role","menuitem"),this.$menuitems.on("keydown",this.onKeyDown),this.$menuitems.on("mouseenter",this.onMouseEnter),n.__super__.constructor.apply(this,arguments)}return t(n,o),n.prototype.focusPrevious=function(e){var t;return t=this.$menuitems.index(e),t=-1===t||0===t?this.$menuitems.length-1:t-1,this.$menuitems.get(t).focus()},n.prototype.focusNext=function(e){var t;return t=this.$menuitems.index(e),t=-1===t||t===this.$menuitems.length-1?0:t+1,this.$menuitems.get(t).focus()},n.prototype.onMouseEnter=function(e){return s(this.$menu).removeClass("bubble-menu--keyboard")},n.prototype.onKeyDown=function(e){return s(this.$menu).addClass("bubble-menu--keyboard"),e.keyCode===r.DOWN?(this.focusNext(e.target),e.stopPropagation(),e.preventDefault()):e.keyCode===r.UP?(this.focusPrevious(e.target),e.stopPropagation(),e.preventDefault()):void 0},n}(o)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function r(){this.constructor=e}for(var o in t)s.call(t,o)&&(e[o]=t[o]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},s={}.hasOwnProperty;define("modules/clean/legacy_pyxl_controllers/form",["jquery","modules/core/cookies","modules/constants/request"],function(s,r,o){var n,i;return n=function(){function t(t,r){this.submit=e(this.submit,this),this.form=s("#"+t),this.form.on("submit",this.submit),this.csrfTokenInputName=r}return t.prototype.submit=function(e){var t;return t=r.read(o.JS_CSRF_COOKIE),t?this.form.find("input[name='"+this.csrfTokenInputName+"']").val(t):void 0},t}(),i=function(s){function r(t,s){this.submit=e(this.submit,this),r.__super__.constructor.call(this,t),this.submitted=!1}return t(r,s),r.prototype.submit=function(e){return r.__super__.submit.call(this,e),this.submitted?(e.preventDefault(),!1):(this.submitted=!0,this.form.addClass("submitted"),setTimeout(function(e){return function(){return e.submitted=!1,e.form.removeClass("submitted")}}(this),2e3))},r}(n),{Form:n,SubmitOnceForm:i}})}.call(this),function(){define("modules/clean/payments/pro_trial_onboarding_tour",["jquery","modules/clean/react/pro/pro_onboarding_tour_modal"],function(e,t){var s,r;return s=t.ProOnboardingTourModal,r=function(){function e(e,t,r,o,n){this.$container=e,this.modal_autoshow=t,this.modal_id=r,this.modal_paths=o,this.modal_content=n,this.tourProps={modalId:this.modal_id,onboardingPaths:this.modal_paths,contentSource:this.modal_content},this.modal_autoshow&&s.renderWithProps(this.tourProps),this._listen()}return e.prototype._listen=function(){return this.$container.find(".start-tour").on("click",function(e){return function(t){return t.preventDefault(),s.renderWithProps(e.tourProps)}}(this))},e}(),{ProTrialOnboardingTourHeaderLink:r}})}.call(this),function(){define("modules/clean/photos/photos_engagement_logger",["jquery","modules/clean/ajax"],function(e,t){var s;return s=function(){function s(){}return s.Platform={WEB:"web",WEB_CAROUSEL:"web_carousel"},s.CAROUSEL_NAV_LINK_CLICK="carousel_nav_link_click",s.PHOTOS_NAV_LINK_CLICK="photos_nav_link_click",s.WEBAPP_VIEW_TIMELINE="webapp_view_gallery",s.WEBAPP_VIEW_ALBUMS_GRID="webapp_view_albums_grid",s.WEBAPP_VIEW_ALBUM="webapp_view_albums",s.WEBAPP_ACTION_ADD_TO_ALBUM="webapp_action_add_to_album",s.WEBAPP_ACTION_REMOVE_FROM_ALBUM="webapp_action_remove_from_album",s.WEBAPP_ACTION_DOWNLOAD="webapp_action_download",s.WEBAPP_ACTION_SHOW_IN_FOLDER="webapp_action_show_in_folder",s.WEBAPP_ACTION_DELETE="webapp_action_delete",s.WEBAPP_SHOW_EXCLUDE_MODAL="webapp_show_exclude_modal",s.ATTEMPT_EXCLUDE_CU_FOLDER="attempt_exclude_cu_folder",s.ATTEMPT_EXCLUDE_DROPBOX_ROOT="attempt_exclude_dropbox_root",s.WEBAPP_GALLERY_SELECT_EVENT="webapp_gallery_select_event",s.WEBAPP_GALLERY_DESELECT_EVENT="webapp_gallery_deselect_event",s.WEBAPP_GALLERY_SELECT_ITEM="webapp_gallery_select_item",s.WEBAPP_GALLERY_DESELECT_ITEM="webapp_gallery_deselect_item",s.WEBAPP_GALLERY_TIME_FIRST_ITEM="webapp_gallery_time_first_item",s.WEBAPP_GALLERY_TIME_EVENTS_OUTLINE="webapp_gallery_time_events_outline",s.WEBAPP_GALLERY_TIME_FIRST_VISIBLE_EVENTS="webapp_gallery_time_first_visible_events",s.WEBAPP_GALLERY_TIME_FIRST_VISIBLE_THUMBS_BATCH="webapp_gallery_time_first_visible_thumbs_batch",s.WEBAPP_GALLERY_EMPTY="webapp_gallery_empty",s.WEBAPP_GALLERY_CONTEXT_MENU_SHOWN="webapp_gallery_context_menu_shown",s.WEBAPP_LIGHTBOX_OPEN="webapp_lightbox_open",s.WEBAPP_LIGHTBOX_DOWNLOAD="webapp_lightbox_download",s.WEBAPP_LIGHTBOX_SELECT_ITEM="webapp_lightbox_select_item",s.WEBAPP_LIGHTBOX_DESELECT_ITEM="webapp_lightbox_deselect_item",s.WEBAPP_LIGHTBOX_FORWARD="webapp_lightbox_forward",s.WEBAPP_LIGHTBOX_BACK="webapp_lightbox_back",s.WEBAPP_LIGHTBOX_SHARE="webapp_lightbox_share",s.WEBAPP_LIGHTBOX_CLOSE_ICON="webapp_lightbox_close_icon",s.WEBAPP_LIGHTBOX_CLOSE_KEY="webapp_lightbox_close_key",s.WEBAPP_TIMELINE_NAVIGATION_SHOWN="webapp_timeline_navigation_shown",s.WEBAPP_TIMELINE_NAVIGATION_TRACK_CLICKED="webapp_timeline_navigation_track_clicked",s.WEBAPP_TIMELINE_NAVIGATION_SCRUBBER_DRAGGED="webapp_timeline_navigation_scrubber_dragged",s.WEBAPP_SHARE_CART_CANCEL="webapp_share_cart_cancel",s.WEBAPP_SHARE_CART_SHARE="webapp_share_cart_share",s.WEBAPP_SHARE_CART_SHARE_FACEBOOK="webapp_share_cart_share_facebook",s.WEBAPP_SHARE_CART_SHARE_TWITTER="webapp_share_cart_share_twitter",s.WEBAPP_SHARE_CART_ITEM_CLICKED="webapp_share_cart_item_clicked",s.WEBAPP_SHARE_DROPDOWN_SEND_LINK="webapp_share_dropdown_send_link",s.WEBAPP_SHARE_DROPDOWN_SHARED_ALBUM="webapp_share_dropdown_shared_album",s.WEBAPP_OPEN_SHARE_MODAL="webapp_open_share_modal",s.WEBAPP_GALLERY_DELETE_MODAL_CONFIRMED="webapp_gallery_delete_modal_confirmed",s.WEBAPP_GALLERY_DELETE_MODAL_CANCELED="webapp_gallery_delete_modal_canceled",s.WEBAPP_GALLERY_REMOVE_FROM_ALBUM_MODAL_CONFIRMED="webapp_gallery_remove_from_album_modal_confirmed",s.WEBAPP_GALLERY_REMOVE_FROM_ALBUM_MODAL_CANCELED="webapp_gallery_remove_from_album_modal_canceled",s.WEBAPP_SHARE_COMPOSER_LINK="webapp_share_composer_link",s.first_log_sent=!1,s.logs_queued=[],s.HACK_prefix_to_replace=null,s.HACK_prefix_replace_with=null,s.HACK_new_platform=null,s.HACK_extra={},s.hack_all_log_prefixes_and_platform=function(e){var t,r,o,n;return n=e.prefix_to_replace,o=e.prefix_replace_with,r=e.new_platform,t=e.extra,s.HACK_prefix_to_replace=n,s.HACK_prefix_replace_with=o,s.HACK_new_platform=r,s.HACK_extra=t},s.apply_hacky_log_overrides=function(t,r,o){var n,i;return s.HACK_prefix_to_replace?(i=0===t.indexOf(s.HACK_prefix_to_replace)?t.replace(s.HACK_prefix_to_replace,s.HACK_prefix_replace_with):0!==t.indexOf(s.HACK_prefix_replace_with)?s.HACK_prefix_replace_with+t:t,n=e.extend({},o,this.HACK_extra),[i,s.HACK_new_platform,n]):[t,r,o]},s.log_and_send=function(e,r,o){var n;return null==r&&(r={}),null==o&&(o=s.Platform.WEB),n=s.apply_hacky_log_overrides(e,o,r),e=n[0],o=n[1],r=n[2],t.SilentBackgroundRequest({url:"/photos/photos_engagement_log",data:{event:e,extra:JSON.stringify(r),platform:o}})},s.log=function(e,t,r){var o,n;return this._init(),s.first_log_sent?(null==t&&(t={}),null==r&&(r=s.Platform.WEB),n=s.apply_hacky_log_overrides(e,r,t),e=n[0],r=n[1],t=n[2],o={event:e,extra:t,platform:r},s.logs_queued.push(o)):(s.log_and_send(e,t,r),void(s.first_log_sent=!0))},s.log_carousel=function(e,t){return s.log(e,t,s.Platform.WEB_CAROUSEL)},s._send_log_batch=function(){return s.logs_queued.length?(t.SilentBackgroundRequest({url:"/photos/photos_engagement_batch_log",data:{events:JSON.stringify(s.logs_queued)}}),s.logs_queued=[]):void 0},s._init=function(){return this._initialized?void 0:(this._initialized=!0,setInterval(s._send_log_batch,1e4),e(window).unload(s._send_log_batch))},s}()})}.call(this),function(){define("modules/clean/raf",function(){var e,t,s,r,o,n,i;for(t=window.requestAnimationFrame,e=window.cancelAnimationFrame,n=["ms","moz","webkit","o"],s=0,o=n.length;o>s&&(i=n[s],!t);s++)t=window[i+"RequestAnimationFrame"],e=window[i+"CancelAnimationFrame"]||window[i+"CancelRequestAnimationFrame"];return t||(r=0,t=function(e,t){var s,o,n,i;return s=(new Date).getTime(),i=Math.max(0,16-(s-r)),o=function(){return e(s+i)},n=setTimeout(o,i),r=s+i,n}),e||(e=function(e){return clearTimeout(e)}),{requestAnimationFrame:t.bind(window),cancelAnimationFrame:e.bind(window)}})}.call(this),function(){define("modules/clean/react/app_actions_view",["external/react","external/react-dom","external/underscore","external/classnames","modules/clean/react/css","modules/clean/react/prompt/react_ha","modules/clean/react/sprite_div","modules/clean/user_education/user_education_client"],function(e,t,s,r,o,n,i,a){var l,u,p,d,c;return d=a.UserEducationEffect,c=e.DOM,u=e.PropTypes.shape({displayName:e.PropTypes.string.isRequired,handleClick:e.PropTypes.func,disabled:e.PropTypes.boolean}),p=e.PropTypes.shape({displayName:e.PropTypes.string.isRequired,handleClick:e.PropTypes.func,iconName:e.PropTypes.string.isRequired,disabled:e.PropTypes.boolean}),l=e.createClass({displayName:"AppActionsView",propTypes:{headerText:e.PropTypes.string,primaryMenuItem:u,primarySubnode:e.PropTypes.node,secondaryMenuItems:e.PropTypes.arrayOf(p),handleComponentTTI:e.PropTypes.func},componentDidMount:function(){return this.props.handleComponentTTI(this.constructor.displayName)},getDefaultProps:function(){return{headerText:"",secondaryMenuItems:[],handleComponentTTI:function(){return{}}}},_renderMenuItemIcon:function(t){return e.createElement(i,{ref:"icon",alt:"",group:"web",name:t.iconName})},focusOnButton:function(){return t.findDOMNode(this.refs.actionMenuButton).focus()},_renderPrimaryMenuItem:function(){return c.div({className:"primary-action-menu"},c.span({className:"primary-action-menu__header-text"},this.props.headerText),c.button({ref:"actionMenuButton",className:"primary-action-menu__button button-primary",onClick:this.props.primaryMenuItem.handleClick,disabled:this.props.primaryMenuItem.disabled},this.props.primaryMenuItem.displayName))},render:function(){var t;return t=this.props.secondaryMenuItems.map(function(t){return function(o){var n,i;return i=t._renderMenuItemIcon(o),n=c.button({className:r({"secondary-action-menu__button":!0,disabled:o.disabled}),onClick:o.disabled?s.noop:o.handleClick},i,c.span({className:"secondary-action-menu__button-text"},e.createElement(d,{containerName:t.constructor.displayName,name:"SecondaryActionMenu-text-"+o.iconName},o.displayName))),c.li({className:"secondary-action-menu__item",key:o.displayName},n)}}(this)),c.div({className:"appactions-menu"},null!=this.props.primaryMenuItem&&Object.keys(this.props.primaryMenuItem).length>0?this._renderPrimaryMenuItem():void 0,this.props.primarySubnode,c.ul({className:"secondary-action-menu u-mar-top-xs"},t))}}),o(l,["/static/css/dropbox/app_actions-vflQsuFnU.css"])})}.call(this),function(){define("modules/clean/react/browse/browse_location",["jquery","external/immutable","external/classnames","external/react","external/react-dom","modules/clean/browse_interface","modules/clean/react/browse/actions","modules/clean/react/sprite","modules/clean/react/sprite_div","modules/clean/filepath","modules/clean/viewer","modules/clean/em_string","modules/clean/react/bubble_menu","modules/core/i18n","modules/clean/react/file_uploader/actions"],function(e,t,s,r,o,n,i,a,l,u,p,d,c,h,m){var f,_,g,b,v,y,S,w,T,D,E,I,P,N,C,F;return N=n.browse_uri_for_fq_path,v=c.BubbleMenu,y=c.BubbleMenuItem,P=h._,I=m.UploaderActions,F=r.DOM,C=r.createElement,w=2.625,T=20,S=1.64,D=37,b=r.createClass({displayName:"BrowseLocation",mixins:[r.addons.PureRenderMixin],propTypes:{path:r.PropTypes.string,user:r.PropTypes.object,selectedFiles:r.PropTypes.instanceOf(t.OrderedSet),isDraggingInternalFiles:r.PropTypes.bool,shouldHighlightDropTargets:r.PropTypes.bool,isBrowseInContentManager:r.PropTypes.bool},getDefaultProps:function(){return{path:"/",selectedFiles:t.OrderedSet(),isDraggingInternalFiles:!1,shouldHighlightDropTargets:!1,isBrowseInContentManager:!1}},_getFirstBreadcrumbName:function(){var e,t,s;return this.props.isBrowseInContentManager?P("Team Folders"):(e=null!=(s=this.props.user.cdm_path)?s:"",t=this.props.path,e?P(t.substr(0,e.length)===e?"Team files":"My files"):u.filename("",p.get_root_name(this.props.user)))},_generateBreadcrumbData:function(){var e,t,s,r,o,n,i,a,l,p,c,h,m,f,_,g,b,v,y,w;for(s=this.props.user.cdm_path,null==s&&(s=""),t="",h=this.props.path,s&&h.substr(0,s.length)===s&&(h=h.substr(s.length),t=s),v=this._getFirstBreadcrumbName(),o=function(){var e,t,s,o;for(s=h.split("/"),o=[],e=0,t=s.length;t>e;e++)r=s[e],r.length>0&&o.push(r);return o}(),e=[{path:t,folderName:v,icon:"work"===this.props.user.role?"work_icon":"personal_icon",alt:P("work"===this.props.user.role?"Work":"Personal")}],n=i=0,m=o.length;m>=0?m>i:i>m;n=m>=0?++i:--i)h=t+("/"+o.slice(0,n+1).join("/")),e.push({path:h,folderName:u.filename(h),icon:"folder_32",alt:P("Folder")});if(e.length<3)return{dropdownCrumbs:[],inlineCrumbs:e,root:e[0]};for(b=null!=(f=null!=(_=e[0])?_.folderName:void 0)?f:"",l=this._getMaxBreadcrumbWidth(b,!1),w=function(){var t,s,o,n;for(n=[],t=0,s=e.length;s>t;t++)r=e[t],n.push(new d(null!=(o=r.folderName)?o:"").length);return n}(),c=1,y=w[e.length-1],n=a=g=e.length-2;(1>=g?1>=a:a>=1)&&(y+=S,y+=w[n],!(y>l));n=1>=g?++a:--a)c+=1;return e.length===c+1&&(c+=1),p=e.length-c,{dropdownCrumbs:e.slice(0,p),inlineCrumbs:e.slice(p),root:e[0]}},_getMaxBreadcrumbWidth:function(e,t){var s;return s=t?w:new d(e).length,T-s},render:function(){var t,s,r,o,n,i,a,l,p;return a=this._generateBreadcrumbData(),r=a.dropdownCrumbs,n=a.inlineCrumbs,p=a.root,i=this._getMaxBreadcrumbWidth(null!=(l=null!=p?p.folderName:void 0)?l:"",r.length>0),t="page-header-text u-l-fl",n.length>1||r.length>0?F.span({},F.h1({className:"ax-visually-hidden"},u.filename(this.props.path)),F.nav({className:t,id:"browse-location","aria-label":P("Folder hierarchy"),role:"navigation"},r.length>0?C(f,{crumbs:r,currentPath:this.props.path,selectedFiles:this.props.selectedFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,shouldHighlightDropTargets:this.props.shouldHighlightDropTargets}):void 0,function(){var t,a,l;for(l=[],o=t=0,a=n.length;a>t;o=++t)s=n[o],l.push(C(g,e.extend({},s,{key:encodeURI(s.path),user:this.props.user,isOnlyCrumb:0===o&&1===n.length&&0===r.length,isLastCrumb:o===n.length-1,maxWidth:i,currentPath:this.props.path,selectedFiles:this.props.selectedFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isHighlightedDropTarget:this.props.shouldHighlightDropTargets})));return l}.call(this))):F.h1({className:t},this._getFirstBreadcrumbName())}}),E=r.createClass({displayName:"Spacer",render:function(){return F.span({},C(a,{group:"web",name:"chevron",className:"breadcrumb__spacer",alt:""}))}}),g=r.createClass({displayName:"BreadCrumbSegment",propTypes:{path:r.PropTypes.string.isRequired,user:r.PropTypes.object,folderName:r.PropTypes.string.isRequired,isLastCrumb:r.PropTypes.bool.isRequired,isOnlyCrumb:r.PropTypes.bool,maxWidth:r.PropTypes.number.isRequired,currentPath:r.PropTypes.string.isRequired,selectedFiles:r.PropTypes.instanceOf(t.OrderedSet),isDraggingInternalFiles:r.PropTypes.bool,isHighlightedDropTarget:r.PropTypes.bool},getDefaultProps:function(){return{isOnlyCrumb:!1,isDraggingInternalFiles:!1,isHighlightedDropTarget:!1,selectedFiles:t.OrderedSet()}},getInitialState:function(){return{isDraggedOver:!1}},handleMouseEnter:function(){return this.props.isDraggingInternalFiles?this.setState({isDraggedOver:!0}):void 0},handleMouseLeave:function(){return this.state.isDraggedOver?this.setState({isDraggedOver:!1}):void 0},handleMouseUp:function(){return this.state.isDraggedOver?this.setState({isDraggedOver:!1}):void 0},componentDidMount:function(){var t,s;return t=0,s=null,e(o.findDOMNode(this)).on("dragenter.breadcrumb",function(e){return function(r){return r.preventDefault(),r.target!==s?(s=r.target,t+=1,e.setState({isDraggedOver:!0}),e.props.isLastCrumb?void 0:I.setPath({path:e.props.path})):void 0}}(this)).on("dragleave.breadcrumb",function(e){return function(r){return r.preventDefault(),s=null,t-=1,1>t&&(t=0,e.state.isDraggedOver)?(I.setPath({path:e.props.currentPath}),e.setState({isDraggedOver:!1})):void 0}}(this)).on("drop.breadcrumb",function(e){return function(){return e.setState({isDraggedOver:!1})}}(this)).on("dragover.breadcrumb",function(e){return e.preventDefault(),e.stopPropagation()}).on("mouseenter.breadcrumb",this.handleMouseEnter).on("mouseleave.breadcrumb",this.handleMouseLeave).on("mouseup.breadcrumb",this.handleMouseUp)},componentWillUnmount:function(){return e(o.findDOMNode(this)).off(".breadcrumb")},render:function(){var e,t;return t=this.props.isOnlyCrumb?this.props.folderName:d.em_snippet(this.props.folderName,this.props.maxWidth),e={"breadcrumb-segment":!0,"breadcrumb-segment--is-drop-target":!this.props.isLastCrumb&&this.props.isHighlightedDropTarget,"breadcrumb-segment--file-dragged-over":!this.props.isLastCrumb&&this.state.isDraggedOver},this.props.isLastCrumb?F.span({},t):F.span({},F.a({href:N(this.props.user,this.props.path),onClick:this.navigateToFolder,className:s(e)},t),C(E))},navigateToFolder:function(e){return e.preventDefault(),i.setUrl({path:this.props.path})}}),_=r.createClass({displayName:"BreadCrumbDropdownMenuItem",propTypes:{path:r.PropTypes.string.isRequired,icon:r.PropTypes.string.isRequired,folderName:r.PropTypes.string.isRequired,alt:r.PropTypes.string,isHighlightedDropTarget:r.PropTypes.bool,closeFunc:r.PropTypes.func,isDraggingInternalFiles:r.PropTypes.bool,selectedFiles:r.PropTypes.instanceOf(t.OrderedSet),currentPath:r.PropTypes.string.isRequired},getDefaultProps:function(){return{isHighlightedDropTarget:!1,closeFunc:function(){},alt:"",isDraggingInternalFiles:!1,selectedFiles:t.OrderedSet()}},getInitialState:function(){return{isDraggedOver:!1}},handleMouseEnter:function(){return this.props.isDraggingInternalFiles?this.setState({isDraggedOver:!0}):void 0},handleMouseLeave:function(){return this.state.isDraggedOver?this.setState({isDraggedOver:!1}):void 0},handleMouseUp:function(){return this.state.isDraggedOver&&this.setState({isDraggedOver:!1}),this.props.isDraggingInternalFiles&&!this.props.isLastCrumb?this.props.closeFunc():void 0},componentDidMount:function(){var t,s;return t=0,s=null,e(o.findDOMNode(this)).on("dragenter.breadcrumbMenuItem",function(e){return function(r){return r.preventDefault(),r.target!==s?(s=r.target,t+=1,e.setState({isDraggedOver:!0}),I.setPath({path:e.props.path})):void 0}}(this)).on("dragleave.breadcrumbMenuItem",function(e){return function(r){return r.preventDefault(),s=null,t-=1,1>t&&(t=0,e.state.isDraggedOver)?(I.setPath({path:e.props.currentPath}),e.setState({isDraggedOver:!1})):void 0}}(this)).on("drop.breadcrumbMenuItem",function(e){return function(t){return e.setState({isDraggedOver:!1})}}(this)).on("dragover.breadcrumbMenuItem",function(e){return e.preventDefault(),e.stopPropagation()}).on("mouseenter.breadcrumbMenuItem",this.handleMouseEnter).on("mouseleave.breadcrumbMenuItem",this.handleMouseLeave).on("mouseup.breadcrumbMenuItem",this.handleMouseUp)},componentWillUnmount:function(){return e(o.findDOMNode(this)).off(".breadcrumbMenuItem")},handleCrumbClick:function(e){return e.preventDefault(),i.setUrl({path:this.props.path})},render:function(){var e;return e={"breadcrumb-menu-item":!0,"breadcrumb-menu-item--is-drop-target":this.props.isHighlightedDropTarget,"breadcrumb-menu-item--file-dragged-over":this.state.isDraggedOver},C(y,{onClick:this.handleCrumbClick,closeFunc:this.props.closeFunc,className:s(e)},F.span({className:"force-no-break"},C(l,{group:"web",name:this.props.icon,alt:this.props.alt,text:d.em_snippet(this.props.folderName,D)})))}}),f=r.createClass({displayName:"BreadCrumbDropdown",propTypes:{crumbs:r.PropTypes.array.isRequired,currentPath:r.PropTypes.string.isRequired,shouldHighlightDropTargets:r.PropTypes.bool,selectedFiles:r.PropTypes.instanceOf(t.OrderedSet),isDraggingInternalFiles:r.PropTypes.bool},getDefaultProps:function(){return{shouldHighlightDropTargets:!1,selectedFiles:t.OrderedSet(),isDraggingInternalFiles:!1}},componentDidMount:function(){return e(o.findDOMNode(this)).on("dragenter.breadcrumbDropdown",function(e){return function(t){return t.preventDefault(),e.refs.bubbleMenu.showMenu()}}(this)).on("mouseenter.breadcrumbDropdown",function(e){return function(t){return e.props.isDraggingInternalFiles?(t.preventDefault(),e.refs.bubbleMenu.showMenu()):void 0}}(this))},componentWillUnmount:function(){return e(o.findDOMNode(this)).off(".breadcrumbDropdown")},render:function(){var e,t,s,r;return t=this.props.crumbs,t.reverse(),r=F.button({className:"u-unbutton breadcrumb-overflow-button u-l-fl"},C(a,{group:"web",name:"folder_arrow_32",alt:P("Show parent folders (descending)")})),s=function(){var s,r,o;for(o=[],s=0,r=t.length;r>s;s++)e=t[s],o.push(C(_,{key:encodeURI(e.path),path:e.path,icon:e.icon,alt:e.alt,folderName:e.folderName,currentPath:this.props.currentPath,isHighlightedDropTarget:this.props.shouldHighlightDropTargets,isDraggingInternalFiles:this.props.isDraggingInternalFiles,selectedFiles:this.props.selectedFiles}));return o}.call(this),F.span({className:"breadcrumb-dropdown-container"},C(v,{ref:"bubbleMenu",position:v.POSITIONS.BOTTOM_RIGHT,targetButton:r,targetFixed:!0,items:s}),C(E))}}),b})}.call(this),function(){define("modules/clean/react/browse/cdm_mve_work_usage_banner",["external/react","modules/clean/react/browse/models","modules/clean/react/css","modules/clean/teams/cdm_mve_quota_usage","modules/core/i18n"],function(e,t,s,r,o){var n,i,a,l,u,p;return i=t.QuotaStats,a=o._,p=e.DOM,u=e.createElement,l=e.createClass({displayName:"CdmMveWorkUsageBanner",propTypes:{userQuota:e.PropTypes.instanceOf(i).isRequired},mixins:[e.addons.PureRenderMixin],render:function(){return p.div({className:"c-banner c-banner--unpinned u-pad-s"},p.strong({},a("Only you have access")),u(r,{quotaStats:this.props.userQuota}))}}),n=s(l,["/static/css/shared_folder_members_preview/cdm_mve_banner-vflRBgSZE.css"])})}.call(this),function(){define("modules/clean/react/browse/comment_status",["modules/clean/activity/constants","modules/clean/comments/utils","modules/clean/file_activity/api","modules/clean/flux/dispatcher","modules/clean/react/browse/actions","modules/clean/react/browse/constants","modules/clean/react/browse/store"],function(e,t,s,r,o,n,i){var a,l,u,p,d,c,h,m,f,_,g,b,v,y,S,w,T;return a=e.ActivityContext,l=n.BrowseActionTypes,p=n.FileTypes,u=i.BrowseStore,w={},d=function(e){var t;return s.fetchCommentStatusBatch({actorId:null!=(t=u.user())?t.id:void 0,context:a.BROWSE_FILE_VIEWER,contextDataList:e,isBackgroundRequest:!0})},h=function(e){return null==e.feedback_off&&null==e.comment_count&&null==e.unresolved_comment_count},m=function(e){return e.type===p.FILE},f=function(e){return null!=e.after},c=function(e){var t,s;return t=e.files,s=t.filter(m).filter(h).map(function(e){return e.fq_path}),s.length>0?d(s).then(function(e){return o.addCommentStatusBatch({commentStatusByFqPath:e})}):void 0},y=c,b=c,g=c,v=function(e){var t,s,r;return t=e.fileDeltas,r=e.path,s=t.filter(f).map(function(e){var t;return t=e.after}),c({files:s})},_=function(e){var t;switch(t=e.action,t.type){case l.LOAD_PATH:return y(t.data);case l.ADD_FILES:return b(t.data);case l.INITIALIZE_EVERYTHING:return g(t.data);case l.CHANGE_FILES:return v(t.data)}},S=function(e){return null==e&&(e=r),w={dispatcher:e,dispatchToken:e.register(_)},c({files:u.files().toArray()})},T=function(){return w.dispatcher.unregister(w.dispatchToken),w={}},{setup:S,teardown:T}})}.call(this),function(){define("modules/clean/react/browse/context_menu",["external/immutable","external/react","modules/clean/react/browse/action_logger","modules/clean/react/browse/file_actions","modules/clean/react/browse/global_actions","modules/clean/react/browse/models","modules/clean/react/context_menu_v2"],function(e,t,s,r,o,n,i){var a,l,u,p,d,c,h,m,f;return c=e.OrderedSet,u=s.BrowseLogEventSources,m=r.getActionsForFileCollection,f=o.getGlobalActions,a=n.BrowseContext,d=i.GlobalContextMenu,p=i.ContextMenuItem,h=t.createElement,l=t.createClass({displayName:"BrowseContextMenu",propTypes:{context:t.PropTypes.instanceOf(a).isRequired,isSearchMode:t.PropTypes.bool,selectedFiles:t.PropTypes.instanceOf(c).isRequired,shouldShowDeletedFiles:t.PropTypes.bool,shouldShowGlobalActions:t.PropTypes.bool,user:t.PropTypes.object.isRequired,onFileUpload:t.PropTypes.func,actionHandlers:t.PropTypes.object},getDefaultProps:function(){return{onFileUpload:function(){},actionHandlers:{},isSearchMode:!1,shouldShowDeletedFiles:!1,shouldShowGlobalActions:!0}},openMenuAtPosition:function(e,t,s){return null==s&&(s=null),this.refs.contextMenu.openMenuAtPosition(e,t),null!=s?this.elemToFocusAfterClose=s:void 0},closeMenu:function(){return this.refs.contextMenu.closeMenu()},toggleMenu:function(e){return this.refs.contextMenu.toggleMenu(e)},render:function(){var e,t,s,r,o,n,i,a,l,c;if(r=[],this.props.shouldShowGlobalActions&&this.props.selectedFiles.isEmpty())s=f({context:this.props.context,user:this.props.user,showDeletedFiles:this.props.shouldShowDeletedFiles,onFileUpload:this.props.onFileUpload,isContextMenu:!0});else{if(this.props.selectedFiles.isEmpty())return null;s=m({files:this.props.selectedFiles,context:this.props.context,user:this.props.user,actionHandlers:this.props.actionHandlers,isSearchMode:this.props.isSearchMode,source:u.LEGACY_CONTEXT_MENU})}for(e=function(e){return p({text:e.label,icon:{group:"web",name:e.spriteName},onClick:e.performAction,href:e.href,isDisabled:e.disabled})},o=0,i=s.length;i>o;o++)t=s[o],a=e(t),(null!=(l=t.subItems)?l.length:void 0)&&(c=t.subItems.map(e),a=a.set("subMenuItems",c)),r.push(a);return n=["a:not(.filename-link)","input","button","textarea","select","#notify-wrapper",".db-modal-wrapper",".react-file-viewer",".bubble-dropdown",".pinned-team-folder__file-row"],h(d,{alwaysOpenOnCapture:!0,ignoreSelectors:n.join(),items:r,onMenuClose:function(e){return function(){var t;return null!=e.elemToFocusAfterClose?("function"==typeof(t=e.elemToFocusAfterClose).focus&&t.focus(),e.elemToFocusAfterClose=null):void 0}}(this),ref:"contextMenu"},this.props.children)}}),{BrowseContextMenu:l}})}.call(this),function(){define("modules/clean/react/browse/file_actions",["external/underscore","modules/clean/filepath","modules/clean/react/browse/actions","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/action_logger","modules/clean/react/browse/util","modules/clean/react/file_modal_controller","modules/clean/search/search_helpers","modules/clean/sharing/constants","modules/clean/sharing/share_modal_util","modules/clean/sharing/shared_content_link_sync_utils","modules/clean/sharing/ui_util","modules/clean/unity/check_file_cache","modules/clean/unity/features","modules/clean/viewer","modules/constants/browse","modules/constants/viewer","modules/core/browser","modules/core/i18n"],function(e,t,s,r,o,n,i,a,l,u,p,d,c,h,m,f,_,g,b,v){var y,S,w,T,D,E,I,P,N,C,F,M;return T=o.FileTypes,y=n.BrowseLogger,F=i.getRevisionsUri,w=a.FileModalController,D=c.GoldenGate,E=v._,S={showTiburonShare:!1,showCopyPublicFolderFileLink:!1,showOpen:!1,showDownload:!1,showComment:!1,showDelete:!1,showArchive:!1,showRemove:!1,showRename:!1,showRenameTeamFolder:!1,showMove:!1,showCopy:!1,showPhotos:!1,showVersions:!1,showRestore:!1,showReadd:!1,showPermanentDelete:!1,showRemoveAccess:!1,showActivity:!1},M=function(e,t){return t?e.isDeleted||e.is_unmounted:e.isDeleted},C=function(t){var s,r,o,n,i,a,l,u,p;return p=t.user,o=t.context,n=t.files,
i=null!=(u=t.isMaestroDesign)?u:!1,s=e.clone(S),o.isInsideArchivedTeamFolder?(s.showDownload=!0,s):(r=!o.isNonUserRelativeContext,l=n.every(function(e){return!M(e,r)}),a=!l&&n.every(M,r),l?P({actions:s,files:n,context:o,user:p,isMaestroDesign:i}):a?I({actions:s,files:n,context:o}):s)},P=function(e){var t,s,r,o,n,i,a,l,u,d,c,_,g,b,v,y,S,w;return t=e.actions,o=e.files,s=e.context,w=e.user,a=null!=(y=e.isMaestroDesign)?y:!1,d=1===o.count(),c=d&&o.first().is_dir,_=d&&!o.first().is_dir,u=o.some(function(e){return e.type===T.SHARED_FOLDER||e.type===T.TEAM_SHARED_FOLDER}),b=o.some(function(e){return e.type===T.TEAM_SHARED_FOLDER}),g=o.some(function(e){return e.type===T.TEAM_MEMBER_FOLDER}),n=o.every(function(e){return e.in_root_coll}),l=w.id===(null!=(S=f.get_viewer().photos_user)?S.id:void 0),v=!1,t.showCopy=!b&&!g,b||g||(d&&u&&!s.isInsideTeamFolderTree?a||s.isNonUserRelativeContext?t.showDelete=!0:t.showRemove=!0:t.showDelete=!0,t.showRename=s.isInFolderMode&&d,t.showMove=!0),w.is_team_admin&&D.hasContentManagerAndSuperAdmin(w.id)&&d&&b&&(t.showArchive=!0,t.showRenameTeamFolder=!0),d&&(r=o.first(),i=p.fileIsInPublicFolder(s,r.fq_path),i||g||(t.showTiburonShare=!0),v=null!=m&&(null!=h?h.is_cached_and_locally_available(r.ns_id,r.ns_path):void 0),v&&(t.showOpen=!0)),_&&(s.isNonUserRelativeContext?t.showActivity=!0:(t.showComment=!0,t.showVersions=!0),s.isInFolderMode?t.showCopyPublicFolderFileLink=i:t.showCopyPublicFolderFileLink=!1),t.showPhotos=n&&l,v||(t.showDownload=s.isInFolderMode||_),t},I=function(e){var t,s,r,o,n,i,a,l;return t=e.actions,n=e.files,s=e.context,n.some(function(e){return e.is_unmounted})?t:(a=1===n.count()&&n.first().is_dir,l=a?(r=n.first(),s.inactiveNSIDByFQPath[r.fq_path.toLowerCase()]):!1,l?t.showReadd=!0:t.showRestore=!0,s.isInFolderMode?i=s.permanentDeletionDisabledStateByNSID[s.currentNSID]:(o=n.map(function(e){return e.ns_id}),i=o.some(function(e){return s.permanentDeletionDisabledStateByNSID[e]})),i||(l?t.showRemoveAccess=!0:t.showPermanentDelete=!0),s.isNonUserRelativeContext&&(t.showRemoveAccess=!1,t.showPermanentDelete=!1,t.showReadd=!1,(n.count()>1||a)&&(t.showRestore=!1)),t)},N=function(o){var n,i,a,c,h,_,g,v,S,T,D,I,P,N,M,R,A,x,O,L,k,U,B,H,q,G,W,V,z,j,Q,K,Y,X,Z,$;return _=o.files,c=o.context,$=o.user,i=o.actionHandlers,X=null!=(z=o.skipSharing)?z:!1,H=null!=(j=o.isMaestroDesign)?j:!1,q=null!=(Q=o.isSearchMode)?Q:!1,Z=null!=(K=o.source)?K:void 0,L=function(){return p.showShareModal($,_.first(),{browseContext:c,origin:u.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW})},M=function(){var e;return e=p.getLegacyPublicFolderShareURI($,_.first(),c),e?p.showCopyPublicLinkModal(e):void 0},P=function(){var e;return e=_.first(),q&&l.logSearchAction(e,$,"open"),m.open_file(e.ns_id,e.ns_path,$.id,m.standard_open_file_handler,function(e){return m.standard_open_file_handler(!1)})},D=function(){return q&&l.logSearchAction(_.first(),$,"download"),y.logDownload({uid:$.id,path:c.currentFQPath,files:_.toArray(),source:Z}),s.downloadFiles({files:_,context:c,user:$})},v=function(){var e;return e=_.first(),q&&l.logSearchAction(e,$,"comment"),y.logAddComment({uid:$.id,path:c.currentFQPath,files:_.toArray(),source:Z}),s.navigateToFileOrFolder({file:e,shouldFocusComment:!0})},A=function(){var e;return e=_.first(),q&&l.logSearchAction(e,$,"rename"),y.logRenameFiles({uid:$.id,path:c.currentFQPath,files:_.toArray(),source:Z}),s.showFileRename({file:e})},x=function(){return w.showContentManagerBridge(_.toArray(),"rename",f.get_viewer().team_is_limited)},g=function(){return w.showContentManagerBridge(_.toArray(),"archive",f.get_viewer().team_is_limited)},I=function(){return q&&l.logSearchAction(_.first(),$,"move"),y.logOpenMoveModal({uid:$.id,path:c.currentFQPath,files:_.toArray(),source:Z}),w.showMove($,_.toArray(),c.currentFQPath,{onSuccess:function(e){var t;return t=e.path,y.logMoveFiles({uid:$.id,path:c.currentFQPath,files:_.toArray(),newPath:t,source:Z})},onUndo:function(){return s.selectRowsFromNotServer(_.toArray())},onRequestNotSent:function(){var e;return s.selectFilesByFqPath({fqPathsToSelect:function(){var t,s,r,o;for(r=_.toArray(),o=[],t=0,s=r.length;s>t;t++)e=r[t],o.push(e.fq_path);return o}()})}})},S=function(){return q&&l.logSearchAction(_.first(),$,"copy"),y.logOpenCopyModal({uid:$.id,path:c.currentFQPath,files:_.toArray(),source:Z}),w.showCopy($,_.toArray(),{onSuccess:function(e){var t;return t=e.files,y.logCopyFiles({uid:$.id,path:c.currentFQPath,files:_.toArray(),source:Z}),s.selectRowsFromNotServer(t)},onUndo:function(){return s.selectRowsFromNotServer(_.toArray())},onRequestNotSent:function(){var e;return s.selectFilesByFqPath({fqPathsToSelect:function(){var t,s,r,o;for(r=_.toArray(),o=[],t=0,s=r.length;s>t;t++)e=r[t],o.push(e.fq_path);return o}()})}})},O=function(){var e,t;return q&&l.logSearchAction(_.first(),$,"restore"),e=1===_.size&&_.first().is_dir,e&&!c.isNonUserRelativeContext?(t=r.getRestoreFileUrl({fqPath:_.first().fq_path,userId:$.id}),b.redirect(t)):i.onRestoreMulti()},R=function(){var e,s,r,o;return e=_.first(),r=e.fq_path.toLowerCase(),o=c.inactiveNSIDByFQPath[r],s=t.filename(e.fq_path),o?d.mountSharedFolder(o,$.role,u.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS,!1,null,!0):void 0},B=function(){return q&&l.logSearchAction(_.first(),$,"view_in_photos"),s.viewInPhotos({files:_,user:$})},h=!c.isCurrentPathWriteable(),Y=!c.isCurrentPathWriteable(),W=!c.isCurrentPathWriteable(),a=C({files:_,context:c,user:$,isMaestroDesign:H}),G=[],k=function(){var e;return q&&l.logSearchAction(_.first(),$,"revisions"),y.logVersions({uid:$.id,path:c.currentFQPath,files:_.toArray(),source:Z}),e=F(_.first().fq_path,$).toString(),b.redirect(e)},U=function(){return"function"==typeof i.onViewActivity?i.onViewActivity():void 0},T=function(e){return q&&l.logSearchAction(_.first(),$,"delete"),y.logDeleteFiles({uid:$.id,path:c.currentFQPath,files:_.toArray(),source:Z}),i.onDelete(e)},N=function(e){return q&&l.logSearchAction(_.first(),$,"purge"),y.logPermanentDeleteFiles({uid:$.id,path:c.currentFQPath,files:_.toArray(),source:Z}),i.onPermanentDelete(e)},n=function(t,s,r,o){var n;return n={label:t,spriteName:s,performAction:r},e.extend(n,o)},H?(a.showTiburonShare&&G.push(n(E("Share"),"s_rainbow",L)),a.showCopyPublicFolderFileLink&&G.push(n(E("Copy public link"),"world_link",M)),a.showOpen&&G.push(n(E("Open"),"open",P)),a.showDownload&&G.push(n(E("Download"),"download",D)),a.showComment&&G.push(n(E("Add comment"),"s_file_comment",v)),a.showVersions&&G.push(n(E("Previous versions"),"previous_versions",k)),a.showRename&&(V={ref:"rename",disabled:Y},G.push(n(E("Rename"),"rename",A,V))),a.showMove&&(V={disabled:W},G.push(n(E("Move"),"move_16",I,V))),a.showCopy&&G.push(n(E("Copy"),"copy",S)),a.showDelete&&(V={disabled:h},G.push(n(E("Delete"),"delete_16",T,V))),a.showRestore&&G.push(n(E("Restore"),"restore",O)),a.showPermanentDelete&&G.push(n(E("Permanently delete"),"cancel",N)),G):(X||a.showTiburonShare&&G.push(n(E("Share…"),"s_rainbow",L)),a.showCopyPublicFolderFileLink&&G.push(n(E("Copy public link…"),"world_link",M)),a.showOpen&&G.push(n(E("Open"),"open",P)),a.showDownload&&G.push(n(E("Download"),"download",D)),a.showComment&&G.push(n(E("Comment"),"s_file_comment",v)),a.showDelete&&(V={disabled:h},G.push(n(E("Delete..."),"delete_16",T,V))),a.showRemove&&(V={disabled:h},G.push(n(E("Remove..."),"delete_16",T,V))),a.showArchive&&G.push(n(E("Archive"),"delete_16",g)),a.showRename&&(V={ref:"rename",disabled:Y},G.push(n(E("Rename"),"rename",A,V))),a.showRenameTeamFolder&&G.push(n(E("Rename"),"rename",x)),a.showMove&&(V={disabled:W},G.push(n(E("Move..."),"move_16",I,V))),a.showCopy&&G.push(n(E("Copy..."),"copy",S)),a.showPhotos&&G.push(n(E("View in Photos"),"s_photo",B)),a.showVersions&&(V={href:F(_.first().fq_path,$).toString()},G.push(n(E("Previous versions"),"previous_versions",null,V))),a.showRestore&&G.push(n(E("Restore…"),"restore",O)),a.showReadd&&G.push(n(E("Re-add shared folder"),"restore",R)),a.showPermanentDelete&&G.push(n(E("Permanently delete…"),"cancel",N)),a.showRemoveAccess&&G.push(n(E("Remove my access"),"cancel",N)),a.showActivity&&G.push(n(E("View activity"),"previous_versions",U)),G)},{getActionsForFileCollection:N}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/browse/file_jump",["modules/clean/keycode","modules/clean/react/browse/store","modules/core/dom","modules/clean/react/browse/constants","modules/clean/flux/dispatcher"],function(t,s,r,o,n){var i,a,l,u,p;return l=s.BrowseStore,a=o.BrowseActionTypes,i=["/","\\",":","?","*","<",">","|"],p=1e3,u={_timeout:null,_reset:function(){return n.dispatch({type:a.RESET_FILE_JUMP})},handleKeyPress:function(s){var o,u,d;return u=null!=(d=s.which)?d:s.keyCode,o=String.fromCharCode(u),u<t.SPACE||e.call(i,o)>=0||r.focus_in_input()||s.metaKey||s.altKey||s.altGraphKey||s.ctrlKey||u===t.SPACE&&!l.isFileJumping()?void 0:(u===t.SPACE&&l.isFileJumping()&&s.preventDefault(),n.dispatch({type:a.ADD_FILE_JUMP_KEY_CODE,data:{keyChar:o}}),null!=this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(this._reset,p))}}})}.call(this),function(){define("modules/clean/react/browse/file_list_empty_folder",["external/classnames","external/react","modules/clean/analytics","modules/clean/react/browse/constants","modules/clean/react/button","modules/clean/react_format","modules/clean/react/file_uploader/uploader","modules/clean/react/image","modules/clean/static_urls","modules/core/i18n"],function(e,t,s,r,o,n,i,a,l,u){var p,d,c,h,m,f,_,g,b,v;return h=s.TeamsWebActionsLogger,c=r.NameSpaceAccess,f=o.button,b=n.reactFormat,d=i.FileUploader,v=l.static_url,m=u._,g=t.DOM,_=t.createElement,p=t.createClass({propTypes:{currentSharedFolderPermissionRole:t.PropTypes.number,isArchiveState:t.PropTypes.bool,isBrowseInContentManager:t.PropTypes.bool,isInCdmMve:t.PropTypes.bool,isInsideSharedFolder:t.PropTypes.bool,isSearchState:t.PropTypes.bool,isViewingTeamFolder:t.PropTypes.bool,userId:t.PropTypes.number.isRequired,userFamiliarName:t.PropTypes.string,expBizTeamFolderOnboardingVariant:t.PropTypes.string},mixins:[t.addons.PureRenderMixin],displayName:"EmptyFolder",getDefaultProps:function(){return{isSearchState:!1}},_logTeamAction:function(e){return h.log(e,null,null,this.props.userId,!1,h.LOG_CATEGORY.TEAM_INFO)},render:function(){var t,s,r,o,n,i,l,u,p,y,S,w,T;return l=this.props.isInsideSharedFolder&&((u=this.props.currentSharedFolderPermissionRole)===c.ACCESS_READER||u===c.ACCESS_READER_NO_COMMENT),r={"u-l-dn":l,"drag-prompt":!0},this.props.isSearchState?g.div({className:"u-font-center u-pad-top-xl"},_(a,{src:v("/static/images/empty_states/search-vfl6DaX2I.png"),srcHiRes:v("/static/images/empty_states/search@2x-vflBsUhDE.png"),alt:""}),g.h2({className:"u-pad-top-l"},m("No results found")),g.div({},m("Please update your search and try again"))):this.props.isBrowseInContentManager&&this.props.isArchiveState?g.div({className:"u-font-center u-font-meta u-pad-top-xl"},m("No archived team folders")):this.props.isBrowseInContentManager&&this.props.isViewingTeamFolder?g.div({className:"u-font-center u-pad-top-xl"},_(a,{src:v("/static/images/empty_states/collaboration-team-folder-vflapVQHo.png"),srcHiRes:v("/static/images/empty_states/collaboration-team-folder@2x-vflsqkNUB.png"),alt:""}),g.div({className:"u-font-center u-font-meta"},m("Create a team folder to get started.")),g.a({href:"/help/986",target:"_blank"},m("What are team folders?"))):(this.props.isViewingTeamFolder?(this._logTeamAction("upload_files_displayed"),t=m("Upload files"),this.props.isInCdmMve?o=g.div({},g.h2({},m("Welcome to your team, %(name)s!").format({name:this.props.userFamiliarName})),g.div({},m("You don’t have any team files yet. Upload files here to instantly share them with your teammates. You can even drag and drop files from your desktop here."))):(h.log("exp_biz_team_folder_onboarding",{variant:this.props.expBizTeamFolderOnboardingVariant}),n=v("/static/images/empty_states/team-folder-vflZkv0TQ.png"),i=v("/static/images/empty_states/team-folder@2x-vfloC8f3o.png"),o=m("This Team folder is empty. Upload files to this folder to share with your Team."),"V1"!==(p=this.props.expBizTeamFolderOnboardingVariant)&&"V2"!==p||(o=g.div({},g.h2({},m("Your team folder is a shared space with your Dropbox team.")),g.div({},m("Team folders automatically include all members of your team, so any document or folder you add here will be automatically shared with your entire team."))),t=m("Add files"),w=b(m("or <helpLink>create a regular shared folder</helpLink> if you want only some members of your team to access a given folder"),{helpLink:g.a({href:"/help/19",target:"_blank"})}))),s=g.div({className:"o-grid"},g.div({className:e({"o-grid__col--centered":!0,"u-pad-top-m":!this.props.isInCdmMve,"o-grid__col--1-of-3":!(this.props.isInCdmMve||"V1"===(y=this.props.expBizTeamFolderOnboardingVariant)||"V2"===y),"o-grid__col--1-of-2":this.props.isInCdmMve||"V1"===(S=this.props.expBizTeamFolderOnboardingVariant)||"V2"===S})},g.div({},o),_(f,{onClick:function(e){return function(){return d.showModal(),e._logTeamAction("upload_files_clicked")}}(this)},t),w?g.div({className:"u-pad-top-xs"},w):void 0))):(n=v("/static/images/empty_states/files-vflsVPyeo.png"),i=v("/static/images/empty_states/files@2x-vflvkuH8g.png"),T=g.h2({},m("This folder is empty.")),s=this.props.isBrowseInContentManager?g.div({},""):g.div({},m("Drag and drop files onto this window to upload."))),g.div({className:"u-font-center u-pad-top-xl"},n?_(a,{src:n,srcHiRes:i,alt:""}):void 0,T,g.div({className:e(r)},s)))}})})}.call(this),function(){define("modules/clean/react/browse/file_list_utils",["modules/clean/react/browse/constants","modules/clean/react/browse/models"],function(e,t){var s,r,o,n;return s=e.DropTargetHighlightMode,n=e.FileTypes,r=t.File,o={shouldFileBeHighlightedDropTarget:function(e){var t,o,i,a;if(o=e.file,i=e.isSelected,t=e.dropTargetHighlightMode,t===s.NONE)return!1;if(!o.is_dir)return!1;if(r.isReadOnlySharedFolder(o))return!1;if(o.isDeleted)return!1;switch(t){case s.ALL_FOLDERS:return!0;case s.NONSELECTED_FOLDERS:return!i;case s.NONSELECTED_NONSHARED_FOLDERS:return!i&&o.type!==n.SHARED_FOLDER;case s.NONSELECTED_NONSHARED_NONTEAM_FOLDERS:return!i&&(a=o.type)!==n.SHARED_FOLDER&&a!==n.TEAM_SHARED_FOLDER}return!1}},{FileListHelpers:o}})}.call(this),function(){define("modules/clean/react/browse/folder_list_row",["jquery","external/classnames","external/immutable","external/react","external/underscore","modules/clean/filepath","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/sprite","modules/core/i18n","modules/clean/react/browse/actions","modules/clean/react/browse/name_input","modules/clean/react/flag","modules/clean/sharing/ui_util","modules/clean/static_urls"],function(e,t,s,r,o,n,i,a,l,u,p,d,c,h,m){var f,_,g,b,v,y,S,w;return b=i.NewFolderCreationState,f=a.BrowseContext,v=u._,_=h.GoldenGate,w=m.static_url,S=r.DOM,y=r.createElement,g=r.createClass({displayName:"NewFolderCreationListRow",mixins:[r.addons.PureRenderMixin],propTypes:{newFolderState:r.PropTypes.oneOf(o.values(b)),context:r.PropTypes.instanceOf(f),topOffsetPx:r.PropTypes.number,user:r.PropTypes.object},_handleCancel:function(){return p.cancelCreateFolder()},_handleSubmit:function(e){return p.createFolder({pathName:this.props.context.currentFQPath,folderName:e,nsId:this.props.context.rootNSID})},_renderIcon:function(){var e,t;return e=null!=this.props.user&&_.hasGoldenGateIconography(this.props.user.id),t=n.new_folder_icon(this.props.context.isInsideTeamFolderTree,e),y(l,{group:"web",name:w("/static/images/icons/icon_spacer-vflN3BYt2.gif"),className:"u-pad-right-xs sprite sprite_web browse-file-row__accessory "+t,alt:""})},_renderNewFolderCreationColumn:function(){var e,t;return e=this._renderIcon(),t=S.div({}),this.props.newFolderState===b.PENDING_INPUT?t=y(d,{defaultValue:"",label:v("Folder name"),onSubmit:this._handleSubmit,onCancel:this._handleCancel,className:"browse-file-row__input"}):this.props.newFolderState===b.SAVING_INPUT&&(t=S.div({className:"creating_folder_text",role:"status","aria-live":"polite"},v("Creating new folder…"))),S.div({className:"o-grid__col--1-of-2",role:"gridcell"},y(c,{leftAttachment:e},t))},_renderPlaceholder:function(){return S.div({role:"gridcell"})},render:function(){var e;return e={"browse-file-row":!0,"o-grid":!0,"o-grid--no-gutter":!0,"browse-file-row--is-selected":!0},S.li({className:t(e),role:"row",style:{position:"absolute",top:this.props.topOffsetPx}},this._renderPlaceholder(),this._renderNewFolderCreationColumn(),this._renderPlaceholder(),this._renderPlaceholder(),this._renderPlaceholder())}})})}.call(this),function(){define("modules/clean/react/browse/global_actions",["jquery","external/classnames","external/react","external/underscore","modules/clean/react/title_bubble","modules/clean/payments/pro_trial_onboarding_tour","modules/clean/css","modules/clean/filepath","modules/clean/react/browse/action_logger","modules/clean/react/browse/actions","modules/clean/sharing/wizard/wizard_modals","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/sprite","modules/clean/react/sprite_div","modules/clean/sharing/shared_content_link_sync_utils","modules/clean/sharing/share_modal_util","modules/clean/sharing/ui_util","modules/clean/user","modules/clean/viewer","modules/constants/browse","modules/clean/sharing/constants","modules/clean/react/bubble_menu","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,s,r,o,n,i,a,l,u,p,d,c,h,m,f,_,g,b,v,y,S,w,T,D,E,I){var P,N,C,F,M,R,A,x,O,L,k,U,B,H,q,G,W,V,z;return O=n.ProOnboardingTooltips,N=l.BrowseLogger,V=p.showShareAFolderWizardModal,x=c.NameSpaceAccess,P=h.BrowseContext,z=g.showShareModal,q=b.genContentManagerBridgeUri,A=b.GoldenGate,C=T.BubbleMenu,F=T.BubbleMenuItem,L=E._,H=s.DOM,U=s.createElement,B=t,R={INLINE:0,INLINE_WITH_TEXT:1},k=function(e,t){var s,r;return t?(r=y.get_viewer(),s=e.isInsideAutoTeamFolder&&r.team_is_limited&&"/"===a.parent_dir(e.currentFQPath),L(s?r.work_user.is_team_admin?"Folder settings":"Invite members":e.isCurrentlyInRoot?"New shared folder":"Share folder")):L(e.isInsideAutoTeamFolder?"Team folder options…":e.isInsideSharedFolder?"Shared folder options…":e.isCurrentlyInRoot?"Share a folder…":"Share this folder…")},W=function(e){var t,s,r,o,n,i,a,l,p,d,c,h,m,f,_,g,b,v,y;return t=e.context,y=e.user,g=e.showDeletedFiles,m=e.onFileUpload,c=null!=(f=e.isMaestroDesign)?f:!1,d=t.isCurrentlyInRoot,s=R.INLINE,_=R.INLINE,i=function(e){return e.preventDefault(),m(e)},a=function(e){return e.preventDefault(),u.nameNewFolder()},l=function(e){return e.preventDefault(),d?V(y):z(y,t,{origin:w.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS})},p=function(e){return e.preventDefault(),u.setShouldShowDeletedFiles({shouldShowDeletedFiles:!g})},h=[],v=L("Upload…"),b={label:v,spriteName:"upload_16",performAction:i,style:s},n=s,o={label:L("New folder"),spriteName:"folder_add",performAction:a,style:n},r={label:L(g?"Hide deleted files":"Show deleted files"),spriteName:g?"trash-can-open":"trash-can",performAction:p,style:s},t.isInsideDeletedFolder||(h=h.concat([b,o,r]),h=h.filter(function(e){return null!=e})),h},G=function(e){var t,s,r,o,n,i,l,p,c,h,m,f,g,b,v,T,E,I,P,C,F,M,U,B,H,G,W,j,Q,K,Y,X,Z;return t=e.context,Z=e.user,K=e.showDeletedFiles,W=e.onFileUpload,B=e.isMaestroDesign,M=e.isContextMenu,U=t.isCurrentlyInRoot,C=Z.is_team_admin&&U&&A.hasContentManager(Z.id),F=t.isInsideSharedFolder&&t.currentSharedFolderPermissionRole===x.ACCESS_READER,s=R.INLINE,Q=R.INLINE,G=S.SUBGROWTH_PRO_ONBOARDING_LAST_SEEN_STEP,p="V1"===S.SUBGROWTH_PRO_ONBOARDING_UPLOAD&&0===G,l="V1"===S.SUBGROWTH_PRO_ONBOARDING_SHARING&&1===G,h=L("Getting started?\nClick here to upload your files to Dropbox"),c=L("Have you tried using Dropbox to collaborate with others?\nClick here to share a project folder"),g=function(e){return e.preventDefault(),p&&O.setUserOnboardingAttribute(e.currentTarget,G+1),W(e)},b=function(e){return e.preventDefault(),N.logCreateFolder({uid:Z.id}),u.nameNewFolder()},E=function(e){return e.preventDefault(),l&&O.setUserOnboardingAttribute(e.currentTarget,G+1),U?V(Z):z(Z,t,{origin:w.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS})},I=function(e){var t;return t=q(y.get_viewer().team_is_limited),D.open_tab(t.toString())},P=function(e){return e.preventDefault(),N.logToggleDeletedFiles({uid:Z.id,show_deleted_files:!K}),u.setShouldShowDeletedFiles({shouldShowDeletedFiles:!K})},T=function(e){var s;return e.preventDefault(),s=d.getRestoreFileUrl({fqPath:t.currentFQPath,userId:Z.id}),D.redirect(s)},v=function(e){var s,r,o;return e.preventDefault(),r=t.currentFQPath.toLowerCase(),o=t.inactiveNSIDByFQPath[r],s=a.filename(t.currentFQPath),o?_.mountSharedFolder(o,Z.role,w.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS):void 0},o={label:L("Folder"),sublabel:L("For private files"),spriteName:M?"folder":"folder_32",performAction:b,disabled:F},n={label:L("Shared folder"),sublabel:L("For collaborating on a project"),spriteName:M?"folder_user":"folder_user_32",performAction:E},i={label:L("Team folder"),sublabel:L("For sharing with an entire department or team"),sublabelLine2:L("This will take you to the Admin Console"),spriteName:M?"folder_team":"folder_team_32",performAction:I},X=L(B?U?"Upload file":"Upload files":"Upload…"),Y={label:X,tooltip:p?h:void 0,spriteName:"upload_16",performAction:g,disabled:F,active_onboarding_step:p,style:s},r={label:L(K?"Hide deleted files":"Show deleted files"),spriteName:K?"trash-can-open":"trash-can",performAction:P,style:s},H=[],t.isInsideDeletedSharedFolder?H.push({label:L("Re-add shared folder"),spriteName:"restore",performAction:v,style:s}):t.isInsideDeletedFolder||t.isInsideDeletedNestedSharedFolder?H.push({label:L("Restore folder"),spriteName:"restore",performAction:T,style:s}):!B&&C?M?H=H.concat([Y,o,n,i,r]):(H.push(Y),H.push({label:L("New folder"),spriteName:"folder_add",dropdownItems:[o,n,i],disabled:F,style:R.INLINE}),H.push(r)):(f=C?R.INLINE_WITH_TEXT:s,m={label:L("New folder"),spriteName:"folder_add",performAction:b,disabled:F,style:f},j={label:k(t,B),tooltip:l?c:void 0,spriteName:"rainbow_16",performAction:E,active_onboarding_step:l,style:Q},H=B?A.confidentialFolderAware(Z.id)&&"/"===t.currentFQPath?H.concat([Y,m]):U?H.concat([Y,j,m]):H.concat([j,Y,m]):H.concat([Y,m,j]),H=H.filter(function(e){return null!=e}),S.HIDE_TRASH_CAN_BUTTON||H.push(r)),H},M=s.createClass({displayName:"GlobalActions",propTypes:{shouldShowDeletedFiles:s.PropTypes.bool.isRequired,context:s.PropTypes.instanceOf(P).isRequired,user:s.PropTypes.instanceOf(v).isRequired,onFileUpload:s.PropTypes.func.isRequired,isActionsBarDisabled:s.PropTypes.bool.isRequired},getInitialState:function(){return{isHeaderFixed:!0}},componentDidMount:function(){return this._handleWindowResize(),e(window).on("resize.globalActionButtons",r.throttle(this._handleWindowResize,30))},componentWillUnmount:function(){return e(window).off("resize.globalActionButtons")},_renderButton:function(e){var t,s,r,o,n,i;return s=e.buttonClasses,o=e.message,i=e.spriteName,n=e.onClick,r=e.disabled,t=H.button({className:B(s),disabled:r,onClick:n},U(m,{className:"global-actions__button-sprite",group:"web",name:i,alt:o})),r||(t=this._wrapWithTitleBubble(t,o)),t},_renderButtonWithText:function(e){var t,s,r,o,n;return t=e.buttonClasses,r=e.message,n=e.spriteName,o=e.onClick,s=e.disabled,H.button({className:B(t,"button-as-link"),disabled:s,onClick:o},U(f,{className:"global-actions__button-sprite",group:"web",name:n,text:r,alt:"",spritePosition:"left"}))},_handleWindowResize:function(){var t;return t="fixed"===e(".browse-header").css("position"),this.setState({isHeaderFixed:t})},_wrapWithTitleBubble:function(e,t){return U(o,{content:t,position:o.POSITIONS.BOTTOM,distanceFromTarget:-3,isTargetPositionFixed:this.state.isHeaderFixed},e)},_wrapInlineButton:function(e,t){return H.li({className:"global-actions__action",key:t},e)},_renderInlineItem:function(e){var t,s,r,o;switch(s={"global-actions__button":!0,"sprite-button":!0,"global-actions__button--onboarding":null!=e.active_onboarding_step},r={buttonClasses:s,message:e.tooltip||e.label,spriteName:e.spriteName,onClick:e.performAction,disabled:e.disabled||this.props.isActionsBarDisabled},e.style){case R.INLINE_WITH_TEXT:t=this._renderButtonWithText(r);break;default:t=this._renderButton(r)}return null!=e.dropdownItems&&(o=e.style===R.INLINE_WITH_TEXT?4:8,t=this._renderDropdownButton(t,e.dropdownItems,o)),t},_renderDropdownButton:function(e,t,s){return U(C,{className:"global-actions__dropdown",targetButton:e,targetFixed:this.state.isHeaderFixed,items:this._renderDropdownItems(t),position:C.POSITIONS.BOTTOM_RIGHT,verticalDisplacement:s})},_renderDropdownItems:function(e){var t,s,r,o,n;for(t=[],r=0,n=e.length;n>r;r++)o=e[r],s=o.disabled||this.props.isActionsBarDisabled,t.push(U(F,{onClick:o.performAction,disabled:s},H.div({className:"sprite-div"},H.div({className:B(["sprite-frame","small","icon-left"])},U(m,{alt:"",group:"web",name:o.spriteName})),H.div({className:B(["sprite-text"])},H.h3({className:B(["global-actions__dropdown__item-label","u-trim-margin","u-font-strong"])},o.label),H.p({className:B(["global-actions__dropdown__item-sublabel","u-font-meta"])},o.sublabel),o.sublabelLine2?H.p({className:B(["global-actions__dropdown__item-sublabel-line2","u-font-meta"])},o.sublabelLine2):void 0))));return t},render:function(){var e,t,s,r,o,n;return n=this.props.context.isNonUserRelativeContext?W({context:this.props.context,user:this.props.user,showDeletedFiles:this.props.shouldShowDeletedFiles,onFileUpload:this.props.onFileUpload}):G({context:this.props.context,user:this.props.user,showDeletedFiles:this.props.shouldShowDeletedFiles,onFileUpload:this.props.onFileUpload,isContextMenu:!1}),t=function(){var e,t,s;for(s=[],e=0,t=n.length;t>e;e++)o=n[e],s.push(this._renderInlineItem(o));return s}.call(this),s={"global-actions":!0,"u-mar-top-xs":!0},H.div({className:B(s)},H.ul({className:"horizontal"},function(){var s,o,n;for(n=[],r=s=0,o=t.length;o>s;r=++s)e=t[r],n.push(this._wrapInlineButton(e,r));return n}.call(this)))}}),{getGlobalActions:G,GlobalActions:M}})}.call(this),function(){define("modules/clean/react/browse/internal_drag_status",["external/immutable","external/react","jquery","modules/clean/react/sprite"],function(e,t,s,r){var o,n,i;return i=t.DOM,n=t.createElement,o=t.createClass({displayName:"InternalDragStatus",mixins:[t.addons.PureRenderMixin],propTypes:{files:t.PropTypes.array.isRequired},render:function(){return i.div({id:"drag-status",className:"active"},i.div({id:"drag-selection-status"},this.props.files.slice(0,4).map(function(e,t){return e.thumbnail_url_tmpl?i.img({key:t,src:e.thumbnail_url_tmpl,className:"icon icon"+t,alt:""}):n(r,{key:t,group:"web",name:e.icon,className:"icon icon"+t,alt:""})}),i.span({className:"badge"},this.props.files.length)))}}),{InternalDragStatus:o}})}.call(this),function(){define("modules/clean/react/browse/item_list",["jquery","external/classnames","external/immutable","external/keymaster","external/react","external/react-dom","external/underscore","modules/clean/components/loading_indicator","modules/clean/filepath","modules/clean/keycode","modules/clean/react/browse/actions","modules/clean/react/browse/constants","modules/clean/react/browse/file_list_empty_folder","modules/clean/react/browse/internal_drag_status","modules/clean/react/browse/keyboard_shortcuts","modules/clean/react/browse/models","modules/clean/react/browse/file_list_utils","modules/clean/react/browse/store","modules/clean/react/columnheader","modules/clean/react/css","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/store","modules/clean/react/helpers","modules/clean/react/modal","modules/clean/react/selectable_list","modules/clean/react/sprite","modules/clean/search/actions","modules/clean/sharing/ui_util","modules/clean/undo","modules/clean/viewer","modules/core/accessible_announce","modules/core/browser","modules/core/i18n","modules/core/notify","modules/clean/react/browse/item_list_row","modules/clean/react/browse/folder_list_row","modules/clean/react/file_viewer/controller","modules/clean/react/browse/file_jump","modules/clean/unity_browse_interface"],function(e,t,s,r,o,n,i,a,l,u,p,d,c,h,m,f,_,g,b,v,y,S,w,T,D,E,I,P,N,C,F,M,R,A,x,O,L,k,U){var B,H,q,G,W,V,z,j,Q,K,Y,X,Z,$,J,ee,te,se,re,oe,ne,ie,ae,le,ue,pe,de,ce,he,me,fe,_e,ge,be,ve,ye;return j=d.CulledListConstants,G=d.BrowseSortField,Q=d.DropTargetHighlightMode,oe=d.LoadingStates,ie=d.NewFolderCreationState,te=h.InternalDragStatus,K=f.File,le=f.Paper,q=f.BrowseContext,Z=f.FileRename,X=_.FileListHelpers,W=g.BrowseStore,V=b.ColumnHeader,z=b.ColumnTypes,pe=b.SortDirections,de=y.UploaderActions,J=S.INTERNAL_FILE_DATA_TRANSFER_TYPE,ve=w.shallowCompareStateAndProps,ne=T.Modal,me=D.createSelectableList,fe=D.createSelection,$=P.GoldenGate,ce=R._,Y=x.FileItemRow,ue=x.PaperItemRow,_e=o.DOM,he=o.createElement,ee="ItemList",ae="",ge={},H="undefined"!=typeof window&&null!==window?e(window):null,B="undefined"!=typeof document&&null!==document?e(document.documentElement):null,se=me(o.createClass({displayName:"ItemList",propTypes:{user:o.PropTypes.object.isRequired,context:o.PropTypes.instanceOf(q).isRequired,path:o.PropTypes.string.isRequired,rowHeight:o.PropTypes.number,isMaestroDesign:o.PropTypes.bool,selectedFiles:o.PropTypes.instanceOf(s.OrderedSet),isBrowseInContentManager:o.PropTypes.bool,isRenaming:o.PropTypes.bool,itemListLength:o.PropTypes.number,openContextMenuAtPosition:o.PropTypes.func,onFocus:o.PropTypes.func,focusSelectedRow:o.PropTypes.func,className:o.PropTypes.string,actionHandlers:o.PropTypes.object},getDefaultProps:function(){return{rowHeight:j.ITEM_ROW_HEIGHT_PX,isMaestroDesign:!1,selectedFiles:s.OrderedSet(),isDraggingExternalFiles:!1,activeDropTarget:!1,isRenaming:!1,onFocus:function(){return{}},isBrowseInContentManager:!1,className:null,actionHandlers:{}}},componentWillMount:function(){return W.startSpan(this.constructor.displayName),this.isFocused=!1},componentDidMount:function(){return e(document).on("keydown.ItemList",this.handleKeyDown).on("keypress.ItemList",this.handleKeyPress).on("keyup.ItemList",this.handleKeyUp),this._setupFocusHandler(),this._setupExternalDragHandler(),this._setupKeyboardShortcuts(),W.endSpan(this.constructor.displayName)},componentWillUnmount:function(){return key.clearScope(ee),key.setScope(ae),e(document).off(".ItemList"),e(n.findDOMNode(this)).off(".ItemList")},_setupFocusHandler:function(){var t;return t=e(n.findDOMNode(this)),t.on("focusin.ItemList",function(e){return function(){return e.isFocused=!0,e.props.onFocus(),!0}}(this)),t.on("focusout.ItemList",function(e){return function(){return e.isFocused=!1,!0}}(this))},_setupExternalDragHandler:function(){return e(document).on("dragenter.ItemList",function(t){return function(s){return(t.props.isDraggingExternalFiles||t.props.isDraggingInternalFiles)&&!e(s.target).closest(".browse-file-row").length&&t.props.activeDropTarget?(p.setDropTarget({target:null}),de.setPath({path:t.props.path,hasPermissionToUploadToFolder:t.props.context.isCurrentPathWriteable()})):void 0}}(this))},_setupKeyboardShortcuts:function(){var t,s,r,o,i,a,l,u,d,c,h,f,_,g;return ae=key.getScope(),key.setScope(ee),i=function(e){return function(t){return e.isFocused&&"BUTTON"!==t.target.tagName}}(this),a=function(e){return function(t){return e.isFocused&&"BUTTON"!==t.target.tagName&&"A"!==t.target.tagName}}(this),o=function(e){return function(t){return!document.activeElement||document.activeElement===document.body||n.findDOMNode(e).contains(t.target)}}(this),r=function(e,t){var s;return s=function(s){return e(s)?(s.preventDefault(),"function"==typeof t?t(s):void 0):void 0}},d=function(e){return function(){return 1===e.props.selectedFiles.size&&e.props.selectedFiles.first().is_dir?p.navigateToFileOrFolder({file:e.props.selectedFiles.first()}):void 0}}(this),u=function(e){return function(){return 1===e.props.selectedFiles.size?p.navigateToFileOrFolder({
file:e.props.selectedFiles.first(),onFileViewerUnmount:e.props.focusSelectedRow}):void 0}}(this),h=function(e){return function(){var t;return 1===e.props.selectedFiles.size?e.props.context.isCurrentPathWriteable()?(t=e.props.selectedFiles.first(),t.isDeleted?A.error(ce("Deleted files can’t be renamed.")):p.showFileRename({file:t})):A.warning(ce("You don’t have permission to rename files in this folder.")):void 0}}(this),t=function(){return p.copySelectedFilesToClipboard()},c=function(){return p.pasteClipboardFilesToCurrentPath()},g=function(){return N.perform_undo()},_=function(){var e;return e=he(m),ne.showInstance(e)},l=function(){return p.navigateToParentFolder()},f=function(t){return function(s){var r,o,n,i,a,l;if(!t.props.isMaestroDesign)return t.props.selectedFiles.size?(l=e(s.target).closest(".browse-file-row--is-selected").first(),l.length?(i=l[0].offsetLeft+200,a=l[0].offsetTop+5,n=l.get(0),"function"==typeof(r=t.props).openContextMenuAtPosition?r.openContextMenuAtPosition(i,a,n):void 0):void 0):"function"==typeof(o=t.props).openContextMenuAtPosition?o.openContextMenuAtPosition(10,10):void 0}}(this),s=function(){return e(".search-bar__text-input").focus()},key("right",ee,r(i,d)),key("enter",ee,r(a,u)),key("f2",ee,r(i,h)),key("left",ee,r(o,l)),key("/",ee,r(o,s)),key("alt+a",ee,r(o,f)),key("shift+/",ee,r(o,_)),M.mac?(key("command+c",ee,r(i,t)),key("backspace",ee,r(i,this.props.actionHandlers.onDelete)),key("command+v",ee,r(o,c)),key("command+z",ee,r(o,g))):(key("ctrl+c",ee,r(i,t)),key("delete",ee,r(i,this.props.actionHandlers.onDelete)),key("ctrl+v",ee,r(o,c)),key("ctrl+z",ee,r(o,g)))},handleKeyDown:function(e){var t,s;return t=null!=(s=e.which)?s:e.keyCode,t===u.CONTROL||t===u.ALT?p.setCopyMode({copyMode:!0}):void 0},handleKeyPress:function(e){return key.getScope()===ee?k.handleKeyPress(e):void 0},handleKeyUp:function(e){var t,s;return t=null!=(s=e.which)?s:e.keyCode,t===u.CONTROL||t===u.ALT?p.setCopyMode({copyMode:!1}):void 0},getFocusHandler:function(e){return function(t){return function(){return t.isFocused=e,!0}}(this)},render:function(){var e;return e=t(this.props.className,{"browse-files o-list-ui":!this.props.isBrowseInContentManager,"browse-files__content-manager":this.props.isBrowseInContentManager,"browse-files--single-selection":1===this.props.selectedFiles.size}),_e.div({},"undefined"!=typeof RUNNING_IN_REACTSERVER&&null!==RUNNING_IN_REACTSERVER?_e.ul({className:e,role:"presentation"},this.props.children):_e.ul({className:e,role:"presentation",style:{display:"block",position:"relative",height:this.props.itemListLength*this.props.rowHeight}},this.props.children))}})),re=o.createClass({displayName:"ItemListController",propTypes:{context:o.PropTypes.instanceOf(q).isRequired,items:o.PropTypes.instanceOf(s.List).isRequired,user:o.PropTypes.object.isRequired,path:o.PropTypes.string.isRequired,isMaestroDesign:o.PropTypes.bool,isSearchMode:o.PropTypes.bool,selection:o.PropTypes.shape({selected:o.PropTypes.instanceOf(s.OrderedSet),anchor:o.PropTypes.string}),selectedFiles:o.PropTypes.instanceOf(s.OrderedSet),createNewFolderState:o.PropTypes.oneOf(i.values(ie)),customEmptyFolderView:o.PropTypes.func,dropTargetHighlightMode:o.PropTypes.oneOf(function(){var e;e=[];for(be in Q)ye=Q[be],e.push(ye);return e}()),fileRename:Z.propTypes,isArchiveState:o.PropTypes.bool,isBrowseInContentManager:o.PropTypes.bool,isSyncColumnVisible:o.PropTypes.bool,isTextSelectable:o.PropTypes.bool,loadingState:o.PropTypes.oneOf(i.values(oe)),mostRecentlyDraggedOverFile:o.PropTypes.instanceOf(K),openContextMenuAtPosition:o.PropTypes.func,isDraggingExternalFiles:o.PropTypes.bool,isDraggingInternalFiles:o.PropTypes.bool,activeDropTarget:o.PropTypes.object,onSelectionChange:o.PropTypes.func,showFilenameHighlights:o.PropTypes.bool,disableColumnDetail:o.PropTypes.bool,enableDoubleClickTraversal:o.PropTypes.bool,onFocus:o.PropTypes.func,settingsGearMenuAlt:o.PropTypes.string,settingsGearMenuItems:o.PropTypes.arrayOf(o.PropTypes.shape({label:o.PropTypes.string,action:o.PropTypes.func})),activeSortField:o.PropTypes.oneOf(i.values(G)),activeSortDirection:o.PropTypes.oneOf(i.values(pe)),onSortChange:o.PropTypes.func,initialMultiColumnSortField:o.PropTypes.string,actionHandlers:o.PropTypes.object,handleComponentTTI:o.PropTypes.func,expBizTeamFolderOnboardingVariant:o.PropTypes.string},getDefaultProps:function(){return{isMaestroDesign:!1,isSearchMode:!1,selection:fe(),selectedFiles:s.OrderedSet(),createNewFolderState:ie.CREATE_FOLDER_INACTIVE,customEmptyFolderView:null,dropTargetHighlightMode:Q.NONE,fileRename:null,isArchiveState:!1,isColumnHeaderVisible:!0,isMultiColumnGroupVisible:!0,isBrowseInContentManager:!1,isPaginating:!1,isSyncColumnVisible:!1,isTextSelectable:!0,mostRecentlyDraggedOverFile:null,shouldHighlightDropTargets:!1,shouldHighlightNonselectedDropTargets:!1,showFilenameHighlights:!1,disableColumnDetails:!1,enableDoubleClickTraversal:!0,isDraggingExternalFiles:!1,isDraggingInternalFiles:!1,onFocus:function(){return{}},activeSortField:null,activeSortDirection:null,onSortChange:function(){return{}},initialMultiColumnSortField:null,handleComponentTTI:function(){return{}}}},getInitialState:function(){var e;return{activeMultiColumnField:this.props.initialMultiColumnSortField,viewportHeight:("undefined"!=typeof document&&null!==document&&null!=(e=document.documentElement)?e.clientHeight:void 0)||0,rowHeight:this.getRowHeight(this.props),scrollPosition:0,lastSelectedItemIndex:-1,arrowingDown:!1}},componentWillMount:function(){return W.startSpan(this.constructor.displayName)},componentDidMount:function(){return W.endSpan(this.constructor.displayName),window.addEventListener("scroll",this.updateOnScroll),window.addEventListener("resize",this.updateOnResize),this.props.selection.selected.size&&!L.isShown()&&this.scrollItemRowsIntoView(),this.props.loadingState!==oe.LOADING_FIRST_PAGE?this.props.handleComponentTTI(this.constructor.displayName):void 0},componentWillUnmount:function(){return window.removeEventListener("scroll",this.updateOnScroll),window.removeEventListener("resize",this.updateOnResize)},shouldComponentUpdate:ve,componentDidUpdate:function(e){var t;return this.props.loadingState!==oe.LOADING_FIRST_PAGE&&this.props.handleComponentTTI(this.constructor.displayName),e.items!==this.props.items&&U.browse_visible_change_callback(this.props.items.toArray(),this.props.user.id,0,this.props.items.size-1),t=this.props.selection.selected.subtract(e.selection.selected),(t.size&&!L.isShown()&&!this.allSelected()||this.props.createNewFolderState!==ie.CREATE_FOLDER_INACTIVE)&&this.scrollItemRowsIntoView(),e.loadingState!==this.props.loadingState&&this.props.loadingState===oe.LOADED?F.polite(ce("Finished loading files")):void 0},componentWillReceiveProps:function(e){var t,s,r,o,n,i;return null!=(null!=(i=e.selection)?i.selected:void 0)?(o=this.props.selection.selected.last(),n=this.getIndexOfItem(o),t=e.selection.selected.last(),s=this.getIndexOfItem(t,e.items),r={lastSelectedItemIndex:s,arrowingDown:!1},s-n===1&&(r.arrowingDown=!0),this.setState(r)):this.setState({lastSelectedItemIndex:-1}),this.setState({rowHeight:this.getRowHeight(e)})},focusSelectedRow:function(){var t,s,r;return s=this.props.selectedFiles.first(),s&&(r=this.getIndexOfItem(s.fq_path),t=e(n.findDOMNode(this)).find(".browse-files .browse-file-row:eq("+r+")"),!t.is(":focus"))?t.focus():void 0},getRowHeight:function(e){var t;return t=j.ITEM_ROW_HEIGHT_PX,e.isMaestroDesign?t=e.isSearchMode?j.MAESTRO_SEARCH_ROW_HEIGHT_PX:j.MAESTRO_ITEM_ROW_HEIGHT_PX:e.isSearchMode&&(t=j.SEARCH_ROW_HEIGHT_PX),t},getIndexOfItem:function(e,t){var s;return null==t&&(t=this.props.items),s=t.findIndex(function(t){return t instanceof K?l.paths_are_equal(t.fq_path,e):t instanceof le?t.pad_id===e:void 0})},scrollItemRowsIntoView:function(){var t,s,r,o,n,i,a,l;if(o=this.state.lastSelectedItemIndex,r=1,o>=0){if(s="fixed"===e(".browse-header").css("position"),l=s?parseInt(e(".browse-files").css("marginTop"))||j.DEFAULT_HEADER_HEIGHT_PX:0,t=this.state.viewportHeight-l-this.state.rowHeight-r,n=o*this.state.rowHeight-r,a=this.state.scrollPosition,i=this.state.scrollPosition+t,n>=a&&i>=n)return;return a>n?H.scrollTop(n):this.state.arrowingDown?H.scrollTop(n-t+r):H.scrollTop(n-Math.round(t/2)+r)}},getSharedWithTitle:function(){return ce($.hasAudienceBox(this.props.user.id)||$.hasNewMembershipUI(this.props.user.id)?"Members":this.props.context.isInsideSharedFolder?"Additional sharing":"Shared with")},anySelected:function(){return this.props.selectedFiles.size>0},allSelected:function(){return this.props.selectedFiles.size===this.props.items.size},selectNone:function(){return this.props.onSelectionChange(this.props.selection.set("selected",s.OrderedSet([])))},selectAll:function(){var e;return this.props.onSelectionChange(this.props.selection.set("selected",s.OrderedSet(function(){var t,s,r,o;for(r=this.props.items.toArray(),o=[],t=0,s=r.length;s>t;t++)e=r[t],o.push(e.fq_path);return o}.call(this))))},toggleSelectAll:function(){return this.anySelected()?this.selectNone():this.selectAll()},_getColumns:function(){var e,s,r;return r=[{type:z.SINGLE,label:ce("Name"),headerClassName:"o-grid__col o-grid__col--6-of-12",sortField:G.FILENAME},{type:z.SINGLE,label:ce("Modified"),headerClassName:"o-grid__col o-grid__col--3-of-12",sortField:G.MODIFIED},{type:z.MULTI,columns:[{label:this.getSharedWithTitle(),headerClassName:"o-grid__col o-grid__col--3-of-12",sortField:G.SHARED_WITH},{label:ce("Kind"),headerClassName:"o-grid__col o-grid__col--3-of-12",sortField:G.CATEGORY},{label:ce("Extension"),headerClassName:"o-grid__col o-grid__col--3-of-12",sortField:G.EXTENSION},{label:ce("Size"),headerClassName:"o-grid__col o-grid__col--3-of-12",sortField:G.SIZE}]},{type:z.STATIC,label:ce("Actions"),headerClassName:"ax-visually-hidden"}],this.props.isMaestroDesign?(s=this.anySelected(),e=this.allSelected(),r.unshift({type:z.STATIC,content:_e.div({className:t({"file-select-checkbox":!0,"show-boxes":s}),key:"selection_toggle_column",role:"gridcell"},_e.button({role:"checkbox","aria-checked":e,"aria-label":ce("Select all"),className:t({"partial-checked":s&&!e,"checkbox-button":!0,checked:e}),onClick:function(e){return e.target.blur()},onMouseDown:function(e){return function(t){return e.toggleSelectAll(),t.target.blur()}}(this)})),headerClassName:"select-all-checkbox"})):r.unshift({type:z.STATIC,label:ce("Row selection"),headerClassName:"ax-visually-hidden"}),r},handleDragStart:function(e,t,s){var r,o,i,a,l,u;return null==t&&(t=[]),null==s&&(s=!0),u=s?this.props.selectedFiles.union(t).toArray():t,$.canDeepNest(this.props.user.id)&&(i=u.some(function(e){return K.isTeamSharedFolder(e)}))?void A.error(ce("Team Folders can’t be moved.")):(o=u.some(function(e){return K.isTeamMemberFolder(e)}))?void A.error(ce("Your Team Member Folder can’t be moved.")):(a={userId:this.props.user.id,fromPath:this.props.path,filePaths:function(){var e,t,s;for(s=[],e=0,t=u.length;t>e;e++)l=u[e],s.push(l.fq_path);return s}()},null!=e.dataTransfer?("function"==typeof(r=e.dataTransfer).setDragImage&&r.setDragImage(n.findDOMNode(this.refs.dragIcon),-10,-10),e.dataTransfer.setData(J,JSON.stringify(a)),e.dataTransfer.effectAllowed="copyMove"):void 0)},_renderPaperRow:function(e,t,s){var r;return r=this.state.rowHeight*t,he(ue,{paper:e,key:e.pad_id,topOffsetPx:r,rowIndex:t,totalRowCount:s,showTitleHighlights:!0,isMaestroDesign:this.props.isMaestroDesign})},_renderFileRow:function(e,t,s){var r,o,n,i,a,l,u,p,d,c,h;return a=this.props.selection.selected.has(e.fq_path),o=X.shouldFileBeHighlightedDropTarget({file:e,isSelected:a,dropTargetHighlightMode:this.props.dropTargetHighlightMode}),i=e===this.props.activeDropTarget,(null!=(u=this.props.fileRename)?u.file:void 0)===e&&(d=null!=(p=this.props.fileRename)?p.state:void 0),l=this.props.selection.selected.last()===e.fq_path||!this.props.selection.selected.size&&0===t,n=[e.hashCode(),t,d,o,i,l,this.props.selectedFiles.count()].join("_"),n in ge?ge[n]:(h=this.state.rowHeight*t,c=this.props.context.isNonUserRelativeContext&&e.isDeleted?null:this.props.settingsGearMenuItems,r=he(Y,{selectableListId:e.fq_path,key:encodeURI(e.fq_path),file:e,user:this.props.user,isTabbable:l,enableDoubleClickTraversal:this.props.enableDoubleClickTraversal,isMaestroDesign:this.props.isMaestroDesign,isSearchMode:this.props.isSearchMode,topOffsetPx:h,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isAvailableDropTarget:o,isActiveDropTarget:i,isArchiveState:this.props.isArchiveState,isModifiedColumnVisible:this.props.isModifiedColumnVisible,isSyncColumnVisible:this.props.isSyncColumnVisible,isMultiColumnGroupVisible:this.props.isMultiColumnGroupVisible,isTextSelectable:this.props.isTextSelectable,context:this.props.context,renameState:d,loadingState:this.props.loadingState,rowIndex:t,totalRowCount:s,settingsGearMenuAlt:this.props.settingsGearMenuAlt,settingsGearMenuItems:c,showColumnDetail:!this.props.isColumnHeaderVisible&&!this.props.disableColumnDetails,showFilenameHighlights:this.props.showFilenameHighlights,showCheckboxes:this.props.selectedFiles.count()>0,selectedFilesCount:this.props.selectedFiles.count(),onDragStart:this.handleDragStart}),ge[n]=r,r)},_renderLoadingIndicator:function(e,s){var r,o;return r=["u-font-center item-list-loading-indicator-wrapper",{"u-pad-top-m":!this.props.isMaestroDesign}],o={className:t(r),key:"loadingIndicator"},"undefined"!=typeof RUNNING_IN_REACTSERVER&&null!==RUNNING_IN_REACTSERVER||(o.style={position:"absolute",top:s*this.state.rowHeight||0,width:"100%"}),_e.li(o,he(a,{style:a.LoadingIndicatorStyle.BLUE_SPINNER,startMessage:e}))},_renderEmptyFolder:function(){var e;return e=this.props.context.isInsideAutoTeamFolder&&1===this.props.path.match(/\//g).length,he(c,{currentSharedFolderPermissionRole:this.props.context.currentSharedFolderPermissionRole,isArchiveState:this.props.isArchiveState&&!this.props.context.isInsideArchivedTeamFolder,isBrowseInContentManager:this.props.isBrowseInContentManager,isInsideSharedFolder:this.props.context.isInsideSharedFolder,isViewingTeamFolder:e,isInCdmMve:Boolean(this.props.context.cdmMveQuotaStats),userId:this.props.user.id,userFamiliarName:this.props.user.familiar_name,expBizTeamFolderOnboardingVariant:this.props.expBizTeamFolderOnboardingVariant})},_getPerformanceHackColumnClassName:function(){switch(this.state.activeMultiColumnField){case G.SHARED_WITH:return"is-sharedwith-column-visible";case G.CATEGORY:return"is-kind-column-visible";case G.EXTENSION:return"is-extension-column-visible";case G.SIZE:return"is-size-column-visible"}},_renderItemList:function(e){var t,s,r,o;return r=this.props.items.toArray(),o=0,e&&(o+=1),this.props.loadingState===oe.LOADING_REMAINING_PAGES&&(o+=1),t=this.props.loadingState===oe.LOADING_FIRST_PAGE?0:r.length+o,he(se,{ref:"itemList",allItemIds:this.props.items.map(function(e){return e.fq_path}),user:this.props.user,path:this.props.path,context:this.props.context,rowHeight:this.state.rowHeight,isMaestroDesign:this.props.isMaestroDesign,selectedFiles:this.props.selectedFiles,isBrowseInContentManager:this.props.isBrowseInContentManager,isRenaming:!!this.props.fileRename,openContextMenuAtPosition:this.props.openContextMenuAtPosition,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,itemListLength:t,activeDropTarget:this.props.activeDropTarget,keyScope:ee,linkedOutsideClasses:[".bubble-menu-item-wrapper",".browse-menu",".context-menu",".react-file-viewer",".db-modal"],selection:this.props.selection,onFocus:this.props.onFocus,onSelectionChange:this.props.onSelectionChange,focusSelectedRow:this.focusSelectedRow,className:this._getPerformanceHackColumnClassName(),actionHandlers:this.props.actionHandlers,isCheckboxes:this.props.isMaestroDesign},this.props.loadingState===oe.LOADING_FIRST_PAGE?this._renderLoadingIndicator(ce("Loading files…")):r.length||e?this._renderItemRows(r,e):("function"==typeof(s=this.props).customEmptyFolderView?s.customEmptyFolderView():void 0)||this._renderEmptyFolder())},_renderCreateFolderUI:function(){return he(O,{newFolderState:this.props.createNewFolderState,context:this.props.context,user:this.props.user,topOffsetPx:0})},_renderItemRows:function(e,t){var s,r,o,n,i,a,l,u,p,d,c,h,m,f,_,g,b,v,y,S,w,T,D,E,I,P,N,C,F;if(E=[],D=function(e){return function(t,s,r){return t instanceof K?E.push(e._renderFileRow(t,s,r)):t instanceof le?E.push(e._renderPaperRow(t,s,r)):void 0}}(this),"undefined"!=typeof RUNNING_IN_REACTSERVER&&null!==RUNNING_IN_REACTSERVER){for(i=n=0,c=e.length;c>n;i=++n)a=e[i],D(a,i+1,e.length);return this.props.loadingState===oe.LOADING_REMAINING_PAGES&&E.push(this._renderLoadingIndicator(ce("Loading files…"),e.length)),E}for(y=0,v=0,t&&(y=1),this.props.loadingState===oe.LOADING_REMAINING_PAGES&&(v=1),T=e.length,F=T+y+v,g=Math.ceil(this.state.viewportHeight/this.state.rowHeight)+2*j.ITEM_BUFFER_SIZE,S=Math.min(F,g),C=Math.max(0,this.state.scrollPosition-j.ITEM_BUFFER_SIZE*this.state.rowHeight),N=Math.min(Math.floor(C/this.state.rowHeight),F-S),r=Math.min(N+S-1,F-1),s=e.slice(N,+r+1||9e9),d=this.state.lastSelectedItemIndex,l=[],u=[],d>=0&&(N>d?(o=Math.max(0,d-1),p=Math.min(d+1,N-1),l=function(){I=[];for(var e=o;p>=o?p>=e:e>=p;p>=o?e++:e--)I.push(e);return I}.apply(this)):d>r&&(o=Math.max(r+1,d-1),p=Math.min(d+1,T-1),u=function(){P=[];for(var e=o;p>=o?p>=e:e>=p;p>=o?e++:e--)P.push(e);return P}.apply(this))),_=0,h=l.length;h>_;_++)i=l[_],a=e[i],D(a,i+y,F);for(b=0,m=s.length;m>b;b++)a=s[b],D(a,N+y,F),N+=1;for(p=N,w=0,f=u.length;f>w;w++)i=u[w],a=e[i],D(a,i+y,F);return t&&E.unshift(this._renderCreateFolderUI()),this.props.loadingState===oe.LOADING_REMAINING_PAGES&&E.push(this._renderLoadingIndicator(ce("Loading files…"),p)),E},updateOnResize:function(){var e;return e=document.documentElement.clientHeight,this.state.viewportHeight!==e?this.setState({viewportHeight:e}):void 0},updateOnScroll:function(){var e;return e=H.scrollTop(),(0!==e||"fixed"!==B.css("position"))&&null!=e&&this.state.scrollPosition!==e?this.setState({scrollPosition:e}):void 0},handleMultiColumnChange:function(e){return this.setState({activeMultiColumnField:e.sortField})},renderColumnHeader:function(){var e;return e=["browse-file-list-header o-grid o-grid--no-gutter",{"ax-visually-hidden":!this.props.isMaestroDesign&&this.props.selection.selected.size||this.props.isMaestroDesign&&!this.props.items.size}],he(V,{columns:this._getColumns(),className:t(e),tabbable:this.props.isMaestroDesign?!0:!this.props.selection.selected.size,disabled:this.props.loadingState!==oe.LOADED,activeSortField:this.props.activeSortField,initialMultiColumnSortField:this.state.activeMultiColumnField,activeSortDirection:this.props.activeSortDirection,onSortChange:this.props.onSortChange,onMultiColumnChange:this.handleMultiColumnChange})},render:function(){var e;return e=this.props.createNewFolderState!==ie.CREATE_FOLDER_INACTIVE,_e.div({role:"grid","aria-readonly":"true"},this.props.isColumnHeaderVisible?this.renderColumnHeader():void 0,this._renderItemList(e),_e.div({className:"offscreen-drag-icon",ref:"dragIcon"},this.props.selectedFiles.count()?he(te,{files:this.props.selectedFiles.toArray()}):void 0))}}),{ItemListController:v(re,["/static/css/scooter/scooter-scoped-vflATcSDK.css","/static/css/components/loading_indicator-vflbadB1S.css","/static/css/browse/browse-vflc_FrK9.css"]),ItemList:se}})}.call(this),function(){define("modules/clean/react/browse/item_list_row",["jquery","external/underscore","external/classnames","external/react","external/react-dom","modules/clean/analytics","modules/clean/browse_interface","modules/clean/css","modules/clean/filepath","modules/clean/keycode","modules/clean/viewer","modules/clean/react/browse/action_logger","modules/clean/react/browse/actions","modules/clean/react/browse/constants","modules/clean/react/browse/name_input","modules/clean/react/browse/settings_gear_menu","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/browse/render_partials","modules/clean/react/content_manager/api","modules/clean/react/file_uploader/actions","modules/clean/react_format","modules/clean/react/selectable_list","modules/clean/react/sprite","modules/clean/search/search_helpers","modules/clean/sharing/share_modal_util","modules/clean/sharing/ui_util","modules/clean/user_education/user_education_client","modules/constants/env","modules/core/dom","modules/core/i18n","modules/core/uri","modules/clean/react/browse/share_button","modules/clean/react/browse/shared_with","modules/clean/react/flag","modules/clean/react/helpers","modules/clean/user_education/user_education_client"],function(e,t,s,r,o,n,i,a,l,u,p,d,c,h,m,f,_,g,b,v,y,S,w,T,D,E,I,P,N,C,F,M,R,A,x,O,L){var k,U,B,H,q,G,W,V,z,j,Q,K,Y,X,Z,$,J,ee,te,se,re,oe,ne,ie,ae,le,ue,pe,de;return Z=n.TeamsWebActionsLogger,re=i.browse_uri_for_fq_path,ae=i.get_browse_root_name,U=d.BrowseLogger,Q=h.RenameStates,W=h.FileTypes,K=f.SettingsGearMenuBubble,H=_.File,k=_.BrowseContext,z=_.Paper,B=g.BrowseStore,q=b.FileIcon,J=y.UploaderActions,ue=S.reactFormat,ne=w.createSelection,le=E.isShareButtonEnabled,de=E.showSharedContentLinkSyncModal,V=I.GoldenGate,$=P.UEClient,te=N.WEBSERVER,se=F._,Y=R.ShareButton,X=A.SharedWithController,pe=O.shallowCompareStateAndProps,ee=L.UserEducationEffect,ie=r.DOM,oe=r.createElement,G=r.createClass({displayName:"FileItemRow",propTypes:{context:r.PropTypes.instanceOf(k).isRequired,file:r.PropTypes.instanceOf(H).isRequired,user:r.PropTypes.object,columnClasses:r.PropTypes.string,isTabbable:r.PropTypes.bool,enableDoubleClickTraversal:r.PropTypes.bool,isMaestroDesign:r.PropTypes.bool,isSearchMode:r.PropTypes.bool,topOffsetPx:r.PropTypes.number,isSelected:r.PropTypes.bool,isDraggingInternalFiles:r.PropTypes.bool,isDraggingExternalFiles:r.PropTypes.bool,isAvailableDropTarget:r.PropTypes.bool,isActiveDropTarget:r.PropTypes.bool,isArchiveState:r.PropTypes.bool,isTextSelectable:r.PropTypes.bool,isMultiColumnGroupVisible:r.PropTypes.bool,isSyncColumnVisible:r.PropTypes.bool,isModifiedColumnVisible:r.PropTypes.bool,renameState:r.PropTypes.oneOf(t.values(Q)),rowIndex:r.PropTypes.number,showColumnDetail:r.PropTypes.bool,showFilenameHighlights:r.PropTypes.bool,showCheckboxes:r.PropTypes.bool,settingsGearMenuAlt:r.PropTypes.string,settingsGearMenuItems:r.PropTypes.arrayOf(r.PropTypes.shape({label:r.PropTypes.string,action:r.PropTypes.func})),totalRowCount:r.PropTypes.number,selectedFilesCount:r.PropTypes.number,onMouseEnter:r.PropTypes.func,onMouseDown:r.PropTypes.func,onMouseUp:r.PropTypes.func,onDragStart:r.PropTypes.func,onToggleRowSelected:r.PropTypes.func},getDefaultProps:function(){return{columnClasses:"browse-file-row__column o-grid__col o-grid__col--am",isMaestroDesign:!1,isSearchMode:!1,isSelected:!1,isTabbable:!1,enableDoubleClickTraversal:!0,isDraggingInternalFiles:!1,isDraggingExternalFiles:!1,isAvailableDropTarget:!1,isActiveDropTarget:!1,isArchiveState:!1,isTextSelectable:!0,renameState:null,isMultiColumnGroupVisible:!0,isSyncColumnVisible:!1,isModifiedColumnVisible:!0,showColumnDetail:!1,showFilenameHighlights:!1,showCheckboxes:!1,onMouseEnter:null,onMouseDown:null,onMouseUp:null,onToggleRowSelected:null,onFocus:null,onDragStart:function(){}}},getInitialState:function(){return{hasThumbErrored:!1,wasSelectedBeforeMostRecentMouseDown:!1,shouldShowSettingsBubble:!1}},componentDidMount:function(){return a.require_css("/static/css/scooter/scooter-scoped-vflATcSDK.css"),this._isMounted=!0,e(o.findDOMNode(this)).on("dragenter.fileRow",function(e){return function(){var t;if(e.props.isDraggingExternalFiles||e.props.isDraggingInternalFiles){if(t=e.props.file.is_dir&&!(e.props.isSelected&&e.props.isDraggingInternalFiles)){if(e.props.isActiveDropTarget)return;return c.setDropTarget({target:e.props.file}),J.setPath({path:e.props.file.fq_path,hasPermissionToUploadToFolder:!H.isReadOnlySharedFolder(e.props.file)&&e.props.context.isCurrentPathWriteable()})}return c.setDropTarget({target:null}),J.setPath({path:B.path(),hasPermissionToUploadToFolder:e.props.context.isCurrentPathWriteable()})}}}(this)).on("focusin.fileRow",function(e){return function(t){var s;return e.state.focusedIn?void 0:(e.setState({focusedIn:!0}),"function"==typeof(s=e.props).onFocus?s.onFocus(t):void 0)}}(this)).on("focusout.fileRow",function(e){return function(){return e.setState({focusedIn:!1})}}(this)).on("mouseup.fileRow",this.handleMouseUp),this.props.isMaestroDesign?void 0:this._setTabIndices()},componentWillReceiveProps:function(e){return this.props.isSelected&&!e.isSelected?this.setState({wasSelectedBeforeMostRecentMouseDown:!1,shouldShowSettingsBubble:!1}):void 0},shouldComponentUpdate:pe,componentDidUpdate:function(e){return this.props.isMaestroDesign?void 0:this._setTabIndices()},componentWillUnmount:function(){return e(o.findDOMNode(this)).off(".fileRow"),this._isMounted=!1},_setTabIndices:function(){var e,t,s,r,n;for(t=C.getFocusableElementsIn(o.findDOMNode(this),!1),n=[],s=0,r=t.length;r>s;s++)e=t[s],"selection_checkbox"===e.className?n.push(e.tabIndex=-1):this.props.isTabbable?n.push(e.tabIndex=0):n.push(e.tabIndex=-1);return n},handleMouseEnter:function(e){return this.props.isDraggingInternalFiles||this.props.isDraggingExternalFiles?void c.setDropTarget({target:this.props.file}):this.props.onMouseEnter(e)},handleMouseLeave:function(){return this.props.isDraggingInternalFiles||this.props.isDraggingExternalFiles?c.setDropTarget({target:null}):void 0},handleMouseDown:function(e){return this.setState({wasSelectedBeforeMostRecentMouseDown:this.props.isSelected}),this.props.onMouseDown(e)},handleMouseUp:function(e){return this.handleSettingsGearMenuMouseUp(e),this.props.onMouseUp(e)},handleSettingsGearMenuMouseUp:function(t){if(null!=this.props.settingsGearMenuItems){if(this.state.shouldShowSettingsBubble)return this.setState({shouldShowSettingsBubble:!1});if(e.contains(o.findDOMNode(this.refs.settings),t.target))return this.setState({shouldShowSettingsBubble:!0})}},handleFilenameClick:function(e){return this.props.isTextSelectable||(U.logOpenRow({uid:this.props.user.id,entity_type:this.props.file.is_dir?"folder":"file"}),e.button>0||e.shiftKey||e.altKey||e.metaKey||e.ctrlKey)?void 0:(e.preventDefault(),e.stopPropagation(),this.props.file.type===W.TEAM_SHARED_FOLDER&&($.sendEvent(this.constructor.displayName,"TeamFolderClicked"),Z.log("clicked_team_folder_web",{team_id:p.get_viewer().team_id})),this.props.isSearchMode&&this.props.file.is_unmounted?de(this.props.user,this.props.file):(this.props.isSearchMode&&D.logSearchAction(this.props.file,this.props.user,this.props.file.is_dir?"folder_open":"file_view"),c.navigateToFileOrFolder({file:this.props.file,onFileViewerUnmount:this._onViewerUnmount})))},_onViewerUnmount:function(){var e;return this._isMounted&&null!=(e=o.findDOMNode(this))?e.focus():void 0},handleDoubleClick:function(e){return this.props.enableDoubleClickTraversal?this.handleFilenameClick(e):void 0},handleRenameSubmit:function(e){return c.renameFile({file:this.props.file,newName:e})},handleRenameCancel:function(){return c.cancelFileRename({file:this.props.file})},handleDragStart:function(e){return this.props.isMaestroDesign&&!this.props.isSelected?(this.toggleSelected(e),this.props.onDragStart(e,[this.props.file])):this.props.onDragStart(e)},toggleSelected:function(e){return e.stopPropagation(),this.props.onToggleRowSelected(e)},handleCheckboxKeyPress:function(e){var t;return t=e.which||e.keyCode,t===u.SPACE?(e.stopPropagation(),this.toggleSelected(e)):void 0},_renderSelectionToggleColumn:function(){return[this.props.isMaestroDesign?ie.div({className:s({"file-select-checkbox":!0,"show-boxes":this.props.showCheckboxes}),key:"selection_toggle_column",role:"gridcell",onDoubleClick:function(e){return e.stopPropagation()},onClick:function(e){return e.stopPropagation()},onMouseDown:function(e){return function(t){return t.stopPropagation(),e.props.onMouseDown(t)}}(this),onMouseUp:function(e){return function(t){return t.stopPropagation(),e.props.onMouseUp(t)}}(this),onKeyPress:this.handleCheckboxKeyPress},ie.button({role:"checkbox","aria-checked":this.props.isSelected,"aria-label":se("Select row"),onMouseDown:function(e){return e.target.blur()},className:this.props.isSelected?"checkbox-button checked":"checkbox-button"})):ie.div({className:"ax-visually-hidden",key:"selection_toggle_column",role:"gridcell"},ie.input({className:"selection_checkbox",ref:"selectionToggleInput",type:"checkbox","aria-label":se("Select row"),checked:this.props.isSelected,onChange:this.toggleSelected,tabIndex:-1}))]},_renderPlaceholder:function(){return ie.span({"aria-hidden":"true"},"--")},_renderScreenReaderExtraInfo:function(){var e,t;return e=[],this.props.file.isDeleted&&e.push(se("Deleted")),this.props.isSelected&&e.push(se("Selected")),this.props.file.is_dir&&(this.props.file.type===W.SHARED_FOLDER?H.isReadOnlySharedFolder(this.props.file)?e.push(se("Read-only shared folder")):e.push(se("Shared folder")):this.props.file.type===W.TEAM_SHARED_FOLDER?H.isReadOnlySharedFolder(this.props.file)?e.push(se("Read-only team shared folder")):e.push(se("Team shared folder")):e.push(se("Folder"))),e.length>0?(t=" "+e.join(" "),ie.span({className:"ax-visually-hidden"},t)):void 0},_renderFilename:function(){var e,r,o,n,i,a,u,p,d;return e=this.props.file,r=l.filename(e.fq_path),n=this.props.showFilenameHighlights?D.highlightMatchString(r,e.filename_highlights):t.escape(r),a=l.parent_dir(e.fq_path),u=re(this.props.user,a),p="/"===a?ae(this.props.user):this.props.isMaestroDesign?a.slice(1):a,this.props.renameState===Q.PENDING_INPUT?(i=se(e.is_dir?"Rename directory…":"Rename file…"),oe(m,{ref:"nameInput",label:i,defaultValue:l.filename(e.fq_path),onSubmit:this.handleRenameSubmit,onCancel:this.handleRenameCancel,className:"browse-file-row__input"})):this.props.renameState===Q.SAVING_INPUT?ie.span({ref:"renameStatus",role:"status"},se("Renaming…")):(o=null,e.is_unmounted||((null!=(d=this.props.context)?d.isNonUserRelativeContext:void 0)?o=v.BASE_PREFIX+"/home"+e.fq_path:e.is_unmounted||(o=e.href)),ie.div({className:"browse-file-row__name-location"},oe(ee,{containerName:this.constructor.displayName,name:"FileNameLabel-"+this.props.rowIndex,useSpan:!0},ie.a({ref:"filenameLabel",className:s("filename-link u-ellip","browse-file-row__name",this.props.isArchiveState?"browse-file-row__name-archived":void 0),href:o,onDragStart:function(e){return function(t){return e.props.isMaestroDesign||(t.stopPropagation(),e.props.isArchiveState)?void 0:(c.setSelection({selection:ne([e.props.file.fq_path])}),e.props.onDragStart(t,[e.props.file],!1))}}(this),onMouseDown:function(e){return function(t){var s,r;if(!e.props.isMaestroDesign)return r=2===t.button||2===t.buttons,s=t.button>0||t.shiftKey||t.altKey||t.metaKey||t.ctrlKey,!e.props.file.is_dir&&!s||r?void 0:t.stopPropagation()}}(this),onClick:this.handleFilenameClick},ie.span({dangerouslySetInnerHTML:{__html:n}}),this._renderScreenReaderExtraInfo())),this.props.showColumnDetail?ie.div({className:s({"u-ellip":!0,"browse-file-row__location":!0,"u-font-meta":this.props.isMaestroDesign})},this.props.isMaestroDesign?e.is_unmounted?se("not added yet, in %(location)s",{comment:"Describes the parent directory of a file in a list of search results."}).format({location:p}):ie.a({href:u,className:"browse-file-row-location-link",onClick:function(e){return function(t){return e._handleLoadFileLocation(t,a)}}(this)},se("in %(location)s",{comment:"Describes the parent directory of a file in a list of search results."}).format({location:p})):e.is_unmounted?ue(se("not added yet, in <strong>%(location)s</strong>",{comment:"Describes the parent directory of a file in a list of search results."}),{location:p,strong:ie.strong()}):ie.a({href:u,onClick:function(e){return function(t){return D.logSearchAction(e.props.file,e.props.user,"click_path_link"),c.setUrl({path:a}),t.preventDefault()}}(this)},ue(se("in <strong>%(location)s</strong>",{comment:"Describes the parent directory of a file in a list of search results."
}),{location:p,strong:ie.strong()}))):void 0))},_handleLoadFileLocation:function(e,t){return e.stopPropagation(),D.logSearchAction(this.props.file,this.props.user,"click_path_link"),c.setUrl({path:t}),e.preventDefault()},_renderFilenameColumn:function(){var e,t,r;return t=oe(q,{className:this.props.isMaestroDesign?"u-pad-right-s":"u-pad-right-xs",ref:"icon",file:this.props.file,onClick:this.handleFilenameClick,onDragStart:function(e){return function(t){return e.props.isMaestroDesign?void 0:(t.stopPropagation(),c.setSelection({selection:ne([e.props.file.fq_path])}),e.props.onDragStart(t,[e.props.file],!1))}}(this),onMouseDown:function(e){return function(t){return e.props.file.is_dir?t.stopPropagation():void 0}}(this)}),r=this._renderFilename(),e=this.props.isMaestroDesign&&!this.props.isMultiColumnGroupVisible?8:6,ie.div({ref:"filenameColumn",className:s(""+this.props.columnClasses,"column--filename","o-grid__col--"+e+"-of-12"),key:"filename_column",role:"rowheader"},oe(x,{leftAttachment:t},r))},_renderModifiedColumn:function(){var e,t,r;return e=this.props.file.last_modified_fname||"",t=this.props.file.ago||this._renderPlaceholder(),this.props.showColumnDetail&&!this.props.isMaestroDesign&&(t=this.props.file.ago?se("Modified %(ago)s").format({ago:this.props.file.ago}):""),ie.div({className:s((r={},r[""+this.props.columnClasses]=!0,r["u-ellip"]=!0,r["o-grid__col--3-of-12"]=this.props.isMultiColumnGroupVisible||this.props.isMaestroDesign,r["o-grid__col--6-of-12"]=!(this.props.isMultiColumnGroupVisible||this.props.isMaestroDesign),r)),key:"modified_column",role:"gridcell"},this.props.isMaestroDesign?ie.span({className:"browse-file-row__modified-time"},t):t,e.length?ie.span({className:"browse-file-row__modifier u-font-meta"},(this.props.isMaestroDesign?"by ":"")+e):void 0)},_renderSyncColumn:function(){var e,t;return t="",V.hasManagedSync(this.props.user.id)&&("sync"===this.props.file.default_sync_setting?t=se("Sync by default"):"no_sync"===this.props.file.default_sync_setting&&(t=se("Don’t sync by default"))),ie.div({className:s((e={},e[""+this.props.columnClasses]=!0,e["u-ellip"]=!0,e["o-grid__col--3-of-12"]=this.props.isMultiColumnGroupVisible||this.props.isMaestroDesign,e["o-grid__col--6-of-12"]=!(this.props.isMultiColumnGroupVisible||this.props.isMaestroDesign),e)),key:"sync_column",role:"gridcell"},t)},_renderMultiColumnGroup:function(){var e;return e=function(e){return function(t,s){return ie.div({className:"column--multi "+e.props.columnClasses+" column--"+t+" o-grid__col--3-of-12",role:"gridcell",key:t},s)}}(this),[e("sharedwith",oe(X,{file:this.props.file,browseContext:this.props.context,tabIndex:this.props.isTabbable?0:-1,isMaestroDesign:this.props.isMaestroDesign})),e("kind",H.getCategoryDescription(this.props.file)),e("extension",H.getExtension(this.props.file)||this._renderPlaceholder()),e("size",this.props.file.size||this._renderPlaceholder())]},_renderActionsColumn:function(){var e;return e=!0,this.props.isMaestroDesign&&this.props.selectedFilesCount>0&&(e=!1,this.props.isSelected&&1===this.props.selectedFilesCount&&(e=!0)),e?ie.div({className:"sharing__actions",key:"actions_column",role:"gridcell"},le(this.props.user,this.props.file,this.props.context)?oe(Y,{ref:"shareButton",browseContext:this.props.context,file:this.props.file,user:this.props.user,isMaestroDesign:this.props.isMaestroDesign}):void 0):void 0},_renderSettingsGearColumn:function(){return ie.div({className:"settings-gear-button",key:"settings_gear_column",role:"gridcell"},oe(K,{ref:"settings",alt:this.props.settingsGearMenuAlt,isShowing:this.state.shouldShowSettingsBubble,menuItems:this.props.settingsGearMenuItems,browseContext:this.props.context,file:this.props.file,isActionDisabled:V.hasContentManagerActionsDisabled(this.props.user.id)}))},_renderEmptyColumns:function(){return ie.div({className:s(""+this.props.columnClasses,"u-ellip","o-grid__col--3-of-12"),role:"gridcell",key:"empty_column"})},render:function(){var e,t,r,o;return e={"browse-file-row":!0,"browse-file-row--focused-in":this.state.focusedIn,"browse-file-row--is-selected":this.props.isSelected,"browse-file-row--is-archived":this.props.isArchiveState,"browse-file-row--is-deleted":this.props.file.isDeleted,"browse-file-row--is-drop-target":this.props.isAvailableDropTarget,"browse-file-row--file-dragged-over":this.props.isAvailableDropTarget&&this.props.isActiveDropTarget,"o-grid":!0,"o-grid--no-gutter":!0},o={className:s(e),"data-filename":this.props.file.fq_path.split("/").slice(-1),role:"row",tabIndex:this.props.isTabbable?0:-1,draggable:(this.props.isMaestroDesign||this.props.isSelected&&this.state.wasSelectedBeforeMostRecentMouseDown)&&!((r=this.props.renameState)===Q.PENDING_INPUT||r===Q.SAVING_INPUT),onContextMenuCapture:this.handleContextMenu,onMouseEnter:this.handleMouseEnter,onMouseDown:function(e){return function(t){return e.props.isMaestroDesign?t.stopPropagation():e.handleMouseDown(t)}}(this),onMouseUp:this.handleMouseUp,onMouseLeave:this.handleMouseLeave,onClick:this.props.isMaestroDesign?this.handleFilenameClick:this.props.onClick,onDoubleClick:this.handleDoubleClick,onDragStart:this.handleDragStart},"undefined"!=typeof RUNNING_IN_REACTSERVER&&null!==RUNNING_IN_REACTSERVER||null==this.props.topOffsetPx||(o.style={position:"absolute",top:this.props.topOffsetPx},o["aria-posinset"]=this.props.rowIndex+1,o["aria-setsize"]=this.props.totalRowCount),ie.li(o,this._renderSelectionToggleColumn(),this._renderFilenameColumn(),this.props.isArchiveState?this._renderEmptyColumns():this.props.isSyncColumnVisible?this._renderSyncColumn():this.props.isModifiedColumnVisible?this._renderModifiedColumn():void 0,this.props.isMultiColumnGroupVisible?function(){var e,s,r,o;for(r=this._renderMultiColumnGroup(),o=[],e=0,s=r.length;s>e;e++)t=r[e],o.push(t);return o}.call(this):void 0,null!=this.props.settingsGearMenuItems?this._renderSettingsGearColumn():this._renderActionsColumn())}}),j=r.createClass({displayName:"PaperItemRow",propTypes:{paper:r.PropTypes.instanceOf(z).isRequired,topOffsetPx:r.PropTypes.number,columnClasses:r.PropTypes.string,rowIndex:r.PropTypes.number,showTitleHighlights:r.PropTypes.bool,totalRowCount:r.PropTypes.number,isMaestroDesign:r.PropTypes.bool,onMouseEnter:r.PropTypes.func,onMouseDown:r.PropTypes.func,onMouseUp:r.PropTypes.func},getDefaultProps:function(){return{columnClasses:"browse-file-row__column o-grid__col o-grid__col--am",showTitleHighlights:!1,isMaestroDesign:!1,onMouseEnter:null,onMouseDown:null,onMouseUp:null}},render:function(){var e,r,o,n,i,a,l,u,p;return l=oe(T,{group:"web",name:"paper_white_32",ref:"icon",className:"u-pad-right-xs browse-file-row__accessory",alt:""}),p=this.props.paper.title,o=this.props.showTitleHighlights?D.highlightMatchString(p,this.props.paper.title_highlights):t.escape(p),a=M({scheme:"https",authority:te,path:"/paper"}),e=ie.div({className:"browse-file-row__name-location"},ie.a({className:"filename-link u-ellip browse-file-row__name",href:this.props.paper.url},ie.span({dangerouslySetInnerHTML:{__html:o}})),ie.div({className:"u-ellip browse-file-row__location"},this.props.isMaestroDesign?se("in Paper",{comment:"The Dropbox Paper page"}):ie.a({href:a},ue(se("in <strong>Paper</strong>",{comment:"The Dropbox Paper page."}),{strong:ie.strong()})))),i=this.props.paper.last_modified_date?se("Modified %(date)s").format({date:this.props.paper.last_modified_date}):"",this.props.isMaestroDesign?(r=8,n=3):(r=6,n=6),u={className:s("browse-file-row","o-grid","o-grid--no-gutter"),"data-filename":this.props.paper.title,role:"row",tabIndex:"-1"},"undefined"!=typeof RUNNING_IN_REACTSERVER&&null!==RUNNING_IN_REACTSERVER||null==this.props.topOffsetPx||(u.style={position:"absolute",top:this.props.topOffsetPx},u["aria-setsize"]=this.props.totalRowCount,u["aria-posinset"]=this.props.rowIndex+1),ie.li(u,ie.div({className:s(""+this.props.columnClasses,"column--filename","o-grid__col--"+r+"-of-12"),role:"rowheader"},oe(x,{leftAttachment:l},e)),ie.div({className:s(""+this.props.columnClasses,"u-ellip","o-grid__col--"+n+"-of-12"),role:"gridcell"},i,ie.span({className:"browse-file-row__modifier u-font-meta"},this.props.paper.creator_name)))}}),{FileItemRow:G,PaperItemRow:j}})}.call(this),function(){define("modules/clean/react/browse/keyboard_shortcuts",["external/react","external/react-dom","jquery","modules/core/browser","modules/core/i18n","modules/clean/keycode","modules/clean/react/modal","modules/clean/react/flag"],function(e,t,s,r,o,n,i,a){var l,u,p,d,c,h;return d=o._,u=i.Modal,h=e.DOM,c=e.createElement,p=[{key:"↑",desc:d("Select previous file (hold shift to select range)",{comment:"Shift refers to the shift key"})},{key:"↓",desc:d("Select next file (hold shift to select range)",{comment:"Shift refers to the shift key"})},{windowsKey:"ctrl + a",macKey:"⌘ + a",desc:d("Select all files")},{key:"esc",desc:d("Deselect all files")},{key:"←",desc:d("Go up a folder")},{key:"/",desc:d("Search")},{key:"→",desc:d("Open folder")},{key:"enter",desc:d("Open file or folder")},{key:"alt + a",desc:d("Show action menu for selected file(s)")},{windowsKey:"ctrl + c",macKey:"⌘ + c",desc:d("Copy selected file(s)")},{windowsKey:"ctrl + v",macKey:"⌘ + v",desc:d("Paste selected file(s) into the current folder")},{key:"F2",desc:d("Rename selected file")},{windowsKey:"Delete",macKey:"delete",desc:d("Delete selected file(s)")},{windowsKey:"ctrl + z",macKey:"⌘ + z",desc:d("Undo recent move/copy/rename/delete")},{key:"?",desc:d("Show keyboard shortcuts")}],l=e.createClass({displayName:"KeyboardShortcuts",componentDidMount:function(){var e;return e=t.findDOMNode(this.refs.shortcutsModal.refs.modal),s(e).on("keydown",this._handleQuestionMarkKeyDown)},componentWillUnmount:function(){var e;return e=t.findDOMNode(this.refs.shortcutsModal.refs.modal),s(e).off("keydown",this._handleQuestionMarkKeyDown)},_handleQuestionMarkKeyDown:function(e){return e.shiftKey&&e.which===n.FORWARD_SLASH?(e.stopPropagation(),this.refs.shortcutsModal.close()):void 0},_renderShortcutsItem:function(e){var t;return t=h.span({className:"keyboard-shortcuts__key"},e.key?e.key:r.mac?e.macKey:e.windowsKey),h.li({className:"keyboard-shortcuts__item u-mar-bottom-xs"},c(a,{leftAttachment:t,alignment:"top"},h.span({className:"keyboard-shortcuts__desc"},e.desc)))},render:function(){var e;return c(u,{ref:"shortcutsModal",acceptButtonText:"",className:"keyboard-shortcuts",onShow:this._setupKeyDown,title:d("Dropbox keyboard shortcuts"),width:750},h.ul({className:"keyboard-shortcuts__pane u-unlist u-trim-padding"},function(){var t,s,r;for(r=[],t=0,s=p.length;s>t;t++)e=p[t],r.push(this._renderShortcutsItem(e));return r}.call(this)))}})})}.call(this),function(){define("modules/clean/react/browse/name_input",["external/underscore","external/classnames","external/react","external/react-dom","modules/core/i18n","modules/clean/keycode","modules/core/notify","modules/clean/raf"],function(e,t,s,r,o,n,i,a){var l,u,p,d;return p=o._,d=s.DOM,u=s.PropTypes,l=s.createClass({mixins:[s.addons.PureRenderMixin],displayName:"NameInput",propTypes:{defaultValue:u.string.isRequired,label:u.string.isRequired,onSubmit:u.func,onCancel:u.func,className:u.string},getDefaultProps:function(){return{onSubmit:e.noop,onCancel:e.noop,className:""}},componentDidMount:function(){var e;return e=r.findDOMNode(this.refs.input),e.focus(),a.requestAnimationFrame(function(){var t,s;return t=e.value,s=t.lastIndexOf("."),-1===s&&(s=t.length),e.setSelectionRange(0,s)})},_checkValue:function(){var e;return e=r.findDOMNode(this.refs.input).value.trim(),e===this.props.defaultValue?(this.props.label===p("Folder name")&&i.error(p("Please provide a name for the new folder.")),this.props.onCancel()):this.props.onSubmit(e)},_onSubmit:function(e){return e.preventDefault(),this._checkValue()},_onKeyDown:function(e){return e.keyCode===n.ESC?(e.preventDefault(),this.props.onCancel()):void 0},_onBlur:function(e){return this._checkValue()},render:function(){var e;return e=d.input({ref:"input",defaultValue:this.props.defaultValue,className:t("c-input",this.props.className),onBlur:this._onBlur,onKeyDown:this._onKeyDown,onDragStart:function(e){return e.stopPropagation()},"aria-label":this.props.label}),d.form({className:"u-pad-right-xs",onSubmit:this._onSubmit},e)}})})}.call(this),function(){define("modules/clean/react/browse/pinned_team_folder",["external/underscore","external/react","external/classnames","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/item_list_row","modules/clean/react/browse/models","modules/clean/react/browse/file_list_utils","modules/clean/react/css","modules/clean/react/tooltip","modules/clean/react/sprite","modules/clean/user_education/user_education_client","modules/core/i18n"],function(e,t,s,r,o,n,i,a,l,u,p,d,c){var h,m,f,_,g,b,v,y,S,w,T,D,E,I,P,N;return m=o.DropTargetHighlightMode,b=o.LoadingStates,_=n.FileItemRow,f=i.File,h=i.BrowseContext,g=a.FileListHelpers,y=u.Tooltip,S=u.TooltipPosition,w=d.UEClient,T=d.UserEducationEffect,D=c._,I=t.DOM,E=t.createElement,v=t.createClass({displayName:"PinnedTeamFolder",propTypes:{teamFolder:t.PropTypes.instanceOf(f).isRequired,context:t.PropTypes.instanceOf(h).isRequired,user:t.PropTypes.object,selection:t.PropTypes.object,loadingState:t.PropTypes.oneOf(e.values(b)),activeDropTarget:t.PropTypes.instanceOf(f),dropTargetHighlightMode:t.PropTypes.oneOf(function(){var e;e=[];for(P in m)N=m[P],e.push(N);return e}()),isDraggingInternalFiles:t.PropTypes.bool,isDraggingExternalFiles:t.PropTypes.bool,isTextSelectable:t.PropTypes.bool,isPagelet:t.PropTypes.bool},componentDidMount:function(){return w.sendEvent(this.constructor.displayName,"componentDidMount",this.props.context.toJSON())},_renderTeamFolderHeader:function(e,t){return I.div({},I.span({className:"pinned-team-folder__header-text"},e),I.div({className:"pinned-team-folder__info-button"},E(y,{position:S.RIGHT,tooltip_contents:I.div({},t),tooltip_classname:"pinned-team-folder__tooltip"},E(p,{group:"web",name:"info",alt:D("File section information")}))))},render:function(){var e;return e=g.shouldFileBeHighlightedDropTarget({file:this.props.teamFolder,isSelected:this.props.selection.selected.has(this.props.teamFolder.fq_path),dropTargetHighlightMode:this.props.dropTargetHighlightMode}),I.div({className:"pinned-team-folder"},I.div({className:"u-pad-top-xs"},this._renderTeamFolderHeader(D("Team Folder"),D("Everything in a Team folder is automatically shared with your team. Team folders can also contain shared folders for collaborating with people outside your team."))),I.div({className:"pinned-team-folder__file-row u-pad-top-xs"},E(T,{containerName:this.constructor.displayName,name:"TeamFolder"},E(_,{selectableListId:this.props.teamFolder.fq_path,key:encodeURI(this.props.teamFolder.fq_path),file:this.props.teamFolder,user:this.props.user,context:this.props.context,shouldFocus:this.props.selection.selected.last()===this.props.teamFolder.fq_path,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isAvailableDropTarget:e,isActiveDropTarget:this.props.teamFolder===this.props.activeDropTarget,isTextSelectable:this.props.isTextSelectable,isModifiedColumnVisible:!1,isPagelet:this.props.isPagelet,onDragStart:function(){},onMouseEnter:function(){},onMouseDown:function(){},onMouseUp:function(){}}))),I.div({className:"u-pad-top-m"},this._renderTeamFolderHeader(D("Other Folders"),D("These folders help you organize your private work files."))))}}),{PinnedTeamFolder:l(v,["/static/css/scooter/scooter-scoped-vflATcSDK.css","/static/css/browse/browse-vflc_FrK9.css"])}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/browse/preview_sf_members",["jquery","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/ajax","modules/clean/analytics","modules/clean/avatar/photo_avatar","modules/clean/avatar/size","modules/clean/components/loading_indicator","modules/clean/components/title_bubble","modules/clean/em_string","modules/clean/filepath","modules/clean/flux/dispatcher","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/css","modules/clean/react/flag","modules/clean/react/image","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/react_format","modules/clean/sharing/member_avatars","modules/clean/static_urls","modules/clean/sharing/action_types","modules/clean/sharing/api","modules/clean/sharing/share_modal_util","modules/clean/sharing/ui_util","modules/clean/teams/cdm_mve_quota_usage","modules/clean/teams/limited_team_invite_modal","modules/clean/teams/suggest_invites_modal","modules/clean/viewer","modules/core/i18n","modules/core/notify"],function(t,s,r,o,n,i,a,l,u,p,d,c,h,m,f,_,g,b,v,y,S,w,T,D,E,I,P,N,C,F,M,R,A,x){var O,L,k,U,B,H,q,G,W,V,z,j,Q,K,Y,X,Z,$,J,ee,te,se,re,oe,ne;return Q=a.SharedFolderActivityLogger,Z=a.TeamsWebActionsLogger,k=u.AVATAR_DIMENSION_BY_SIZE,K=f.SharedWithActionTypes,U=_.BrowseContext,z=_.QuotaStats,G=y.Modal,se=w.reactFormat,oe=D.static_url,j=E.ShareModalActionTypes,Y=I.SharingApi,re=P.showShareModal,H=N.GoldenGate,$=A._,ne=A.ungettext,ee=r.createElement,te=r.DOM,q=15,B=10,L=k.MEDIUM,X="south",O=!0,W=r.createClass({displayName:"PreviewSFMembersPanel",propTypes:{context:r.PropTypes.instanceOf(U).isRequired,user:r.PropTypes.object.isRequired,viewer:r.PropTypes.instanceOf(R),isMaestroDesign:r.PropTypes.bool},getInitialState:function(){return{firstMemberRender:!0,hasPendingRequest:!0,sharedFolderData:{},sharedLinkData:void 0}},getDefaultProps:function(){return{viewer:R.get_viewer(),isMaestroDesign:!1}},componentDidMount:function(){return this._fetchSharedFolderData(),this._log_event("preview_sf_members_shown"),t(document).on(Y.REQUEST_SUCCEEDED_EVENT,this._sharing_api_request_handler),this._dispatchToken=m.register(this.onEventDispatched)},componentWillUnmount:function(){var e,s;return null!=(e=this._currentSFDataRequest)&&e.abort(),null!=(s=this._currentLinkDataRequest)&&s.abort(),t(document).off(Y.REQUEST_SUCCEEDED_EVENT,this._sharing_api_request_handler),this._dispatchToken?m.unregister(this._dispatchToken):void 0},componentDidUpdate:function(e,t){var s,r;return(null!=(s=e.context)?s.currentFQPath:void 0)!==(null!=(r=this.props.context)?r.currentFQPath:void 0)&&(this._fetchSharedFolderData(),this._log_event("preview_sf_members_shown")),!t.firstMemberRender||t.hasPendingRequest||n.isEmpty(t.sharedFolderData)&&null==t.sharedLinkData?void 0:this.setState({firstMemberRender:!1})},onEventDispatched:function(t){var s,r,o,n,i;return s=null!=t&&null!=(o=t.action)?o.type:void 0,n=[K.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE,K.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE,K.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE],s&&e.call(n,s)>=0?this._fetchSharedFolderData():s&&s===j.FETCH_LINK_METADATA_SUCCESS&&(r=this.props.context.currentNSPath?this.props.context.currentFQPath:this.props.context.currentNSID,i=this.props.user.id+":"+r,t.action.sharingKey===i)?this._fetchSharedLinkData():void 0},_canShareAsNestedSharedFolder:function(){return this.props.context.currentNSPath&&this.props.context.currentNSAllowsNesting},_isViewingTeamRootFolder:function(){return this.props.context.isInsideAutoTeamFolder&&"/"===h.parent_dir(this.props.context.currentFQPath)},_isViewingLimitedTeamRootFolder:function(){return this._isViewingTeamRootFolder()&&this.props.viewer.team_is_limited&&!this._isViewingCdmMveFolder()},_isViewingCdmMveFolder:function(){return this._isViewingTeamRootFolder()&&Boolean(this.props.context.cdmMveQuotaStats)},_cdmMveRootFolderShareButtonText:function(){return $(this._isViewingCdmMveFolderAndCanInvite()?"Invite members":"Suggest team members")},_isViewingCdmMveFolderAndCanInvite:function(){return this._isViewingCdmMveFolder()&&(this.props.viewer.team_is_limited||this.props.user.is_team_admin)},_sharing_api_request_handler:function(e,t){var s;return s=t.request_url,s.indexOf("/share_ajax/leave")>-1||s.indexOf("/share_ajax/unshare")>-1||!this.props.context.isInFolderMode||t.ns_id!==this.props.context.currentNSID?void 0:this._fetchSharedFolderData()},_getMaxVisibleAvatars:function(){return H.hasNewMembershipUI(this.props.user.id)?B:q},_fetchSharedFolderData:function(){return this._fetchSharedFolderMembers(),this._fetchSharedLinkData(),this._setHasPendingRequest()},_fetchSharedFolderMembers:function(){var e;if(this.props.context.currentMountPoint)return e="/share_ajax/preview_members/"+this.props.context.currentNSID,this._currentSFDataRequest=i.WebRequest({url:e,subject_user:this.props.user,data:{max_results:this._getMaxVisibleAvatars(),is_loading_cdm_mve_preview:this._isViewingCdmMveFolder(),sort_by_name:H.hasNewMembershipUI(this.props.user.id)},success:function(e){return function(t){var s;return t=JSON.parse(t),t.ns_id===e.props.context.currentNSID?(s={numUndisplayableUsersAndInvites:t.num_avatars_not_shown,numUsersAndInvites:t.num_users_and_invites,numUsersAndInvitesOutsideTeam:t.num_users_and_invites_outside_team,groups:t.groups,invitations:t.invitations,joinedMembers:t.joined_members},e.setState({sharedFolderData:s})):void 0}}(this),complete:function(e){return function(){return e._currentSFDataRequest=null,e._setHasPendingRequest()}}(this)})},_fetchSharedLinkData:function(){var e,t;if(H.hasNewMembershipUI(this.props.user.id)&&(e=this.props.context.currentFQPath,null!=e&&"/"!==e))return t=[e],this._currentLinkDataRequest=i.SilentBackgroundRequest({url:"/sm/get_token_info",dataType:"json",data:{paths:JSON.stringify(t)},subject_user:this.props.user,success:function(e){return function(t){var s;return s=t.shmodels[0],(null!=s?s.disabled:0)||null!=(null!=s?s.path:void 0)&&s.path!==e.props.context.currentFQPath?void 0:e.setState({sharedLinkData:s})}}(this),complete:function(e){return function(){return e._currentLinkDataRequest=null,e._setHasPendingRequest()}}(this)})},_setHasPendingRequest:function(){try{return this.setState({hasPendingRequest:null!=this._currentSFDataRequest||null!=this._currentLinkDataRequest})}catch(e){}},settings_button_click_handler:function(){return this._isViewingCdmMveFolder()?this._show_invite_team_members_modal():(this._log_event("preview_sf_members_settings_button_clicked"),re(this.props.user,this.props.context,{origin:"BROWSE_SHARED_FOLDER_BANNER"}))},_avatar_click_handler:function(e){return this._log_event(e),document.activeElement!==document.body&&document.activeElement.blur(),re(this.props.user,this.props.context,{origin:"BROWSE_SHARED_FOLDER_BANNER"})},avatar_click_handler:function(){return this._avatar_click_handler("preview_sf_members_avatar_clicked")},shared_link_click_handler:function(){return this._avatar_click_handler("preview_sf_members_shared_link_clicked")},overflow_click_handler:function(){return this._log_event("preview_sf_members_overflow_number_clicked"),re(this.props.user,this.props.context,{origin:"BROWSE_SHARED_FOLDER_BANNER"})},_show_invite_team_members_modal:function(){return Z.log("preview_sf_members_cdm_mve_invite_button_clicked"),this._isViewingCdmMveFolderAndCanInvite()?G.showInstance(ee(F)):G.showInstance(ee(M))},_log_event:function(e,t){return null==t&&(t={}),t.ns_id=this.props.context.currentNSID,Q.log("web",e,this.props.user,t)},render:function(){var e;return e={folderName:this.props.context.getNameOfTargetFolder(),user:this.props.user,viewer:this.props.viewer,onSettingsButtonClick:this.settings_button_click_handler,onOverflowCountClick:this.overflow_click_handler,onAvatarClick:this.avatar_click_handler,maxVisibleAvatars:this._getMaxVisibleAvatars(),folderType:this.props.context.isInsideAutoTeamFolder?"TEAM":"SHARED",buttonText:this._isViewingCdmMveFolder()?this._cdmMveRootFolderShareButtonText():null,isViewingLimitedTeamRootFolder:this._isViewingLimitedTeamRootFolder(),animation:this.state.firstMemberRender,cdmMveQuotaStats:this._isViewingCdmMveFolder()?this.props.context.cdmMveQuotaStats:void 0,showCreateTeamPromo:this.props.context.showSharedFolderCreateTeamPromo,onSharedLinkClick:this.shared_link_click_handler,sharedLinkData:this.state.sharedLinkData,isFirstDataLoading:this.state.hasPendingRequest&&this.state.firstMemberRender,isMaestroDesign:this.props.isMaestroDesign},e=t.extend(e,this.state.sharedFolderData),te.div({className:"PreviewSFMembersPanel"},ee(V,e))}}),J=r.createClass({displayName:"PreviewSFMembersView",mixins:[T],propTypes:{folderName:r.PropTypes.string.isRequired,folderType:r.PropTypes.oneOf(["SHARED","TEAM"]).isRequired,user:r.PropTypes.object.isRequired,viewer:r.PropTypes.instanceOf(R).isRequired,onSettingsButtonClick:r.PropTypes.func.isRequired,onOverflowCountClick:r.PropTypes.func,onAvatarClick:r.PropTypes.func,buttonText:r.PropTypes.string,isViewingLimitedTeamRootFolder:r.PropTypes.bool,isFirstDataLoading:r.PropTypes.bool,numUndisplayableUsersAndInvites:r.PropTypes.number,numUsersAndInvites:r.PropTypes.number,numUsersAndInvitesOutsideTeam:r.PropTypes.number,groups:r.PropTypes.array,invitations:r.PropTypes.array,joinedMembers:r.PropTypes.array,onSharedLinkClick:r.PropTypes.func,sharedLinkData:r.PropTypes.object,animation:r.PropTypes.bool,avatarDimension:r.PropTypes.number,cdmMveQuotaStats:r.PropTypes.instanceOf(z),titleButtonDirection:r.PropTypes.string,maxVisibleAvatars:r.PropTypes.number,showCreateTeamPromo:r.PropTypes.bool,isMaestroDesign:r.PropTypes.bool},getDefaultProps:function(){return{titleButtonDirection:X,avatarDimension:L,maxVisibleAvatars:q,animation:O,isMaestroDesign:!1}},renderCreateTeamPromo:function(){var e,t,s;return t="",s=this.props.viewer.personal_email,null!=this.props.joinedMembers&&(t=function(){var t,r,o,n;for(o=this.props.joinedMembers,n=[],t=0,r=o.length;r>t;t++)e=o[t],e.email!==s&&n.push(e.email);return n}.call(this).join()),te.div({className:"team-upsell-banner c-card c-card--arrow c-card--arrow-sw"},se($("<createLink>Create a Team Dropbox</createLink> with the people in this folder"),{createLink:te.a({href:"/team?tk=sf_upsell&_camp=sf&invite_members="+t})}),te.span({className:"u-mar-left-xxs"},ee(d,{text:$("With teams you get access to a shared team folder, a separate work Dropbox, groups, and other tools and features."),direction:"north"},ee(S,{className:"team-upsell-banner__info-sprite",group:"web",name:"info",alt:$("More information about teams")}))))},_renderContent:function(){return[this.renderFolderInfo(),this.props.numUsersAndInvites?"SHARED"===this.props.folderType?this.renderAvatars():this.renderTeamFolder():this._renderLoadingIndicator()]},_renderCdmMveContent:function(){return this.props.numUsersAndInvites?te.div({className:"cdm-mve-sf-info-banner"},te.div({className:"shared-folder-info u-mar-bottom-xs"},te.span({className:"u-font-strong"},this._buildNumberOfMembersString()),this.props.viewer.team_is_limited?ee(C,{quotaStats:this.props.cdmMveQuotaStats}):void 0),this.renderAvatars()):this._renderLoadingIndicator()},_renderGoldenGateContent:function(){return this.props.isFirstDataLoading?this._renderLoadingIndicator():ee(b,{rightAttachment:this.renderAvatars()},this.renderGoldenGateFolderInfo())},_renderLoadingIndicator:function(){return te.div({className:"loading-indicator-container"},ee(p,null))},render:function(){return te.div({className:"sf-member-preview-container"},this.props.showCreateTeamPromo?this.renderCreateTeamPromo():void 0,te.div({className:this.getClassName()},ee(b,{rightAttachment:this.renderButtons()},this.props.cdmMveQuotaStats?this._renderCdmMveContent():H.hasNewMembershipUI(this.props.user.id)?this._renderGoldenGateContent():this._renderContent())))},getClassName:function(){return s({"preview-sf-members--with-team-promo":this.props.showCreateTeamPromo,"c-banner c-banner--unpinned u-pad-s":!0,"team-folder":"TEAM"===this.props.folderType})},renderTeamFolder:function(){var e,t;return e=null,this.props.groups&&(t=this.props.groups[0],t&&t.is_automatic&&(e=$("editor"===t.access_type?"%(group_name)s can edit":"%(group_name)s can view"),e=e.format({group_name:t.name}))),e||(e=$("Shared with all members of %(team_name)s").format({team_name:this.props.viewer.team_name})),te.div({className:"team-folder-member-entry"},ee(l,{dimension:32,photoUrl:oe("/static/images/icons/team_32-vflk8mBzO.png"),shape:"SQUARE",optionalClass:"u-mar-right-xs"}),te.span({className:"u-l-ib u-l-ib--m"},e))},renderButtons:function(){var e,t,r;if((!this.props.isViewingLimitedTeamRootFolder||this.props.user.is_team_admin)&&!this.props.isMaestroDesign)return t=H.hasNewMembershipUI(this.props.user.id),r=!this.props.isViewingLimitedTeamRootFolder,e=this.props.buttonText?this.props.buttonText:$(r?"Share":"Settings"),te.div(null,te.button({className:s(["c-btn","settings-button",t?"c-btn--primary":"c-btn--secondary"]),onClick:this.props.onSettingsButtonClick,title:e},e))},renderFolderInfo:function(){return te.div({className:"shared-folder-info u-mar-bottom-xs"},te.strong({className:"shared-folder-name"},c.em_snippet(this.props.folderName,18)),this.props.numUsersAndInvites?te.span({className:"u-mar-horizontal-xs"},"•"):void 0,this.props.numUsersAndInvites?te.span({className:"members-string u-font-meta"},this._buildNumberOfMembersString()):void 0)},renderGoldenGateFolderInfo:function(){var e,t;return this.props.numUsersAndInvites?(t=ne("%(num_total)s member","%(num_total)s members",this.props.numUsersAndInvites,{comment:'Another pluralized string MAY be concatenated to this to make a string like: "15 members (4 outside of TechCorp Inc.)"'}).format({num_total:this.props.numUsersAndInvites}),this.props.numUsersAndInvitesOutsideTeam&&(e=ne("%(num_outside)s outside your Dropbox team","%(num_outside)s outside your Dropbox team",this.props.numUsersAndInvitesOutsideTeam,{comment:'This will be concatenated to another string to make a string like: "15 members (4 outside your Dropbox team)"'}).format({num_outside:this.props.numUsersAndInvitesOutsideTeam}))):t=this.props.sharedLinkData?this.getDescriptionForSharedLinkInfo(this.props.sharedLinkData):$("Not shared"),te.div({className:"u-l-ib shared-folder-info__members"},te.strong({},t),null!=e?te.div({className:"u-font-meta"},e):void 0)},_buildNumberOfMembersString:function(){var e,t;return t=ne("%(num_total)s member","%(num_total)s members",this.props.numUsersAndInvites,{comment:'Another pluralized string MAY be concatenated to this to make a string like: "15 members (4 outside of TechCorp Inc.)"'}),this.props.numUsersAndInvitesOutsideTeam?(t+=ne(" (%(num_outside)s outside your Dropbox team)"," (%(num_outside)s outside your Dropbox team)",this.props.numUsersAndInvitesOutsideTeam,{comment:'This will be concatenated to another string to make a string like: "15 members (4 outside your Dropbox team)"'}),e=t.format({num_total:this.props.numUsersAndInvites,num_outside:this.props.numUsersAndInvitesOutsideTeam,team_name:c.em_snippet(this.props.viewer.team_name,16)})):e=t.format({num_total:this.props.numUsersAndInvites}),e},renderAvatars:function(){var e,t,s,r,o,n;return e=[],n=[],this.props.sharedLinkData&&e.push(this.renderSharedLink(this.props.sharedLinkData)),this.props.numUsersAndInvites&&(H.hasNewMembershipUI(this.props.user.id)||(o=this.findOwnerAndMeInJoinedMembers(this.props.joinedMembers),r=o[0],s=o[1],null!=r&&(e.push(this.renderJoinedMember(r)),n.push(r.user_id)),null!=s&&s!==r&&(e.push(this.renderJoinedMember(s)),n.push(s.user_id))),t=this.props.cdmMveQuotaStats?[]:this.props.groups,this.addGroupsMembersInvitations(e,t,this.props.joinedMembers,this.props.invitations,n)),this.renderAvatarList(e,this.getAvatarListClassName())},getAvatarListClassName:function(){return s({"u-pad-right-m":H.hasNewMembershipUI(this.props.user.id)})}}),V=g(J,["/static/css/avatar_list-vflYhnyrd.css","/static/css/components/loading_indicator-vflbadB1S.css","/static/css/scooter/scooter-scoped-vflATcSDK.css","/static/css/shared_folder_members_preview/team_promo-vflu998jd.css","/static/css/shared_folder_members_preview/cdm_mve_banner-vflRBgSZE.css"]),{PreviewSFMembersPanel:W,PreviewSFMembersView:V}})}.call(this);var __assign=this&&this.__assign||Object.assign||function(e){for(var t,s=1,r=arguments.length;r>s;s++){
t=arguments[s];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};define("modules/clean/react/browse/selection_actions",["require","exports","external/immutable","external/react","external/classnames","modules/clean/react/browse/models","modules/clean/react/browse/util","modules/clean/react/bubble_menu","modules/clean/em_string","modules/clean/react/sprite","modules/core/i18n","modules/clean/react/browse/file_actions","modules/clean/react/browse/action_logger"],function(e,t,s,r,o,n,i,a,l,u,p,d,c){"use strict";var h=n.BrowseContext,m=a.BubbleMenu,f=a.BubbleMenuItem,_=c.BrowseLogEventSources;t.BrowseSelectionMenu=r.createClass({displayName:"BrowseSelectionMenu",mixins:[r.addons.PureRenderMixin],propTypes:{context:r.PropTypes.instanceOf(h).isRequired,selectedFiles:r.PropTypes.instanceOf(s.OrderedSet).isRequired,user:r.PropTypes.object.isRequired,onActionButtonClick:r.PropTypes.func,actionHandlers:r.PropTypes.object,isSearchMode:r.PropTypes.bool,handleComponentTTI:r.PropTypes.func},getDefaultProps:function(){return{actionHandlers:{},onActionButtonClick:function(){},isSearchMode:!1,handleComponentTTI:function(){}}},componentDidMount:function(){this.props.handleComponentTTI(this.constructor.displayName)},componentDidUpdate:function(){this.refs.moreActionsBubbleMenu&&this.refs.moreActionsBubbleMenu.hideMenu()},_renderMenuButton:function(e){var t,s=this,n=e.label,i=e.spriteName,a=e.performAction,l=e.href,p=e.ref,d=e.disabled,c=void 0===d?!1:d;if(a){var h={ref:p,className:"button-as-link browse-menu__action-button",onClick:function(e){c||(s.props.onActionButtonClick(),a(e))},disabled:!1};c&&(h.disabled=!0),t=r.createElement("button",__assign({},h),r.createElement(u,{group:"web",name:i,alt:"",className:"browse-menu__action-button-sprite"}),r.createElement("span",{className:"browse-menu__action-button-label"},n))}else l&&(t=r.createElement("a",{ref:p,className:"browse-menu__action-button",href:l},r.createElement(u,{group:"web",name:i,alt:"",className:"browse-menu__action-button-sprite"}),r.createElement("span",{className:"browse-menu__action-button-label"},n)));var m=o({"browse-menu__action":!0,"browse-menu__action--disabled":c});return r.createElement("li",{key:n,className:m,"data-action":n},t)},_renderMoreActionsDropbdown:function(e){var t=p._("More")+" ",s=r.createElement("button",{className:"button-as-link browse-menu__action-button"},t,r.createElement(u,{group:"web",name:"arrow-down-blue",alt:"",className:"browse-menu__more-dropdown-arrow"})),o=e.map(function(e){var t=e.label,s=e.spriteName,o=e.performAction,n=e.href,i=e.disabled,a=void 0===i?!1:i;return r.createElement(f,{href:n,onClick:function(){o&&o()},disabled:a},r.createElement(u,{group:"web",name:s,alt:"",className:"browse-menu__action-button-sprite"}),r.createElement("span",{className:"browse-menu__action-button-label"},t))});return r.createElement("li",{className:"browse-menu__action"},r.createElement(m,{ref:"moreActionsBubbleMenu",targetButton:s,targetFixed:!0,position:m.POSITIONS.BOTTOM_LEFT,items:o}))},render:function(){var e,t=i.describeFiles(this.props.selectedFiles);if(e=1!==this.props.selectedFiles.count()||this.props.selectedFiles.first().is_dir?"":this.props.selectedFiles.first().size,this.props.selectedFiles.isEmpty())return null;for(var s=d.getActionsForFileCollection({files:this.props.selectedFiles,context:this.props.context,user:this.props.user,skipSharing:!0,isSearchMode:this.props.isSearchMode,actionHandlers:this.props.actionHandlers,source:_.LEGACY_HEADER_ACTIONS}),o=800,n=12,a=new l(t).length*n,u=new l(e).length*n,p=o-(a+u+10+20),c=0,h=[],m=0;m<s.length;m++){var f=s[m];if(c+=new l(f.label).length*n+16+3+8,c>p||m>=6){var g=m-1;h=s.slice(g),s=s.slice(0,g);break}}return r.createElement("div",{className:"c-column-header browse-menu browse-file-list-header"},r.createElement("span",{className:"browse-menu__description"},t),r.createElement("ul",{className:"browse-menu__actions"},s.map(this._renderMenuButton),h.length?this._renderMoreActionsDropbdown(h):null),r.createElement("span",{className:"browse-menu__filesize-label"},e))}})}),function(){define("modules/clean/react/browse/settings_gear_menu",["external/react","external/underscore","modules/clean/react/browse/models","modules/clean/react/bubble_menu","modules/clean/react/sprite"],function(e,t,s,r,o){var n,i,a,l,u,p,d;return n=s.BrowseContext,l=s.File,i=r.BubbleMenu,a=r.BubbleMenuItem,d=e.DOM,p=e.createElement,u=e.createClass({displayName:"settingsGearMenuBubble",propTypes:{alt:e.PropTypes.string.isRequired,browseContext:e.PropTypes.instanceOf(n).isRequired,file:e.PropTypes.instanceOf(l).isRequired,isActionDisabled:e.PropTypes.bool,isShowing:e.PropTypes.bool.isRequired,menuItems:e.PropTypes.arrayOf(e.PropTypes.shape({label:e.PropTypes.string,action:e.PropTypes.func})).isRequired},render:function(){var e,s;return e=d.button({className:"sprite-button bubble-button"},p(o,{group:"web",name:"gear",alt:this.props.alt})),p(i,{position:i.POSITIONS.BOTTOM,targetButton:e,ref:"gearBubbleMenu",items:function(){var e,r,o,n;for(o=this.props.menuItems,n=[],e=0,r=o.length;r>e;e++)s=o[e],n.push(p(a,{onClick:t.partial(s.action,this.props.browseContext,this.props.file),disabled:this.props.isActionDisabled},s.label));return n}.call(this)})}}),{SettingsGearMenuBubble:u}})}.call(this),function(){define("modules/clean/react/browse/share_button",["external/classnames","external/react","external/react-dom","modules/clean/css","modules/clean/keycode","modules/clean/react/button","modules/clean/react/browse/models","modules/clean/react/sprite","modules/clean/sharing/share_modal_util","modules/core/i18n"],function(e,t,s,r,o,n,i,a,l,u){var p,d,c,h,m,f,_,g;return m=n.button,p=i.BrowseContext,d=i.File,g=l.showShareModal,h=u._,_=t.DOM,f=t.createElement,c=t.createClass({displayName:"ShareButton",mixins:[t.addons.PureRenderMixin],propTypes:{browseContext:t.PropTypes.instanceOf(p).isRequired,file:t.PropTypes.instanceOf(d).isRequired,user:t.PropTypes.object.isRequired,isMaestroDesign:t.PropTypes.bool},handleClick:function(e){return g(this.props.user,this.props.file,{browseContext:this.props.browseContext,origin:"BROWSE_FILE_ROW"}),this.props.isMaestroDesign?e.stopPropagation():void 0},handleDoubleClick:function(e){return e.stopPropagation(),this.handleClick()},render:function(){var t,s;return s={"c-btn c-btn--tertiary":!0,"inline-button":!0,"inline-share-button":!0,"variant-DROPDOWN":!0,"extra-padding":!0},t=h(this.props.browseContext.isNonUserRelativeContext?"Manage access":"Share"),f(m,{className:e(s),onClick:this.handleClick,onDoubleClick:this.handleDoubleClick,ref:"button",importance:"secondary"},_.span({className:"inline-share-button-label"},t))}}),{ShareButton:c}})}.call(this),function(){var e=function(e,s){function r(){this.constructor=e}for(var o in s)t.call(s,o)&&(e[o]=s[o]);return r.prototype=s.prototype,e.prototype=new r,e.__super__=s.prototype,e},t={}.hasOwnProperty,s=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/browse/shared_with",["jquery","external/react","external/react-dom","external/underscore","modules/core/i18n","modules/core/user_i18n","modules/clean/account/email","modules/clean/ajax","modules/clean/avatar/size","modules/clean/flux/base_store","modules/clean/flux/dispatcher","modules/clean/flux/store_mixin","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/sharing/shared_with_view","modules/clean/sharing/api","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/share_modal_util","modules/clean/sharing/ui_util","modules/clean/file_events","modules/core/dom"],function(t,r,o,n,i,a,l,u,p,d,c,h,m,f,_,g,b,v,y,S,w,T,D){var E,I,P,N,C,F,M,R,A,x,O,L,k,U,B,H,q,G,W,V,z,j,Q,K,Y,X;return Q=i._,X=i.ungettext,F=l.EmailVerification,I=p.AVATAR_DIMENSION_BY_SIZE,P=m.BrowseActionTypes,H=m.SharedWithActionTypes,N=f.BrowseContext,M=f.File,C=_.BrowseStore,z=g.SharedWithView,j=b.SharingApi,R=v.FileShareApiClient,A=v.FolderShareApiClient,U=y.MemberCounts,Y=S.showShareModal,K=r.createElement,k=5,x=3,E=5,O=100,B=100,L="file_row_sharing_menu",V=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s.prototype._init=function(){return this._sharedFolderDataByTargetNs={},this._sharedFolderMemberCountsByTargetNs={},this._sharedLinkDataMapsByFolderFQPath={},this._filesWeHaveSharedLinkDataFor={},this._sharedFileDataByFileId={},this._hasSharedDataLoadedByNSID={}},s.prototype.hasLinkDataForFile=function(e){return e.fq_path in this._filesWeHaveSharedLinkDataFor},s.prototype.clearSharedLinkDataCache=function(){return this._filesWeHaveSharedLinkDataFor={}},s.prototype.getDataForFile=function(e){var t,s,r,o,n;return s=null,null!=e.target_ns&&(s=this._sharedFolderDataByTargetNs[e.target_ns]),this._canBeSharedFile(e)&&(s=this._sharedFileDataByFileId[null!=(r=e.file_id)?r:e.fq_path]),t=C.path(),n=this._sharedLinkDataMapsByFolderFQPath[t],n&&(o=n[this._sharedLinkKey(e)],o?(s||(s={}),s.sharedLinkInfo=o):null!=s&&delete s.sharedLinkInfo),s||(s={}),s.inheritedMemberCounts=this._getMemberCounts(),s.hasSharedDataLoaded=this._getHasSharedDataLoaded(),s},s.prototype.getAudienceBoxDataForFile=function(e){var t,s,r,o,i,a,l;return o={},e&&!e.target_ns&&this._canBeSharedFile(e)?(o=this._sharedFileDataByFileId[null!=(i=e.file_id)?i:e.fq_path]||{},s=this._sharedFolderDataByTargetNs[C.context().currentNSID]||{},o.groups||(o.groups=[]),o.invitations||(o.invitations=[]),o.joinedMembers||(o.joinedMembers=[]),s.groups&&(o.groups=n.union(o.groups,s.groups)),s.invitations&&(o.invitations=n.union(o.invitations,s.invitations)),s.joinedMembers&&(o.joinedMembers=n.union(o.joinedMembers,s.joinedMembers))):o=e&&e.target_ns?this._sharedFolderDataByTargetNs[e.target_ns]:this._sharedFolderDataByTargetNs[C.context().currentNSID],r=C.path(),l=this._sharedLinkDataMapsByFolderFQPath[r],l&&e&&(a=l[this._sharedLinkKey(e)],a?(o||(o={}),o.sharedLinkInfo=a):null!=o&&delete o.sharedLinkInfo),o||(o={}),o.hasSharedDataLoaded=this._getHasSharedDataLoaded(),o.groups||(o.groups=[]),o.invitations||(o.invitations=[]),o.joinedMembers||(o.joinedMembers=[]),o.hasSharedDataLoaded&&!o.audienceDescription&&(0===o.groups.length&&0===o.invitations.length&&(0===o.joinedMembers.length||1===o.joinedMembers.length&&o.joinedMembers[0].user_id===C.user().id)?o.audienceDescription=Q("Only you"):(t=o.joinedMembers.length+o.groups.length+o.invitations.length,t+=o.numUndisplayableUsersAndInvites||0,o.audienceDescription=X("%(num)s member","%(num)s members",t).format({num:t}))),o},s.prototype.getDataForCurrentNSID=function(){var e;return e=this._sharedFolderDataByTargetNs[C.context().currentNSID],e||(e={}),e.inheritedMemberCounts=this._getMemberCounts(),e.hasSharedDataLoaded=this._getHasSharedDataLoaded(),e},s.prototype._sharedLinkKey=function(e){return e.fq_path+"_"+e.ns_id+"_"+e.sjid},s.prototype._new_payload=function(e){switch(e.action.type){case P.LOAD_PATH:return this._pathLoaded(e.action.data);case P.ADD_FILES:return this._filesAdded(e.action.data);case P.INITIALIZE_EVERYTHING:return this._browseInitializeEverything(e.action.data);case P.CHANGE_FILES:return this._filesChanged(e.action.data);case H.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE:return this._signalSharedFileDataOutOfDate(e.action.data);case H.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE:return this._signalSharedFolderDataOutOfDate(e.action.data);case H.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE:return this._signalSharedLinkDataOutOfDate(e.action.data);case H.SET_SHARED_FOLDER_DATA:return this._setNSSharedWithData(e.action.data);case H.SET_MEMBER_COUNTS_FOR_NS:return this._setMemberCountsForNs(e.action.data);case H.SET_SHARED_LINK_DATA:return this._setSharedLinkData(e.action.data);case H.SET_SHARED_FILE_DATA:return this._setSharedFileData(e.action.data);case H.CLEAR_SHARED_FOLDER_DATA_FOR_NS:return this._clearSharedFolderDataForNs(e.action.data);case H.REMOVE_SHARED_LINK_DATA:return this._removeSharedLinkData(e.action.data)}},s.prototype._fillInMissingSharedLinkData=function(e){var t,s,r,o,n,i,a;for(a=e.parentPath,r=e.files,o=[],n=0,i=r.length;i>n;n++)s=r[n],this.hasLinkDataForFile(s)||(this._filesWeHaveSharedLinkDataFor[s.fq_path]=!0,o.push(s));return q.loadLinkDataForFiles({parentPath:a,fileFqPaths:function(){var e,s,r;for(r=[],e=0,s=o.length;s>e;e++)t=o[e],r.push(t.fq_path);return r}()})},s.prototype._getMemberCounts=function(){var e;return e=C.context().currentNSID,e in this._sharedFolderMemberCountsByTargetNs?this._sharedFolderMemberCountsByTargetNs[e]:new U},s.prototype._getHasSharedDataLoaded=function(){var e;return e=C.context().currentNSID,e in this._hasSharedDataLoadedByNSID?this._hasSharedDataLoadedByNSID[e]:!1},s.prototype._setHasSharedDataLoaded=function(e){var t;return t=C.context().currentNSID,this._hasSharedDataLoadedByNSID[t]=e},s.prototype._canBeSharedFile=function(e){return!(e.is_dir||e.isDeleted)},s.prototype._loadSharedFileData=function(e){var t,s,r,o,n,i,a;for(o=(null!=e?e:{invalidateCache:!1}).invalidateCache,a=C.user(),o&&(this._sharedFileDataByFileId={}),s=[],i=C.files().toArray(),r=0,n=i.length;n>r;r++)t=i[r],!this._canBeSharedFile(t)||t.file_id in this._sharedFileDataByFileId||s.push(t.file_id);return q.loadSharedFileDataForFiles({fileIds:s})},s.prototype._pathLoaded=function(e){var t,s;return t=e.files,s=e.path,this._setHasSharedDataLoaded(!1),q.loadMemberCountsForContainingNs(),q.loadSFDataForPath({parentPath:s}),this._loadSharedFileData({invalidateCache:!0}),this._filesAdded({files:t,path:s})},s.prototype._filesAdded=function(e){var t,s;return t=e.files,s=e.path,this._fillInMissingSharedLinkData({parentPath:s,files:t}),this._loadSharedFileData()},s.prototype._filesChanged=function(e){var t,s,r;return r=e.path,s=e.fileDeltas,r===C.path()&&null!=s&&s.length?(c.waitFor([C.dispatchToken]),q.loadSFDataForPath({parentPath:r}),this.clearSharedLinkDataCache(),t=C.files().toArray(),this._fillInMissingSharedLinkData({parentPath:r,files:t}),this._loadSharedFileData({invalidateCache:!0})):void 0},s.prototype._signalSharedFileDataOutOfDate=function(e){var t;return t=e.fileIds,q.loadSharedFileDataForFiles({fileIds:t})},s.prototype._signalSharedFolderDataOutOfDate=function(e){var t;return t=e.parentPath,null==t&&(t=C.path()),q.loadMemberCountsForContainingNs(),q.loadSFDataForPath({parentPath:t})},s.prototype._signalSharedLinkDataOutOfDate=function(e){var t,s;return s=e.parentPath,t=e.fileFqPaths,null==s&&(s=C.path()),q.loadLinkDataForFiles({parentPath:s,fileFqPaths:t})},s.prototype._setNSSharedWithData=function(e){var t;return t=e.sharedFolderData,this._setHasSharedDataLoaded(!0),this._sharedFolderDataByTargetNs=t,this.emit_change()},s.prototype._setMemberCountsForNs=function(e){var t,s;return s=e.targetNs,t=e.memberCounts,this._sharedFolderMemberCountsByTargetNs[s]=t,this.emit_change()},s.prototype._setSharedLinkData=function(e){var t,s,r,o,n,i,a,l;for(o=e.parentPath,i=e.sharedLinkData,l=this._sharedLinkDataMapsByFolderFQPath[o]||{},s=0,r=i.length;r>s;s++)n=i[s],t=n.file,a=n.sharedLinkToken,l[this._sharedLinkKey(t)]=a;return this._sharedLinkDataMapsByFolderFQPath[o]=l,this.emit_change()},s.prototype._setSharedFileData=function(e){var t;return t=e.sharedFileData,n.extend(this._sharedFileDataByFileId,t),this.emit_change()},s.prototype._clearSharedFolderDataForNs=function(e){var t;return t=e.targetNs,this._sharedFolderDataByTargetNs[t]=void 0,this.emit_change()},s.prototype._browseInitializeEverything=function(e){var t,s;return s=e.path,t=e.files,q.loadMemberCountsForContainingNs(),q.loadSFDataForPath({parentPath:s}),this._filesAdded({path:s,files:t})},s.prototype._removeSharedLinkData=function(e){var t,s,r,o,n,i;for(n=e.parentPath,s=e.files,i=this._sharedLinkDataMapsByFolderFQPath[n]||{},r=0,o=s.length;o>r;r++)t=s[r],i[this._sharedLinkKey(t)]=void 0;return this._sharedLinkDataMapsByFolderFQPath[n]=i,this.emit_change()},s}(d),W=new V,t(document).on(j.REQUEST_SUCCEEDED_EVENT,function(e,t){var s;return s=t.request_url,s.indexOf("/share_ajax/leave")>-1||s.indexOf("/share_ajax/unshare")>-1?c.dispatch({type:H.CLEAR_SHARED_FOLDER_DATA_FOR_NS,data:{targetNs:t.ns_id}}):c.dispatch({type:H.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE,data:{parentPath:C.path()}})}).on(T.LINKS_REMOVE,function(e,t){return c.dispatch({type:H.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{parentPath:C.path(),fileFqPaths:[t.fq_path]}})}).on(T.LINKS_ADD,function(e,t){return c.dispatch({type:H.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{parentPath:C.path(),fileFqPaths:[t.fq_path]}})}),q=function(){function e(){}return e.loadSFDataForPath=function(e){var t,s;return t=e.parentPath,s=C.user(),u.WebRequest({url:"/share_ajax/shared_with",dataType:"json",subject_user:s,data:{max_results:k,fq_path_prefix:t,include_inherited:w.GoldenGate.hasAudienceBox(s.id),admin_console:C.context().isNonUserRelativeContext?"true":void 0,sort_by_name:w.GoldenGate.hasNewMembershipUI(s.id)},success:function(e){var t,s,r,o,n;for(n={},t=0,s=e.length;s>t;t++)o=e[t],r={numUndisplayableUsersAndInvites:o.num_avatars_not_shown,groups:o.groups,invitations:o.invitations,joinedMembers:o.joined_members,audienceDescription:o.audience_description},n[o.ns_id]=r;return c.dispatch({type:H.SET_SHARED_FOLDER_DATA,data:{sharedFolderData:n}})}})},e.loadMemberCountsForContainingNs=function(){var e,t,s,r;return r=C.user(),s=C.context(),t=s.isNonUserRelativeContext?s.rootNSID?s.currentNSID:void 0:s.isInsideSharedFolder?s.currentNSID:void 0,r.is_email_verified&&t?(e=new A({userId:r.id}),e.getMemberCounts({contentId:t}).then(function(e){return c.dispatch({type:H.SET_MEMBER_COUNTS_FOR_NS,data:{memberCounts:e,targetNs:t}})})):void 0},e.loadSharedFileDataForFiles=function(e){var t,s,r,o;return s=e.fileIds,o=C.user(),o.is_email_verified?(t=new R({userId:o.id}),(r=function(e){var s,o,n;if(0!==e.length)return n=e.slice(0,B),s=e.slice(B),o=t.listMembersBatch({contentIds:n,limit:k}),o.then(function(e){var t;return t={},e.forEach(function(e,s){return t[s]={numUndisplayableUsersAndInvites:0,groups:e.groups.valueSeq().map(w.apiGroupMemberToAvatarInfo).toArray(),invitations:e.invitees.valueSeq().map(w.apiInviteeMemberToAvatarInfo).toArray(),joinedMembers:e.users.valueSeq().map(w.apiUserMemberToAvatarInfo).toArray()}}),c.dispatch({type:H.SET_SHARED_FILE_DATA,data:{sharedFileData:t}}),s?r(s):void 0})})(s)):void 0},e.loadLinkDataForFiles=function(e){var t,r,o,n;return r=e.parentPath,t=e.fileFqPaths,n=C.user(),(o=function(e){var t,i;if(0!==e.length)return i=e.slice(0,O),t=e.slice(O),u.SilentBackgroundRequest({url:"/sm/get_token_info",dataType:"json",data:{paths:JSON.stringify(i)},subject_user:n,success:function(e){var n,a,l,u,p,d,h,m,f,_,g;for(l=C.filesMap(),f=[],h=e.shmodels,u=0,p=h.length;p>u;u++)g=h[u],g.disabled||(n=l.get(g.path),n&&f.push({file:n,sharedLinkToken:g}));return f.length&&c.dispatch({type:H.SET_SHARED_LINK_DATA,data:{parentPath:r,sharedLinkData:f}}),_=function(){var t,s,r,o;for(r=e.shmodels,o=[],t=0,s=r.length;s>t;t++)m=r[t],o.push(m.path);return o}(),a=function(){var e,t,r;for(r=[],e=0,t=i.length;t>e;e++)d=i[e],s.call(_,d)>=0||r.push(l.get(d));return r}().filter(function(e){return null!=e}),a.length&&c.dispatch({type:H.REMOVE_SHARED_LINK_DATA,data:{parentPath:r,files:a}}),t?o(t):void 0}})})(t)},e}(),G=r.createClass({displayName:"SharedWithController",mixins:[h(W)],propTypes:{browseContext:r.PropTypes.instanceOf(N).isRequired,file:r.PropTypes.instanceOf(M),isInAudienceBox:r.PropTypes.bool,isMaestroDesign:r.PropTypes.bool,tabIndex:r.PropTypes.oneOf([0,-1])},_get_state_from_stores:function(e){var t,s,r,o,n,i,a,l;return t=w.GoldenGate.hasAudienceBox(C.user().id)?W.getAudienceBoxDataForFile(e.file):e.file?W.getDataForFile(e.file):W.getDataForCurrentNSID(),{audienceDescription:null!=t?t.audienceDescription:void 0,numUndisplayableUsersAndInvites:null!=(s=null!=t?t.numUndisplayableUsersAndInvites:void 0)?s:0,numInheritedMembers:null!=(r=null!=t&&null!=(o=t.inheritedMemberCounts)?o.total_unique_users:void 0)?r:0,groups:null!=(n=null!=t?t.groups:void 0)?n:[],hasSharedDataLoaded:null!=t?t.hasSharedDataLoaded:void 0,invitations:null!=(i=null!=t?t.invitations:void 0)?i:[],joinedMembers:null!=(a=null!=t?t.joinedMembers:void 0)?a:[],sharedLinkInfo:null!=(l=null!=t?t.sharedLinkInfo:void 0)?l:null}},componentDidUpdate:function(){var e,t,s,r,n;if(t=D.getFocusableElementsIn(o.findDOMNode(this),!1),null!=this.props.tabIndex){for(n=[],s=0,r=t.length;r>s;s++)e=t[s],n.push(e.tabIndex=this.props.tabIndex);return n}},componentWillReceiveProps:function(e){return this.setState(this._get_state_from_stores(e))},_showSharingModal:function(){var e,t,s;if(!w.GoldenGate.hasAudienceBox(C.user().id)||!this.props.browseContext.isCurrentlyInRoot||this.props.file)return t=[C.user(),this.props.file?this.props.file:C.context()],s=t[0],e=t[1],Y(s,e,{browseContext:this.props.browseContext,origin:"BROWSE_FILE_ROW"})},handleOverflowCountClick:function(){return this._showSharingModal()},handleAvatarClick:function(){return this._showSharingModal()},handleSharedLinkClick:function(){return Y(C.user(),this.props.file,{browseContext:this.props.browseContext,origin:"BROWSE_FILE_ROW"})},_getMaxVisibleAvatars:function(){return w.GoldenGate.hasAudienceBox(C.user().id)?E:w.GoldenGate.hasNewMembershipUI(C.user().id)?this.props.browseContext.isInsideSharedFolder?x:x+1:k},render:function(){return K(z,{user:C.user(),file:this.props.file,numUndisplayableUsersAndInvites:this.state.numUndisplayableUsersAndInvites,numInheritedMembers:this.state.numInheritedMembers,parentFolderName:C.context().getNameOfTargetFolder(),groups:this.state.groups,invitations:this.state.invitations,joinedMembers:this.state.joinedMembers,sharedLinkInfo:this.state.sharedLinkInfo,animation:!1,avatarDimension:this.props.isInAudienceBox?I.MEDIUM:void 0,onOverflowCountClick:this.handleOverflowCountClick,onAvatarClick:this.handleAvatarClick,onSharedLinkClick:this.handleSharedLinkClick,maxVisibleAvatars:this._getMaxVisibleAvatars(),isMaestroDesign:this.props.isMaestroDesign,audienceDescription:this.state.audienceDescription,isInAudienceBox:this.props.isInAudienceBox,hasSharedDataLoaded:this.state.hasSharedDataLoaded,isCurrentlyInRoot:C.context().isCurrentlyInRoot})}}),{SharedWithActions:q,SharedWithController:G,SharedWithStore:W}})}.call(this),define("modules/clean/react/browse/util",["require","exports","modules/clean/em_string","modules/clean/filepath","modules/constants/browse","modules/constants/viewer","modules/core/i18n","modules/core/uri"],function(e,t,s,r,o,n,i,a){"use strict";function l(e){if(1===e.count()){var t=e.first(),o=r.filename(t.fq_path);return s.em_snippet(o,p)}if(e.count()>1){var n=function(e){return e.isDeleted},a=e.some(n)&&!e.every(n),l=e.toArray().filter(function(e){return e.is_dir}),u=e.toArray().filter(function(e){return!e.is_dir});if(a)return i._("No available actions");var d=[];if(u.length){var c=i.ungettext("%(num_files)d file","%(num_files)d files",u.length).format({num_files:u.length});d.push(c)}if(l.length){var c=i.ungettext("%(num_folders)d folder","%(num_folders)d folders",l.length).format({num_folders:l.length});d.push(c)}return 2===d.length?i._("%(x)s and %(y)s",{comment:'\n            The whole string is a phrase like "2 files and 3 folders". \'x\' is\n            a string containing a phrase like "2 files" and \'y\' is a string\n            containing a phrase like "3 folders".\n          '}).format({x:d[0],y:d[1]}):d[0]}return""}function u(e,t,s){return void 0===s&&(s={}),s[n.UID_PARAM_NAME]=String(t),o.REVISION_HISTORY_WEB?new a({path:"/history"+e}).updateQuery(s):new a({path:"/revisions"+e}).updateQuery(s)}var p=13.5;t.describeFiles=l,t.getRevisionsUri=u}),function(){define("modules/clean/react/context_menu_v2",["jquery","external/immutable","external/keymaster","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/keycode","modules/clean/react/css","modules/clean/react/sprite_div","modules/core/browser","modules/core/dom","modules/clean/react/browse/constants"],function(e,t,s,r,o,n,i,a,l,u,p,d,c){var h,m,f,_,g,b,v,y,S;return b=c.MouseEventButton,y=o.createElement,S=o.DOM,v="",f=t.Record({icon:null,text:"",shouldShow:!0,isDisabled:!1,onClick:i.noop,href:null,subMenuItems:null}),g=o.createClass({displayName:"GlobalContextMenu",propTypes:{alwaysOpenOnCapture:o.PropTypes.bool,ignoreSelectors:o.PropTypes.string,items:o.PropTypes.arrayOf(o.PropTypes.instanceOf(f)),onMenuOpen:o.PropTypes.func,onMenuClose:o.PropTypes.func},getDefaultProps:function(){return{alwaysOpenOnCapture:!1,ignoreSelectors:"a, input, button, textarea, select",onMenuOpen:i.noop,onMenuClose:i.noop}},getInitialState:function(){return{isMenuOpen:!1}},componentDidMount:function(){return e(document).on("contextmenu.GlobalContextMenu",function(t){return function(s){return 0===e(s.target).closest(t.props.ignoreSelectors).size()?t.toggleMenu(s):t.closeMenu()}}(this)),e(document).on("click.GlobalContextMenu",function(t){return function(s){return s.button!==b.RIGHT&&0===e(s.target).closest(".context-menu").size()?t.closeMenu():void 0}}(this))},componentWillUnmount:function(){return e(document).off(".GlobalContextMenu")},openMenuAtPosition:function(e,t,s){return this.setState({isMenuOpen:!0,left:e,top:t}),this.props.onMenuOpen(s)},closeMenu:function(){return this.state.isMenuOpen?(this.setState({isMenuOpen:!1}),this.props.onMenuClose()):void 0},toggleMenu:function(e){return e.shiftKey?void 0:(e.preventDefault(),this.state.isMenuOpen&&!this.props.alwaysOpenOnCapture?this.closeMenu():this.openMenuAtPosition(e.clientX,e.clientY,e))},render:function(){return S.span({},this.state.isMenuOpen?y(_,{initialLeft:this.state.left,initialTop:this.state.top,onMenuClose:this.closeMenu,items:this.props.items,ref:"contextMenu"}):void 0)}}),m=o.createClass({displayName:"ContextMenuHandler",propTypes:{alwaysOpenOnCapture:o.PropTypes.bool,className:o.PropTypes.string,items:o.PropTypes.arrayOf(o.PropTypes.instanceOf(f)),onMenuOpen:o.PropTypes.func,onMenuClose:o.PropTypes.func},getDefaultProps:function(){return{onMenuOpen:i.noop,onMenuClose:i.noop,alwaysOpenOnCapture:!1}},getInitialState:function(){return{isMenuOpen:!1}},componentDidMount:function(){return e(document).on("click.ContextMenuHandler",function(t){return function(s){return s.button!==b.RIGHT&&0===e(s.target).closest(".context-menu").size()?t.closeMenu():void 0}}(this))},componentWillUnmount:function(){return e(document).off(".ContextMenuHandler")},openMenuAtPosition:function(e,t,s){return this.setState({isMenuOpen:!0,left:e,top:t}),this.props.onMenuOpen(s)},closeMenu:function(){return this.setState({isMenuOpen:!1}),this.props.onMenuClose()},toggleMenu:function(e){return e.shiftKey?void 0:(e.preventDefault(),this.state.isMenuOpen&&!this.props.alwaysOpenOnCapture?this.closeMenu():this.openMenuAtPosition(e.clientX,e.clientY,e))},render:function(){return S.span({className:this.props.className},this.state.isMenuOpen?y(_,{initialLeft:this.state.left,initialTop:this.state.top,onMenuClose:this.closeMenu,items:this.props.items,ref:"contextMenu"}):void 0,S.span({"aria-haspopup":!0,onContextMenuCapture:this.toggleMenu,ref:"contextMenuTarget"},this.props.children))}}),h=o.createClass({displayName:"ContextMenu",propTypes:{initialLeft:o.PropTypes.number,initialTop:o.PropTypes.number,items:o.PropTypes.arrayOf(o.PropTypes.instanceOf(f)),onMenuClose:o.PropTypes.func,onCurrentMenuClose:o.PropTypes.func,level:o.PropTypes.number,shouldAutoSelect:o.PropTypes.bool},getDefaultProps:function(){return{initialLeft:null,initialTop:null,items:null,onMenuClose:i.noop,onCurrentMenuClose:i.noop,level:0,shouldAutoSelect:!1}},getInitialState:function(){return{selectedIndex:null,left:null,right:null,isSubMenuOpen:!1}},componentWillMount:function(){return this.setState({left:this.props.initialLeft,top:this.props.initialTop})},componentDidMount:function(){return v=key.getScope(),key.setScope("ContextMenu"),this.updateCoordinates(),n.findDOMNode(this.refs.contextMenu).focus(),this.props.shouldAutoSelect?this._selectNextItem():void 0},componentDidUpdate:function(e){return e.items!==this.props.items||e.initialLeft!==this.props.initialLeft||e.initialTop!==this.props.initialTop?(this.setState({selectedIndex:null}),this.updateCoordinates(),n.findDOMNode(this.refs.contextMenu).focus()):void 0},componentWillUnmount:function(){return key.setScope(v)},_getReachableIndices:function(){var e,t,s,r,o,n;for(o=[],n=this.props.items,e=s=0,r=n.length;r>s;e=++s)t=n[e],t.shouldShow&&!t.isDisabled&&o.push(e);return o},_selectNextItem:function(){var e,t;return e=this._getReachableIndices(),t=null!=this.state.selectedIndex?(e.indexOf(this.state.selectedIndex)+1)%e.length:0,null!=t?this.selectItem(e[t]):void 0},_selectPreviousItem:function(){var e,t;return e=this._getReachableIndices(),t=null!=this.state.selectedIndex?(e.indexOf(this.state.selectedIndex)+e.length-1)%e.length:e.length-1,null!=t?this.selectItem(e[t]):void 0},_handleKeyDown:function(e){var t,s,r,o,n,i,l,u;if(!this.state.isSubMenuOpen)switch(e.keyCode){case a.TAB:return e.preventDefault(),e.stopPropagation();case a.ESC:return this.props.onMenuClose();case a.SPACE:case a.ENTER:if(null!=this.state.selectedIndex)return l=this.props.items[this.state.selectedIndex],this.clickItem(l,e),this.openSubMenu(l,!0),e.preventDefault(),e.stopPropagation();break;case a.DOWN:return this._selectNextItem(),e.preventDefault(),e.stopPropagation();case a.UP:return this._selectPreviousItem(),e.preventDefault(),e.stopPropagation();case a.RIGHT:if(null!=this.state.selectedIndex)return this.openSubMenu(this.props.items[this.state.selectedIndex],!0);break;case a.LEFT:if(this.props.level>0)return this.props.onCurrentMenuClose(),e.preventDefault(),e.stopPropagation();break;default:for(u=String.fromCharCode(e.keyCode),n=this.props.items,i=[],t=r=0,o=n.length;o>r;t=++r)if(s=n[t],s.shouldShow&&!s.isDisabled){if(s.text[0].toUpperCase()===u){this.selectItem(t),e.preventDefault(),e.stopPropagation();break}i.push(void 0)}return i}},openSubMenu:function(e,t){var s;return(null!=(s=e.subMenuItems)?s.length:void 0)>0?this.setState({isSubMenuOpen:!0,shouldAutoSelectSubMenu:t}):void 0},closeSubMenu:function(){return n.findDOMNode(this.refs.contextMenu).focus(),this.setState({isSubMenuOpen:!1})},selectItemWithMouse:function(e){return n.findDOMNode(this.refs.contextMenu).focus(),this.selectItem(e,!0,!1)},selectItem:function(e,t,s){return this.setState({selectedIndex:e}),t?this.openSubMenu(this.props.items[e],s):void 0},clickItem:function(e,t){return null!=e.subMenuItems||e.isDisabled?void 0:(null!=e.href?p.redirect(e.href):e.onClick(t),this.props.onMenuClose())},updateCoordinates:function(){var t,s,r,o,i,a,l,u;return t=this.props.initialLeft,l=this.props.initialTop,null!=t&&null!=l&&null!=this.refs.contextMenu&&(u=d.viewport_dimensions(),a=15,i=e(n.findDOMNode(this.refs.contextMenu)).width(),o=e(n.findDOMNode(this.refs.contextMenu)).height(),s=u.width-a-i,t>s&&(t=s),r=u.height-a-o,l>r&&(l=r)),this.setState({left:t,top:l})},getSelectedItemDomId:function(){return null!=this.state.selectedIndex?"contextMenu"+this.props.level+"-item"+this.state.selectedIndex:""},_renderItem:function(e,t){var s,o,n,i,a;return n=this.state.selectedIndex===t,o=(null!=(a=e.subMenuItems)?a.length:void 0)>0,i="contextMenu"+this.props.level+"-item"+t,s={"context-menu-item":!0,"context-menu-item--has-submenu":o,"context-menu-item--selected":n,"context-menu-item--disabled":e.isDisabled},S.li({key:i,id:i,"data-action":e.text,className:r(s),role:"menuitem","aria-haspopup":o,"aria-disabled":e.isDisabled,onMouseEnter:function(s){return function(){return e.isDisabled?s.setState({selectedIndex:null}):s.selectItemWithMouse(t)}}(this),onClick:function(t){return function(s){return t.clickItem(e,s)}}(this)},null!=e.icon?y(u,{group:e.icon.group,name:e.icon.name,alt:"",text:e.text}):S.span({},e.text),o?S.span({className:"context-menu-item__accessory c-arrow--right"}):void 0,o&&n&&this.state.isSubMenuOpen?y(h,{initialLeft:null,initialTop:null,className:"context-menu--secondary",
level:this.props.level+1,items:e.subMenuItems,onMenuClose:this.props.onMenuClose,onCurrentMenuClose:this.closeSubMenu,shouldAutoSelect:this.state.shouldAutoSelectSubMenu}):void 0)},render:function(){var e,t,s;return null!=this.state.left&&null!=this.state.top&&(s={left:this.state.left,top:this.state.top}),S.ul({id:"contextMenu"+this.props.level,ref:"contextMenu",className:r("no-padding","bubble-dropdown","context-menu",this.props.className),style:s,role:"menu",tabIndex:-1,"aria-activedescendant":this.getSelectedItemDomId(),onKeyDown:this._handleKeyDown},function(){var s,r,o,n;for(o=this.props.items,n=[],e=s=0,r=o.length;r>s;e=++s)t=o[e],t.shouldShow&&n.push(this._renderItem(t,e));return n}.call(this))}}),_=l(h,["/static/css/components/bubble_dropdown-vflTPbDJ3.css","/static/css/scooter/scooter-scoped-vflATcSDK.css"]),{GlobalContextMenu:g,ContextMenuHandler:m,ContextMenu:h,ContextMenuItem:f}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_uploader/actions",["modules/core/i18n","modules/core/exception","modules/clean/react/browse/store","modules/clean/flux/dispatcher","modules/clean/filepath","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/plu_wrapper","modules/clean/base64"],function(t,s,r,o,n,i,a,l){var u,p,d,c,h,m,f,_,g,assert,b;return g=t._,assert=s.assert,p=r.BrowseStore,b=n.file_extension,_=i.UploaderStore,m=i.UploaderActionTypes,d=i.FileStatus,c=i.FileUpload,h=i.UploadErrorType,u=["pages","key","app","numbers","band","photolibrary","rcproject","rtfd","graffle","logic","logicx","lpdf","sketch","screenflow","scriv","dvdproj","mindnode","cmproj","xcodeproj","imovielibrary","mpkg","imovieproject","1password","agilekeychain","fcpbundle","abbu","mindnode","theater","gameproj","aplibrary","itlp","lrdata","ydevice","bundle","framework","plugin","kext","pkg"],f=function(){function t(){}return t.prototype.initPLU=function(){return a.isInitialized?void 0:(this.sendNS=!1,a.init(),a.onFilesAdded(function(t){return function(s){var r,n,i,a,l,p,d,c,f,_;for(n=function(){var e,t,r;for(r=[],e=0,t=s.length;t>e;e++)i=s[e],null==i.size&&r.push(i);return r}(),s=function(){var e,t,r;for(r=[],e=0,t=s.length;t>e;e++)i=s[e],null!=i.size&&r.push(i);return r}(),a=0,p=n.length;p>a;a++)r=n[a],o.dispatch({type:m.ADD_NEW_FAILED_FILE,data:{file:r,errorType:h.EMPTY_OR_FOLDER,errorMessage:g("This folder or empty file could not be uploaded because of browser limitations. Try zipping up the content before uploading it, or use the Dropbox desktop client to sync it.")}});for(c=function(t){var s;return s=b(t.name),e.call(u,s)>=0&&t.size%34===0},_=function(){var e,t,r;for(r=[],e=0,t=s.length;t>e;e++)i=s[e],c(i)&&r.push(i);return r}(),s=function(){var e,t,r;for(r=[],e=0,t=s.length;t>e;e++)i=s[e],c(i)||r.push(i);return r}(),l=0,d=_.length;d>l;l++)f=_[l],o.dispatch({type:m.ADD_NEW_FAILED_FILE,data:{file:f,errorType:h.PACKAGE_FILE,errorMessage:g("This file is a package file and can’t be uploaded directly. To upload a package file via the web, try zipping it first.")}});return n.length&&t.cancelUploads({files:n}),_.length&&t.cancelUploads({files:_}),o.dispatch({type:m.QUEUE_UPLOADS,data:{files:s}}),t._frobPLU()}}(this)),a.onUploadProgress(function(e){var t,s,r,n,i;return _.isUploadCancelled(e.uploadId)?void 0:(n=e.percentUploaded,s=n*_.currentUpload().size/100,i=s+_.totalSizeOfCompletedUploads(),t=a.bytesPerSec(),r=_.fileList().count(function(e){var t;return(t=e.status)===d.PENDING||t===d.UPLOADING}),o.dispatch({type:m.SET_CURRENT_UPLOAD_PROGRESS,data:{percentComplete:n,numSecondsLeft:(_.totalSize()-i)/t+r}}))}),a.onFileUploaded(function(e){return function(t,s){var r;return _.isUploadCancelled(t.uploadId)?void 0:(r=JSON.parse(s.response),"error"in r?(a.removeFiles({files:[t]}),"ignored"===r.error?o.dispatch({type:m.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:h.IGNORED,errorMessage:g("This file was skipped because it’s an internal system file.")}}):o.dispatch({type:m.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:h.GENERIC}})):(assert("complete"===r.status),assert(r.total_size===t.size),assert(r.upload_id===t.uploadId),o.dispatch({type:m.COMPLETE_UPLOAD,data:{uploadId:t.uploadId}})),e._frobPLU())}}(this)),a.onError(function(e){return function(t,s,r){return _.fileList().has(t.uploadId)?o.dispatch({type:m.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:s,errorMessage:r}}):o.dispatch({type:m.ADD_NEW_FAILED_FILE,data:{file:t,errorType:s,errorMessage:r}}),e._frobPLU()}}(this)))},t.prototype.setPath=function(e){var t,s,r;return s=e.path,t=null!=(r=e.hasPermissionToUploadToFolder)?r:!0,s!==_.path()||t!==_.hasPermissionToUploadToFolder()?o.dispatch({type:m.SET_PATH,data:{path:s,hasPermissionToUploadToFolder:t}}):void 0},t.prototype.setUser=function(e){var t;return t=e.user,o.dispatch({type:m.SET_USER,data:{user:t}})},t.prototype.setNumDraggingFiles=function(e){var t,s,r;return s=e.numDraggingFiles,t=null!=(r=e.isInternalTransfer)?r:!1,o.dispatch({type:m.SET_NUM_DRAGGING_FILES,data:{numDraggingFiles:s,isInternalTransfer:t}})},t.prototype.addFilesToPLU=function(e){var t;return t=e.files,a.addFiles({files:t}),this.setIsInlineStatusDismissed({isInlineStatusDismissed:!1})},t.prototype.addDirectoriesToPLU=function(t){var s,r,n,i,a,l,p,d,c,f,v,y;for(r=t.directoryEntries,s=_.path(),i=[],d=0,a=function(e){return function(){var t;return(t=function(){var s,r,o;return i.length>0?(o=i.pop(),r=o.entry,s=o.dest,r.file(function(r){return e.setPath({path:s}),e.addFilesToPLU({files:[r]}),t()})):void 0})()}}(this),c=function(e){var t,r;return d+=1,r=e.createReader(),(t=function(){return r.readEntries(function(r){var o,n,l;if(r.length>0){for(o=0,n=r.length;n>o;o++)l=r[o],l.isDirectory?c(l):i.push({entry:l,dest:s+e.fullPath});return t()}return d-=1,0===d?a():void 0})})()},v=[],l=0,p=r.length;p>l;l++)y=r[l],f=b(y.name),e.call(u,f)>=0?(n=new File({name:y.name,dest:s}),v.push(o.dispatch({type:m.ADD_NEW_FAILED_FILE,data:{file:n,errorType:h.PACKAGE_FILE,errorMessage:g('Due to browser limitations, OSX package files files cannot be uploaded using drag-and-drop. Please try using the "Upload…" dialog.')}}))):v.push(c(y));return v},t.prototype.setIsUploadModalOpen=function(e){var t;return t=e.isUploadModalOpen,o.dispatch({type:m.SET_IS_UPLOAD_MODAL_OPEN,data:{isUploadModalOpen:t}})},t.prototype.setIsInlineStatusDismissed=function(e){var t;return t=e.isInlineStatusDismissed,o.dispatch({type:m.SET_IS_INLINE_STATUS_DISMISSED,data:{isInlineStatusDismissed:t}})},t.prototype.setSendNS=function(e){return this.sendNS=e,a.setSendNS(e)},t.prototype.cancelUploads=function(e){var t;return t=e.files,a.removeFiles({files:t}),o.dispatch({type:m.CANCEL_UPLOADS,data:{files:t}}),this._frobPLU()},t.prototype.manuallySetInErrorState=function(e){var t,s,r;return r=e.file,s=e.errorType,t=e.errorMessage,a.removeFiles({files:[r]}),o.dispatch({type:m.UPLOAD_ERROR,data:{uploadId:r.uploadId,errorType:s,errorMessage:t}}),this._frobPLU()},t.prototype._startUpload=function(e){var t,s,r,n;return s=e.file,o.dispatch({type:m.START_UPLOAD,data:{file:s}}),n="url"===(r=b(s.name))||"webloc"===r||"website"===r?0:1,t={dest:s.dest,reported_total_size:s.size,uploadId:s.uploadId,_subject_uid:s.userId,offset:0,overwrite:n},this.sendNS&&(t.ns_id=s.ns_id,t.ns_path=s.ns_path),a.setAjaxParams(t),a.start(),!0},t.prototype._frobPLU=function(){var e;return e=_.nextUpload(),null!=e&&null==_.currentUpload()?(assert(e instanceof c),this._startUpload({file:e})):void 0},t}(),{UploaderDispatcher:o,UploaderActions:new f}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/react/file_uploader/plu_wrapper",["jquery","modules/core/exception","external/plupload_dev","external/react","external/underscore","modules/clean/static_urls","modules/core/cookies","modules/clean/react/browse/action_logger","modules/clean/react/browse/store","modules/clean/react/file_uploader/store","modules/constants/request","modules/constants/env","modules/core/i18n"],function(t,s,r,o,n,i,a,l,u,p,d,c,h){var m,f,_,g,b,v,y,S,w,T,assert,D,E;return assert=s.assert,S=i.UrlConstants,m=l.BrowseLogger,f=u.BrowseStore,y=p.UploaderStore,_=p.FileUpload,v=p.UploadErrorType,D=p.generateUploadId,w=h._,E=window.plupload,T=function(e,t){var s,r;return null==t&&(t={}),s=n.extend({},t,e),new _({uploadId:s.uploadId,dest:s.dest,ns_id:s.ns_id,ns_path:s.ns_path,name:s.name,size:s.size,userId:s.userId,percentUploaded:null!=(r=s.percent)?r:0})},b=function(){function s(){this.removeFiles=e(this.removeFiles,this),this.bytesPerSec=e(this.bytesPerSec,this),this.onError=e(this.onError,this),this.onFileUploaded=e(this.onFileUploaded,this),this.onUploadProgress=e(this.onUploadProgress,this),this.onFilesAdded=e(this.onFilesAdded,this),this.setBrowseButton=e(this.setBrowseButton,this),this.setAjaxParams=e(this.setAjaxParams,this),this.start=e(this.start,this),this.addFiles=e(this.addFiles,this),this.init=e(this.init,this),this.isInitialized=!1,this.sendNS=!1}return s.prototype.idToUploadIdMap={},s.prototype.PLU_CONTAINER_ID="flash-upload-container",s.prototype.setSendNS=function(e){return this.sendNS=e},s.prototype.init=function(){var e;if(!this.isInitialized)return this.isInitialized=!0,this.$secretBrowseButton=t("<button>").addClass("secret-file-uploader-button").hide().appendTo(t("body")),this.$pluContainer=t("<div>").attr("id",this.PLU_CONTAINER_ID).css({position:"absolute",left:-2e3}).appendTo(t("body")),this.$currentExternalBrowseButton=t(),e={url:"https://"+c.BLOCK_CLUSTER+"/chunked_upload",file_data_name:"file",runtimes:this._runtimes,multipart_params:{},multipart:!1,max_file_size:"50000mb",chunk_size:"8mb",max_retries:2,browse_button:this.$secretBrowseButton[0],container:this.PLU_CONTAINER_ID,flash_swf_url:S.MOXIE_SWF_URL,init:{ChunkUploaded:function(e){return function(t,s,r){var o,n,i;return i=e.idToUploadIdMap[s.id],assert(JSON.parse(r.response).upload_id===i),n=y.fileList().get(i),o={dest:n.dest,reported_total_size:n.size,uploadId:i,_subject_uid:n.userId,offset:r.offset,overwrite:1},e.sendNS&&(o.ns_id=n.ns_id,o.ns_path=n.ns_path),e.setAjaxParams(o)}}(this)}},this.uploader=new E.Uploader(e),this.uploader.init()},s.prototype._runtimes=function(){var e,t,s,r,o;r={"MSIE 8.0":"flash","MSIE 9.0":"flash"},s="html5";for(e in r)o=r[e],-1!==(null!=(t=navigator.userAgent)?t.indexOf(e):void 0)&&(s=o);return s}(),s.prototype.addFiles=function(e){var t;return t=e.files,this.isInitialized||this.init(),this.uploader.addFile(t)},s.prototype.start=function(){return this.isInitialized||this.init(),this.uploader.start()},s.prototype.setAjaxParams=function(e){var t,s,r,o,n,i,l,u;if(l=e.reported_total_size,s=e.dest,u=e.uploadId,n=e.offset,t=e._subject_uid,i=e.overwrite,r=e.ns_id,o=e.ns_path,this.isInitialized||this.init(),null==l||null==s||null==u||null==n||null==t||null==i)throw new Error("A required parameter to setAjaxParams was not given.");return this.uploader.settings.multipart_params={t:a.read(d.JS_CSRF_COOKIE),reported_total_size:l,dest:s,upload_id:u,offset:n,_subject_uid:t,overwrite:i,ns_id:r,ns_path:o}},s.prototype.setBrowseButton=function(e){var s;return this.isInitialized||this.init(),"flash"===this.uploader.runtime?(this.$currentExternalBrowseButton=t(e),this.$currentExternalBrowseButton.length?(t("#"+this.PLU_CONTAINER_ID).show().css({"z-index":1e3,position:"absolute",top:this.$currentExternalBrowseButton.offset().top,left:this.$currentExternalBrowseButton.offset().left,width:this.$currentExternalBrowseButton.outerWidth(),height:this.$currentExternalBrowseButton.outerHeight()}),s=t("#"+this.PLU_CONTAINER_ID+" > .moxie-shim"),s[0].style.top="0px",s[0].style.left="0px",s[0].style.width="100%",s[0].style.height="100%"):t("#"+this.PLU_CONTAINER_ID).hide()):(this.$currentExternalBrowseButton.off("click.PLUBrowseButton"),this.$currentExternalBrowseButton=t(e),this.$currentExternalBrowseButton.on("click.PLUBrowseButton",function(e){return function(){return e.$secretBrowseButton.click()}}(this)))},s.prototype.onFilesAdded=function(e){return this.isInitialized||this.init(),this.uploader.bind("FilesAdded",function(t){return function(s,r){var o;return m.logUploadFile({uid:y.user().id,num_files:r.length,uploader_type:"enhanced",upload_method:"chooser"}),o=r.map(function(e){var s,r,o,n;return n=D(),t.idToUploadIdMap[e.id]=n,r=null,o=null,t.sendNS&&(s=t.getNsIdAndPath(y.path(),e.name),r=s[0],o=s[1]),T(e,{uploadId:n,dest:y.path(),userId:y.user().id,ns_id:r,ns_path:o})}),e(o)}}(this))},s.prototype.getNsIdAndPath=function(e,t){var s,r,o,n,i,a;return o=f.context().currentNSID,i=e.split("/"),a="/"+i.slice(2).join("/"),r=f.context().currentMountPoint,s=a.replace(r,""),"/"===s&&(s=""),n=s+"/"+t,[o,n]},s.prototype.onUploadProgress=function(e){return this.isInitialized||this.init(),this.uploader.bind("UploadProgress",function(t){return function(s,r){var o,n;return n=t.idToUploadIdMap[r.id],o=y.fileList().get(n),e(o.set("percentUploaded",r.percent))}}(this))},s.prototype.onFileUploaded=function(e){return this.isInitialized||this.init(),this.uploader.bind("FileUploaded",function(t){return function(s,r,o){var n,i;return i=t.idToUploadIdMap[r.id],n=y.fileList().get(i),e(n,o)}}(this))},s.prototype.onError=function(e){return this.isInitialized||this.init(),this.uploader.bind("Error",function(t){return function(s,r){var o,n,i,a,l,u,p;if(null==r.file)throw new Error("PLU error without an associated file.");return n=function(){switch(r.code){case E.FILE_SIZE_ERROR:return v.FILE_SIZE_ERROR;case E.HTTP_ERROR:return 0===r.status?v.CONNECTION_ERROR:507===r.status?v.OVER_QUOTA_ERROR:v.HTTP_ERROR;default:return v.GENERIC}}(),o=function(){switch(n){case v.OVER_QUOTA_ERROR:return w("This file can’t be uploaded because you are over your storage quota. If you believe this message to be in error, try refreshing the page.");case v.FILE_SIZE_ERROR:return w("This file is too large to upload using the Dropbox website. Please use the desktop client.");case v.HTTP_ERROR:return w("Something went wrong while uploading this file. There was a server error during the upload request. If the problem persists, please try the basic uploader.");case v.CONNECTION_ERROR:return w("Something went wrong while uploading this file. Check your connection to the internet and try again.");default:return w("Something went wrong while uploading this file. If the problem persists, please try the basic uploader.")}}(),p=t.idToUploadIdMap[r.file.id],y.fileList().has(p)?i=y.fileList().get(p):(l=null,u=null,t.sendNS&&(a=t.getNsIdAndPath(y.path(),r.file.name),l=a[0],u=a[1]),i=T(r.file,{uploadId:D(),dest:y.path(),ns_id:l,ns_path:u})),e(i,n,o)}}(this))},s.prototype.bytesPerSec=function(){var e;return this.isInitialized||this.init(),null!=(e=this.uploader.total)?e.bytesPerSec:void 0},s.prototype.removeFiles=function(e){var t,s,r,o,i;for(s=e.files,this.isInitialized||this.init(),r=0,o=s.length;o>r;r++)t=s[r],i=n.find(this.uploader.files,function(e){return function(s){return e.idToUploadIdMap[s.id]===t.uploadId}}(this)),this.uploader.removeFile(i);return this.uploader.stop(),this.uploader.start()},s}(),g=new b})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_uploader/uploader",["jquery","external/immutable","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/analytics","modules/clean/browse_interface","modules/clean/browse/browse_drag_utils","modules/clean/datetime","modules/clean/display_format","modules/clean/em_string","modules/clean/filepath","modules/clean/flux/store_mixin","modules/clean/react/button","modules/clean/react/browse/actions","modules/clean/react/browse/action_logger","modules/clean/react/browse/store","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/flag","modules/clean/react/image","modules/clean/react/modal","modules/clean/react_format","modules/clean/react/sprite","modules/clean/react/tooltip","modules/clean/static_urls","modules/clean/viewer","modules/constants/env","modules/constants/request","modules/constants/viewer","modules/core/browser","modules/core/cookies","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri"],function(t,s,r,o,n,i,a,l,u,p,d,c,h,m,f,_,g,b,v,y,S,w,T,D,E,I,P,N,C,F,M,R,A,x,O,L,k,U){var B,H,q,G,W,V,z,j,Q,K,Y,X,Z,$,J,ee,te,se,re,oe,ne,ie,ae,le,ue,pe,de,ce,he,me,fe,_e,ge,be,ve,ye,Se,we,Te;return X=a.TeamsWebActionsLogger,ce=l.get_browse_root_name,ne=l.browse_uri_for_fq_path,ie=f.button,fe=f.link_button,H=g.BrowseLogger,B=g.BrowseLogEventSources,q=b.BrowseStore,ee=v.UploaderActions,te=y.UploaderStore,W=y.FileUpload,G=y.FileStatus,J=y.UploadErrorType,j=y.INTERNAL_FILE_DATA_TRANSFER_TYPE,K=D.Modal,be=E.reactFormat,Z=P.Tooltip,$=P.TooltipPosition,Se=N.static_url,se=L._,Te=L.ungettext,ae=o.createElement,ve=o.DOM,ue=ve.div,oe=ve.a,we=ve.ul,_e=ve.ol,me=ve.li,ye=ve.span,he=ve.input,de=ve.form,ge=ve.p,le=o.DOM,re=function(e){var t,s,r,o,n,i,a,l;return null==e&&(e={}),a=e.user,r=e.path,s=null!=(o=e.maxLength)?o:1e3,l=C.get_viewer(),l.is_paired&&a.is_team&&(i=c.em_snippet(l.team_name,s)),n="/"===r?l.is_paired?a.is_team?se(" upload to your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({team_name:i}):se(" upload to your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}):se(" upload to your Dropbox"):(t=c.em_snippet(h.filename(r),s),l.is_paired?a.is_team?se(" upload to the folder ‘%(folder)s’ in your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t,team_name:i}):se(" upload to the folder ‘%(folder)s’ in your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}):se(" upload to the folder ‘%(folder)s’",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}))},Y=o.createClass({displayName:"OutOfQuotaModal",mixins:[m(te)],propTypes:{expProDragDropOverquotaModal:o.PropTypes.string},_get_state_from_stores:function(){return{fileList:te.fileList()}},render:function(){var e,t,s;return t=this._outOfQuotaErrorFile(),e=(null!=t&&null!=(s=t.errorMessage)?s.length:void 0)>0?t.errorMessage:se("Something went wrong while uploading this file. If the problem persists, please try the basic uploader."),le.div({ref:"container"},ae(K,{ref:"modal",title:se("Your Dropbox is full"),showX:!0,className:"upload-overquota-modal--pro-variant",buttonComponent:this._renderButton()},le.div({className:"upload-overquota-modal--pro-variant__content"},null!=t?le.div({className:"filename-col"},ae(I,{className:"file-image",group:"web",name:h.file_icon(t.name),alt:""}),le.span({className:"filename"},c.em_snippet(t.name,this.FILENAME_SNIPPET_LENGTH)),null!=t.size?le.span({className:"size"}," - ",d.format_bytes(t.size)):void 0,le.span({className:"error-msg"},se("Upload Error")),le.span({className:"error-details error-status"},ae(Z,{position:$.RIGHT,tooltip_contents:le.div({},e),tooltip_classname:"upload-error-tooltip"},ae(I,{className:"error-icon",group:"web",name:"information",alt:se("More information")})))):void 0,le.button({className:"upload-overquota-modal--pro-variant__add_more_files_button c-btn c-btn--secondary c-btn--disabled",disabled:!0},se("Add more files")),le.div({className:"upload-overquota-modal--pro-variant__out-of-space"},se("You can’t upload files because you’re out of space.")))))},_renderButton:function(){var e;return e="/pro/buy","V2"===this.props.expProDragDropOverquotaModal?e="/upgrade":"V3"===this.props.expProDragDropOverquotaModal&&(e="/pro/out-of-space"),le.div({className:"upload-overquota-modal--pro-variant__button-container"},le.div({className:"upgrade-text"},se("In order to finish uploading, you need to get more space")),ae(fe,{importance:"primary",className:"upgrade-button",href:U({path:e,query:{oqa:"upl_b"}})},se("Upgrade for more space")))},_outOfQuotaErrorFile:function(){var e,t,s,r;if(this.state.fileList.last().errorType===J.OVER_QUOTA_ERROR)return this.state.fileList.last();for(r=this.state.fileList.toArray(),t=0,s=r.length;s>t;t++)if(e=r[t],e.errorType===J.OVER_QUOTA_ERROR)return e}}),z=o.createClass({displayName:"FileUploaderModal",mixins:[m(te)],DROPZONE_ID:"upload-modal-dropzone",propTypes:{dragAndDropEnabled:o.PropTypes.bool,shouldShowDestinationLink:o.PropTypes.bool,onModalDismissed:o.PropTypes.func,clickOutToClose:o.PropTypes.bool,sendNS:o.PropTypes.bool,isTeamOnboarding:o.PropTypes.bool},getDefaultProps:function(){return{dragAndDropEnabled:!0,shouldShowDestinationLink:!0,onModalDismissed:function(){},clickOutToClose:!0,sendNS:!1,isTeamOnboarding:!1}},getInitialState:function(){return{isBasicOverquotaUser:!1,isLimitedTeamOverquotaUser:!1,usingBasicUploader:!1,basicUploaderFile:null}},_get_state_from_stores:function(){return{path:te.path(),ns_id:q.context().currentNSID,ns_path:q.context().currentNSPath,user:te.user(),fileList:te.fileList(),numDraggingFiles:te.numDraggingFiles(),currentUpload:te.currentUpload(),numSecondsLeft:te.numSecondsLeft(),hasPermissionToUploadToFolder:te.hasPermissionToUploadToFolder()}},componentDidMount:function(){var e;return this._setBrowseButton(),t(window).on("resize.uploaderModal",function(e){return function(){return e._setBrowseButton()}}(this)),e=R.quota_fraction>1&&0===this.state.user.paid,this.setState({isBasicOverquotaUser:this.state.user.role===R.ROLE_PERSONAL&&e}),this.state.user.role===R.ROLE_WORK?(q.add_change_listener(this._handleBrowseStoreChanged),this._handleBrowseStoreChanged()):void 0},_handleBrowseStoreChanged:function(){var e,t,s,r;return e=q.context(),t=this.state.user.is_team&&C.get_viewer().team_is_limited,e.cdmMveQuotaStats&&e.isInsideTeamFolderTree&&t?(r=e.cdmMveQuotaStats,s=r.quotaRawBytesUsed>r.quotaRawBytes):s=R.quota_fraction>1&&0===this.state.user.paid,this.setState({isLimitedTeamOverquotaUser:s})},componentDidUpdate:function(e,s){var r,o,i,a,l;return this._setBrowseButton(),this.state.numDraggingFiles?this.state.usingBasicUploader?k.error("You can‖t drag and drop upload right now."):(r=t(n.findDOMNode(this.refs.modal.refs.modalBox)).find("#"+this.DROPZONE_ID),r.length||t("#"+this.DROPZONE_ID).clone().prependTo(t(n.findDOMNode(this.refs.modal.refs.modalBox))).css({width:"100%",height:"100%",position:"absolute",opacity:0}).show().fadeTo(500,1)):t(n.findDOMNode(this.refs.modal)).find("#"+this.DROPZONE_ID).remove(),this.state.fileList.count()>s.fileList.count()&&(a=t(n.findDOMNode(this.refs.uploadFilesList)),o=null!=(l=a.find(".upload-file"))?l.eq(s.fileList.count()):void 0,o.length&&a.scrollTop(a.scrollTop()+o.position().top)),i=t(n.findDOMNode(this)),i.find(".basic-uploader-link").off("click.switchUploader").on("click.switchUploader",function(e){return function(t){return t.preventDefault(),e.setState({usingBasicUploader:!0})}}(this)),i.find(".enhanced-uploader-link").off("click.switchUploader").on("click.switchUploader",function(e){return function(t){return t.preventDefault(),e.setState({usingBasicUploader:!1})}}(this))},componentWillUnmount:function(){return S.setBrowseButton(null),t(window).off("resize.uploaderModal"),this.state.user.role===R.ROLE_WORK?q.remove_change_listener(this._handleBrowseStoreChanged):void 0},FILENAME_SNIPPET_LENGTH:15,DEST_SNIPPET_LENGTH:13,_setBrowseButton:function(){return S.setBrowseButton(n.findDOMNode(this.refs.pluFileChooseButton))},_handleClose:function(){var e,t;t=this.state.fileList.find(function(e){var t;return(t=e.status)===G.PENDING||t===G.UPLOADING}),t||ee.setIsInlineStatusDismissed({isInlineStatusDismissed:!0}),ee.setIsUploadModalOpen({isUploadModalOpen:!1}),K.close(),"function"==typeof(e=this.props).onModalDismissed&&e.onModalDismissed()},_handleCancel:function(e){return ee.cancelUploads({files:[e]})},_handleBasicChooseButtonMouseClick:function(e){return null!=this.refs.fileInput?t(n.findDOMNode(this.refs.fileInput)).click():void 0},_handleBasicFileInputChange:function(e){var t,s,r,o,i,a;return H.logUploadFile({uid:this.state.user.id,num_files:1,num_dirs:0,uploader_type:"basic",upload_method:"chooser"}),r=n.findDOMNode(this.refs.fileInput),s=null!=(o=r.files)&&"function"==typeof o.item?o.item(0):void 0,a=r.value,null!=s?(i={name:s.name,size:s.size,userId:this.state.user.id,percentUploaded:100,status:G.UPLOADING},this.props.sendNS?(i.ns_id=this.state.ns_id,i.ns_path=this.state.ns_path+"/"+s.name):i.dest=this.state.path,this.setState({basicUploaderFile:new W(i)},function(e){return function(){return n.findDOMNode(e.refs.basicUploadForm).submit()}}(this))):null!=a?(t="C:\\fakepath\\",0===a.indexOf(t)?this.setState({basicUploaderFile:new W({name:a.slice(t.length),size:null,dest:this.state.path,userId:this.state.user.id,percentUploaded:100,status:G.UPLOADING})},function(e){return function(){return n.findDOMNode(e.refs.basicUploadForm).submit()}}(this)):n.findDOMNode(this.refs.basicUploadForm).submit()):void 0},_renderIntroModalButtons:function(){var e,t,s;return e=le.div({className:"u-font-small"},this.state.isBasicOverquotaUser?be(se("Before you can upload files, you need to <overQuotaLink>get more space</overQuotaLink>."),{overQuotaLink:le.a({className:"overquota-uploader-link",href:"/upgrade?oqa=upl"})}):this.state.isLimitedTeamOverquotaUser?be(se("Before you can upload files, you need to <overQuotaLink>get more space</overQuotaLink>."),{overQuotaLink:le.a({className:"overquota-uploader-link",href:"/team/upgrade?_tk=over_quota&_camp=upload_modal&oqa=upl"})}):null!=this.state.basicUploaderFile?se("This may take a while depending on the size of the file."):this.state.usingBasicUploader?be(se("Uploading multiple files? Try our <enhancedUploaderLink>enhanced uploader</enhancedUploaderLink>."),{enhancedUploaderLink:le.a({href:"#",className:"enhanced-uploader-link"})}):be(se("Having problems? Try the <basicUploaderLink>basic uploader</basicUploaderLink>."),{basicUploaderLink:le.a({href:"#",className:"basic-uploader-link"})})),t=null,s=null,this.state.isBasicOverquotaUser?t=ae(fe,{className:"dbmodal-button c-btn c-btn--primary",href:"/pro/buy?oqa=upl_b"},se("Upgrade to Upload")):this.state.isLimitedTeamOverquotaUser?t=ae(fe,{className:"dbmodal-button c-btn c-btn--primary",href:"/team/upgrade?_tk=over_quota&_camp=upload_modal&oqa=upl_b"},se("Upgrade to Upload")):this.state.usingBasicUploader?null==this.state.basicUploaderFile&&(t=le.button({className:"dbmodal-button c-btn c-btn--primary",onClick:this._handleBasicChooseButtonMouseClick},se("Choose a file"))):t=le.button({ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--primary"},se("Choose files")),null==this.state.basicUploaderFile&&(s=le.button({importance:"tertiary",className:"dbmodal-button c-btn c-btn--secondary u-mar-left-s",onClick:this._handleClose},se("Cancel"))),this.state.isBasicOverquotaUser||this.state.isLimitedTeamOverquotaUser?le.div({className:"u-mar-vertical-l clearfix"},le.div({className:"u-l-fr"},t,s,le.div({id:"upload-overquota-banner",className:"c-banner c-banner--warning"},e))):le.div({className:"u-mar-top-l"},ae(w,{spacing:"s",rightAttachment:le.div({},t,s)},e))},_renderFileListModalButtons:function(){var e,t,s,r;return s=this.state.fileList.find(function(e){var t;return(t=e.status)===G.PENDING||t===G.UPLOADING}),t=s?"tertiary":"primary",r=le.button({ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--secondary"},se("Add more files")),e=le.button({className:"dbmodal-button c-btn c-btn--"+t,onClick:this._handleClose},se(s?"Hide":"Done")),le.div({className:"u-mar-top-s"},ae(w,{leftAttachment:r,rightAttachment:e,spacing:"s"},le.div({className:"u-font-small"},s?void 0:be(se("Having problems? Try the <basicUploaderLink>basic uploader</basicUploaderLink>."),{basicUploaderLink:le.a({href:"#",className:"basic-uploader-link"})}))))},_renderIntroMessage:function(){var e,t,s,r;return s=re({user:this.state.user,path:this.state.path}),le.span({},this.state.isBasicOverquotaUser||this.state.isLimitedTeamOverquotaUser?se("You can’t upload files because you’re out of space. Before you can upload to Dropbox, you need to get more space."):this.state.usingBasicUploader?se("Choose a file to %(upload_folder_name)s. The basic uploader can only upload one file at a time.",{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"'}).format({upload_folder_name:s}):this.props.isTeamOnboarding?(r=C.get_viewer(),e=1e3,t=c.em_snippet(r.team_name,e),se("Choose files to add to the %(team_name)s team folder. You can also drag and drop files onto this page to upload them. Anyone who joins the %(team_name)s Dropbox will have access to files in the team folder.").format({team_name:t})):this.props.dragAndDropEnabled?se("Choose files to %(upload_folder_name)s. You can select more than one file at a time. You can also drag and drop files anywhere on this page to start uploading.",{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"'}).format({upload_folder_name:s}):se("Choose files to %(upload_folder_name)s. You can select more than one file at a time.",{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"'}).format({upload_folder_name:s}))},_renderDropzone:function(){return le.div({ref:"dropzone",id:this.DROPZONE_ID,style:{display:"none"}},le.div({},Te("Drop your file to %(upload_action)s","Drop your files to %(upload_action)s",this.state.numDraggingFiles,{comment:"upload_action is a phrase like 'upload to folder 'XYZ'"}).format({upload_action:re({user:this.state.user,path:this.state.path,maxLength:20})})))},_renderFileListRowStatus:function(e){var t;return le.div({className:"status-col"},e.status===G.UPLOADING&&100===e.percentUploaded?ae(T,{src:Se("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),srcHiRes:Se("/static/images/icons/ajax-loading-small@2x-vflAxdZTP.gif")}):(t=e.status)===G.PENDING||t===G.UPLOADING?le.button({className:"button-as-link",onClick:function(t){return function(s){return s.preventDefault(),t._handleCancel(e)}}(this)},ae(I,{group:"web",name:"xclose",alt:se("Cancel")})):e.status===G.COMPLETE?ae(I,{group:"web",name:"s_check",alt:se("Upload successful")}):e.status===G.CANCELLED?ae(T,{src:Se("/static/images/cancelsync-vflGFIEUK.png"),srcHiRes:Se("/static/images/cancelsync@2x-vflzmHGI0.png"),alt:se("Upload cancelled")}):e.status===G.FAILED?ae(T,{src:Se("/static/images/nosync-vfl18cuTS.png"),srcHiRes:Se("/static/images/nosync@2x-vflgS4F07.png"),alt:se("Error")}):void 0)},_renderFileListRowError:function(e){var t,s;return t=(null!=(s=e.errorMessage)?s.length:void 0)>0?e.errorMessage:se("Something went wrong while uploading this file. If the problem persists, please try the basic uploader."),le.div({className:"error-col"},le.span({className:"error-msg"},se(e.errorType===J.FILE_SIZE_ERROR?"File too large":"Upload Error")),le.span({className:"error-details"},ae(Z,{position:$.RIGHT,tooltip_contents:le.div({},t),tooltip_classname:"upload-error-tooltip"},ae(I,{group:"web",name:"information",alt:se("More information")}))))},_renderFileListRowDest:function(e){var t,s;return le.div({className:"dest-col"},e.status===G.CANCELLED?se("Canceled"):(s=C.get_viewer().get_user_by_id(e.userId),t=ce(s),le.a({href:ne(s,e.dest).toString()},c.em_snippet(""+t+e.dest,this.DEST_SNIPPET_LENGTH,0))))},_renderFileListRow:function(e,t){var s,o;return s=e.status===G.UPLOADING?e.percentUploaded:e.status===G.PENDING?0:100,o={"upload-file":!0,complete:e.status===G.COMPLETE,cancelled:e.status===G.CANCELLED,error:e.status===G.FAILED},le.li({className:r(o),key:e.uploadId},le.div({className:"upload-progress-bar",style:{width:s+"%"}}),le.div({className:"upload-file-info",style:{overflow:"hidden"}},le.div({className:"filename-col"},ae(I,{group:"web",name:h.file_icon(e.name),alt:""}),le.span({className:"filename"},c.em_snippet(e.name,this.FILENAME_SNIPPET_LENGTH)),null!=e.size?le.span({className:"size"
}," - ",d.format_bytes(e.size)):void 0),e.status!==G.FAILED?t?this._renderFileListRowDest(e):void 0:this._renderFileListRowError(e),this._renderFileListRowStatus(e)))},_renderFileList:function(e,t){var s,r,o;return o=null!=(r=(null!=t?t:{}).shouldShowDestinationLink)?r:!0,le.ol({ref:"uploadFilesList",id:"upload-files-list",style:{margin:0,padding:0,maxHeight:228,overflowY:"auto",position:"relative"}},function(){var t,r,n;for(n=[],t=0,r=e.length;r>t;t++)s=e[t],n.push(this._renderFileListRow(s,o));return n}.call(this))},_renderTimeLeft:function(){var e;return e=this.state.currentUpload,null!=e&&e.status===G.UPLOADING?le.div({style:{marginTop:8,textAlign:"right"}},se("%(time_left)s left").format({time_left:p.format_time(this.state.numSecondsLeft)})):void 0},_renderBasicUploaderForm:function(){return le.form({id:"basic-upload-form",ref:"basicUploadForm",encType:"multipart/form-data",noValidate:"novalidate",method:"post",action:"https://"+F.BLOCK_CLUSTER+"/upload"},le.input({type:"hidden",name:"t",value:x.read(M.JS_CSRF_COOKIE)}),le.input({type:"hidden",name:"_subject_uid",value:this.state.user.id}),le.input({type:"hidden",name:"plain",value:"yes"}),le.input({type:"hidden",name:"dest",value:this.state.path}),this.props.sendNS?[le.input({type:"hidden",name:"ns_id",value:this.state.ns_id}),le.input({type:"hidden",name:"ns_path",value:this.state.ns_path})]:void 0,le.input({type:"file",name:"file","aria-label":se("Upload file"),tabIndex:"-1",style:{display:"none"},ref:"fileInput",onChange:this._handleBasicFileInputChange}))},render:function(){var e;return e=se(this.props.isTeamOnboarding?"Which files would you like to add?":"Upload to Dropbox"),le.div({ref:"container"},this._renderDropzone(),ae(K,{ref:"modal",title:e,showX:!1,clickOutToClose:this.props.clickOutToClose,buttonComponent:0===this.state.fileList.count()||this.state.usingBasicUploader?this._renderIntroModalButtons():this._renderFileListModalButtons(),onDismiss:function(e){return function(t){return null!=e.state.basicUploaderFile?void t.preventDefault():ee.setIsUploadModalOpen({isUploadModalOpen:!1})}}(this)},this.state.usingBasicUploader?this._renderBasicUploaderForm():void 0,null!=this.state.basicUploaderFile?this._renderFileList([this.state.basicUploaderFile],{shouldShowDestinationLink:!1}):0===this.state.fileList.count()||this.state.usingBasicUploader?this._renderIntroMessage():this._renderFileList(this.state.fileList.toArray(),{shouldShowDestinationLink:this.props.shouldShowDestinationLink}),this._renderTimeLeft()))}}),Q=o.createClass({displayName:"InlineUploadStatus",propTypes:{fileList:o.PropTypes.instanceOf(s.OrderedMap).isRequired,currentUpload:o.PropTypes.instanceOf(W),numSecondsLeft:o.PropTypes.number,onViewDetails:o.PropTypes.func,expProDragDropOverquotaModal:o.PropTypes.string},FILENAME_SNIPPET_LENGTH:30,_getOverallUploadState:function(){return this.props.fileList.find(function(e){var t;return(t=e.status)===G.PENDING||t===G.UPLOADING})?"uploading":this.props.fileList.find(function(e){return e.status===G.FAILED})?"error":"complete"},_getProgressBarWidth:function(){var e;return e=this._getOverallUploadState(),"uploading"===e&&null!=this.props.currentUpload?this.props.currentUpload.percentUploaded:"complete"===e||"error"===e?100:0},_getNumPendingFiles:function(){return this.props.fileList.count(function(e){return e.status===G.PENDING})},_getNumCompletedFiles:function(){return this.props.fileList.count(function(e){return e.status===G.COMPLETE})},_getNumNoncancelledFiles:function(){return this.props.fileList.count(function(e){return e.status!==G.CANCELLED})},_getNumErrors:function(){return this.props.fileList.count(function(e){return e.status===G.FAILED})},_renderIcon:function(){var e;return e=this._getOverallUploadState(),"uploading"===e?ae(I,{group:"web",name:"s_sync",alt:se("Uploading")}):"complete"===e?ae(I,{group:"web",name:"s_check",alt:se("Upload successful")}):ae(T,{src:Se("/static/images/nosync-vfl18cuTS.png"),srcHiRes:Se("/static/images/nosync@2x-vflgS4F07.png"),alt:se("Error")})},_renderCloseButton:function(){return le.button({className:"button-as-link",onClick:function(e){return e.preventDefault(),ee.setIsInlineStatusDismissed({isInlineStatusDismissed:!0})}},ae(I,{group:"web",name:"xclose",alt:se("Close")}))},_renderViewDetailsLink:function(){var e,t;return e=this._getNumPendingFiles(),"V1"===(t=this.props.expProDragDropOverquotaModal)||"V2"===t||"V3"===t?e>0?le.span({className:"details"},Te(" - %(num_pending_files)d file left"," - %(num_pending_files)d files left",e).format({num_pending_files:e})):void 0:le.span({className:"details"}," - ",le.button({className:"view-details button-as-link",onClick:function(e){return function(t){var s;return t.preventDefault(),"function"==typeof(s=e.props).onViewDetails?s.onViewDetails():void 0}}(this)},e>0?Te("%(num_pending_files)d file left","%(num_pending_files)d files left",e).format({num_pending_files:e}):se("View details")))},_renderFileDescription:function(){var e,t,s,r;return r=this._getOverallUploadState(),s=this._getNumNoncancelledFiles(),t=this._getNumErrors(),le.span({className:"file-desc"},null!=this.props.currentUpload?se("Uploading %(filename)s").format({filename:c.em_snippet(this.props.currentUpload.name,this.FILENAME_SNIPPET_LENGTH)}):"uploading"===r?se("Starting upload..."):"complete"===r?s>1?se("Uploaded %(num_files)d files").format({num_files:s}):se("Uploaded %(filename)s").format({filename:c.em_snippet(this.props.fileList.last().name,this.FILENAME_SNIPPET_LENGTH)}):"error"===r?s>1?[se("Uploaded %(num_completed)d of %(num_files)d files").format({num_completed:this._getNumCompletedFiles(),num_files:s})," ",le.span({className:"num-errors"},Te("- %d error","- %d errors",t).format(t))]:(e=this.props.fileList.last().errorType,e===J.GENERIC?se("Unable to upload %(filename)s").format({filename:c.em_snippet(this.props.fileList.last().name,this.FILENAME_SNIPPET_LENGTH)}):se("Unable to upload %(filename)s: %(reason)s").format({filename:c.em_snippet(this.props.fileList.last().name,this.FILENAME_SNIPPET_LENGTH),reason:function(){switch(e){case J.OVER_QUOTA_ERROR:return se("over quota");case J.FILE_SIZE_ERROR:return se("file too large");case J.CONNECTION_ERROR:return se("lost connection");case J.HTTP_ERROR:return se("server error");case J.EMPTY_OR_FOLDER:return se("can’t upload folders or empty files");case J.PACKAGE_FILE:return se("OSX package file")}}()})):void 0)},render:function(){var e,t;return e=this._getOverallUploadState(),t={"upload-file":!0,error:"error"===e,complete:"complete"===e},le.div({id:"inline-upload-status",className:r(t)},le.div({className:"inline-upload-info"},le.div({className:"icon"},this._renderIcon()),le.div({className:"files-info"},this._renderFileDescription(),le.span({className:"num-errors"}),this._renderViewDetailsLink()),le.div({className:"status"},"uploading"===e&&null!=this.props.numSecondsLeft?se("%(time_left)s left").format({time_left:p.format_time(this.props.numSecondsLeft)}):this._renderCloseButton())),le.div({className:"inline-upload-bar"},le.div({className:"inline-upload-progress",style:{width:this._getProgressBarWidth()+"%"}})))}}),pe=null,V=o.createClass({displayName:"FileUploader",mixins:[m(te)],propTypes:{dragAndDropEnabled:o.PropTypes.bool,shouldShowDestinationLink:o.PropTypes.bool,onFileUploadComplete:o.PropTypes.func,onAllFileUploadsComplete:o.PropTypes.func,onModalDismissed:o.PropTypes.func,clickOutToClose:o.PropTypes.bool,sendNS:o.PropTypes.bool,expProDragDropOverquotaModal:o.PropTypes.string},statics:{showModal:function(){return pe?pe.showModal():void console.warn("Tried to show the file upload modal, but no FileUploader component has been instantiated on the page yet.")},showOOQVariantModal:function(){return pe?pe.showOOQVariantModal():void console.warn("Tried to show the out of quota modal, but no FileUploader component has been instantiated on the page yet.")},showModalWithTeamOnboarding:function(){return pe?pe.setState({isTeamOnboarding:!0},pe.showModal):void 0}},getDefaultProps:function(){return{dragAndDropEnabled:!0,shouldShowDestinationLink:!0,onFileUploadComplete:function(){},onAllFileUploadsComplete:function(){},onModalDismissed:function(){},clickOutToClose:!0,sendNS:!1}},getInitialState:function(){return{isTeamOnboarding:!1,hasOverquotaError:!1}},_get_state_from_stores:function(){return{path:te.path(),ns_id:q.context().currentNSID,ns_path:q.context().currentNSPath,user:te.user(),fileList:te.fileList(),numDraggingFiles:te.numDraggingFiles(),isInternalTransfer:te.isInternalTransfer(),currentUpload:te.currentUpload(),isUploadModalOpen:te.isUploadModalOpen(),numSecondsLeft:te.numSecondsLeft(),isInlineStatusDismissed:te.isInlineStatusDismissed(),hasPermissionToUploadToFolder:te.hasPermissionToUploadToFolder()}},INLINE_STATUS_CONTAINER_CLASS:"inline-upload-status-container",showModal:function(){return K.showInstance(ae(z,{dragAndDropEnabled:this.props.dragAndDropEnabled,shouldShowDestinationLink:this.props.shouldShowDestinationLink,onModalDismissed:this.props.onModalDismissed,clickOutToClose:this.props.clickOutToClose,isTeamOnboarding:this.state.isTeamOnboarding,sendNS:this.props.sendNS})),ee.setIsUploadModalOpen({isUploadModalOpen:!0})},showOOQVariantModal:function(){return K.showInstance(ae(Y,{expProDragDropOverquotaModal:this.props.expProDragDropOverquotaModal}))},componentWillMount:function(){if(pe)throw new Error("Only one FileUploader component may be rendered to the page at any time. You have tried to instantiate multiple uploaders.");return pe=this},componentDidMount:function(){var s;return ee.initPLU(),ee.setSendNS(this.props.sendNS),this.dragEnterCount=0,this.lastEnteredElement=null,s=t(document),s.on("dragover.fileUploader",function(e){return e.preventDefault(),e.stopPropagation()}).on("dragenter.fileUploader",function(t){return function(s){var r,o,n,a;return s.preventDefault(),s.stopPropagation(),s.target!==t.lastEnteredElement?(t.lastEnteredElement=s.target,t.dragEnterCount+=1,n=function(){var e;try{return null!=(e=s.originalEvent.dataTransfer.mozItemCount)?e:Object.keys(s.originalEvent.dataTransfer.items).length}catch(e){return 1}}(),a=s.originalEvent.dataTransfer.types,r=["Files","application/x-moz-file",j,"text/x-moz-url","text/uri-list","Url"],null!=a&&(null!=a.indexOf&&i.intersection(a,r).length>0||a instanceof DOMStringList&&(a.contains("Files")||a.contains("text/x-moz-url")||a.contains(j)||A.msie&&(a.contains("Text")||a.contains("text/plain"))))?(o=e.call(a,j)>=0||e.call(a,"text/plain")>=0||a instanceof DOMStringList&&(a.contains("Text")||a.contains("text/plain")),ee.setNumDraggingFiles({numDraggingFiles:n,isInternalTransfer:o})):void 0):void 0}}(this)).on("dragleave.fileUploader",function(e){return function(t){return t.preventDefault(),t.stopPropagation(),e.lastEnteredElement=null,e.dragEnterCount-=1,e.dragEnterCount<1?(e.dragEnterCount=0,ee.setNumDraggingFiles({numDraggingFiles:0})):void 0}}(this)).on("drop.fileUploader",this._handleFileDrop),t("<div>").addClass(this.INLINE_STATUS_CONTAINER_CLASS).prependTo(t("#page-content")),t(window).on("beforeunload.fileUploader",function(e){return function(t){var s,r;return s=null!=e.state.fileList.find(function(e){var t;return(t=e.status)===G.PENDING||t===G.UPLOADING}),s&&e.state.fileList.count()>0?(r=se("Leaving this page will cancel your uploads."),t.returnValue=r,r):void 0}}(this))},updateInlineStatus:function(){var e,s,r,o;return o=null!=this.state.fileList.find(function(e){var t;return(t=e.status)===G.PENDING||t===G.UPLOADING}),r=!this.state.isUploadModalOpen&&(o||this.state.fileList.count()>0&&!o&&!this.state.isInlineStatusDismissed),e=t("."+this.INLINE_STATUS_CONTAINER_CLASS),r?n.render(ae(Q,{fileList:this.state.fileList,currentUpload:this.state.currentUpload,onViewDetails:this._handleInlineStatusViewDetails,numSecondsLeft:this.state.numSecondsLeft,expProDragDropOverquotaModal:this.props.expProDragDropOverquotaModal}),e[0]):(s=e[0])?n.unmountComponentAtNode(s):void 0},componentWillReceiveProps:function(e){var t;return"V1"!==(t=this.props.expProDragDropOverquotaModal)&&"V2"!==t&&"V3"!==t||!this.showOverquotaError()?void 0:this.setState({hasOverquotaError:!0,isInlineStatusDismissed:!0})},componentWillUpdate:function(e,t){var s,r,o,n;return null==t.currentUpload&&null!=this.state.currentUpload&&("function"==typeof(s=this.props).onFileUploadComplete&&s.onFileUploadComplete(this.state.currentUpload),this.state.isTeamOnboarding&&X.log("uploaded_file")),t.fileList!==this.state.fileList&&(o=null!=t.fileList.find(function(e){var t;return(t=e.status)===G.PENDING||t===G.UPLOADING}),!o&&t.fileList.count()>0&&"function"==typeof(r=this.props).onAllFileUploadsComplete&&r.onAllFileUploadsComplete(this.state.fileList)),"V1"!==(n=this.props.expProDragDropOverquotaModal)&&"V2"!==n&&"V3"!==n||this.state.hasOverquotaError||!t.hasOverquotaError?void 0:this.showOOQVariantModal()},componentDidUpdate:function(e,s){var r,o;return r=t(".external-drop-indicator"),this.state.numDraggingFiles&&!this.state.isInternalTransfer?(s.numDraggingFiles||r.css("opacity",0).fadeTo(500,.6),this.state.hasPermissionToUploadToFolder?r.removeClass("external-drop-indicator--uploads-disabled"):r.addClass("external-drop-indicator--uploads-disabled"),this.state.isUploadModalOpen||(this.state.hasPermissionToUploadToFolder?(o=se("Drop your files to %(upload_action)s",{comment:"upload_action is a phrase like 'upload to folder 'XYZ'"}).format({upload_action:re({user:this.state.user,path:this.state.path})}),k.success(o,60)):k.error(se("You don’t have permission to add to this folder.")))):!this.state.numDraggingFiles&&s.numDraggingFiles&&(r.hide().removeClass("external-drop-indicator--uploads-disabled"),k.clear()),this.updateInlineStatus()},componentWillUnmount:function(){return t(document).off("dragover.fileUploader").off("dragenter.fileUploader").off("dragleave.fileUploader").off("drop.fileUploader"),t("."+this.INLINE_STATUS_CONTAINER_CLASS).remove(),t(window).off("beforeunload.fileUploader"),pe=null},_handleFileDrop:function(e){var t,s,r,o,n,i,a,l,p,d,c,h,m,f,g,b,v,y,S,w,T,D,E,I,P,N,C,F;if(e.preventDefault(),e.stopPropagation(),this.dragEnterCount=0,this.lastEnteredElement=null,ee.setNumDraggingFiles({numDraggingFiles:0}),t=e.originalEvent.dataTransfer,s=A.msie?"text":"application/x-dropbox-file-list",g=t.getData(s),null!=g)try{if(P=JSON.parse(g),F=P.userId,m=P.fromPath,d=P.filePaths,(null!=d?d.length:void 0)>0&&null!=m&&null!=F){if(q.context().isNonUserRelativeContext)return;return this.state.hasPermissionToUploadToFolder?F!==this.state.user.id?void k.error(se("You can’t move or copy files here from another Dropbox.")):(C=e.ctrlKey||e.altKey,C?_.copyFiles({files:d.map(function(e){return{fq_path:e}}),newPath:this.state.path}):m!==this.state.path&&(H.logMoveFiles({uid:F,path:m,files:d,newPath:this.state.path,source:B.DRAG}),_.moveFiles({path:m,files:d.map(function(e){return{fq_path:e}}),newPath:this.state.path})),void ee.setPath({path:q.path()})):void k.error(se("You don’t have permission to add to this folder."))}}catch(e){}if(this.state.hasPermissionToUploadToFolder){if(o=u.getDraggedLink(t),null!=o)return I=u.buildUrlLinkfileContents(o),E=new Blob([I],{type:"text/plain"}),D=U.parse(o).getAuthority(),E.name=D+".url",E.overwrite=!1,H.logUploadFile({uid:this.state.user.id,num_files:1,num_dirs:0,uploader_type:"drag",upload_method:"drag"}),void ee.addFilesToPLU({files:[E]});if(v=t.items,c=t.files,null!=(null!=v&&null!=(N=v[0])?N.webkitGetAsEntry:void 0)){for(i=function(){var e,t,s;for(s=[],f=e=0,t=v.length;t>=0?t>e:e>t;f=t>=0?++e:--e)s.push(v[f].webkitGetAsEntry());return s}(),l=function(){var e,t,s;for(s=[],e=0,t=i.length;t>e;e++)n=i[e],(null!=n?n.isFile:void 0)&&s.push(n);return s}(),r=function(){var e,t,s;for(s=[],e=0,t=i.length;t>e;e++)n=i[e],(null!=n?n.isDirectory:void 0)&&s.push(n);return s}(),H.logUploadFile({uid:this.state.user.id,num_files:l.length,num_dirs:r.length,uploader_type:"drag",upload_method:"drag"}),y=0,w=l.length;w>y;y++)p=l[y],p.file(function(e){return ee.addFilesToPLU({files:[e]})});if(r.length>0)return ee.addDirectoriesToPLU({directoryEntries:r})}else if(null!=(null!=c?c.length:void 0)){for(b=function(e){return null!=e&&null!=e.type&&null!=e.size&&""===e.type&&e.size%4096===0},c=function(){var e,t,s;for(s=[],f=e=0,t=c.length;t>=0?t>e:e>t;f=t>=0?++e:--e)s.push(c.item(f));return s}(),h=function(e){return function(){var t;return b(a)?(t=new FileReader,t.onerror=function(){var t,s;return t=null!=(s=e.state.fileList.find(function(e){var t;return((t=e.status)===G.PENDING||t===G.UPLOADING)&&e.name===a.name}))?s.toJS():void 0,null!=t?ee.manuallySetInErrorState({file:t,errorType:J.EMPTY_OR_FOLDER,errorMessage:se("This folder or empty file could not be uploaded because of browser limitations. Try zipping up the content before uploading it, or use the Dropbox desktop client to sync it.")}):void 0},t.readAsArrayBuffer(a)):void 0}}(this),S=0,T=c.length;T>S;S++)a=c[S],h();return H.logUploadFile({uid:this.state.user.id,num_files:c.length,num_dirs:0,uploader_type:"drag",upload_method:"drag"}),ee.addFilesToPLU({files:c})}}},_handleInlineStatusViewDetails:function(){return this.showModal()},showOverquotaError:function(){var e,t;return(null!=(e=this.state.fileList)&&null!=(t=e.last())?t.errorType:void 0)===J.OVER_QUOTA_ERROR},render:function(){return le.div({})}}),{FileUploader:V}})}.call(this);var __extends=this&&this.__extends||function(e,t){function s(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)};define("modules/clean/react/maestro/secondary_sidebar",["require","exports","external/react","modules/clean/react/css","modules/clean/react/prompt/react_ha"],function(e,t,s,r,o){"use strict";var n=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.render=function(){return s.createElement("div",{className:"maestro-secondary-sidebar"},this.props.children,s.createElement(o,null))},t}(s.Component);t.MaestroSecondarySidebar=r(n,["/static/css/dropbox/secondary_sidebar-vflh6WoAT.css"])}),function(){define("modules/clean/react/maestro/top_menu_container",["external/underscore","external/react","modules/clean/viewer","modules/clean/react/bubble_dropdown_v2","modules/clean/react/css","modules/clean/react/account_menu/account_menu","modules/clean/search/search_bar","modules/clean/react/user_notifications/dropdown","modules/clean/react/browse/constants","modules/core/browser","modules/core/exception","modules/core/uri","modules/clean/react/browse/models"],function(e,t,s,r,o,n,i,a,l,u,p,d,c){var h,m,f,_,g,assert,b,v;return _=l.SEARCH_PREFIX,assert=p.assert,h=c.File,f=c.Paper,v=t.DOM,b=t.createElement,g=t.createClass({displayName:"TopMenuContainer",propTypes:{user:t.PropTypes.object.isRequired,viewer:t.PropTypes.object.isRequired,showSearchBar:t.PropTypes.bool,currentPath:t.PropTypes.string,onSearch:t.PropTypes.func,onCancelSearch:t.PropTypes.func,onFileOrFolderOpen:t.PropTypes.func,limitedTeamBannerUpsell:t.PropTypes.bool,trademarkBusiness:t.PropTypes.string,onSelectUser:t.PropTypes.func.isRequired,isPagelet:t.PropTypes.bool},getDefaultProps:function(){return{showSearchBar:!0,currentPath:"/",isPagelet:!1}},onSearch:function(e){var t;return t=d({path:_+"/"+this.props.user.role}),e?u.open_tab(t.updateQuery({path:this.props.currentPath,query:e})):u.open_tab(t.updateQuery({path:this.props.currentPath}))},onFileOrFolderOpen:function(e){var t,s;return e instanceof h?e.is_dir?u.open_tab(e.href):(t=e.fq_path.substring(1),assert(this.props.user.role),s=d({path:"/"+this.props.user.role}).updateQuery({preview:t}),u.open_tab(s)):e instanceof f?u.open_tab(e.url):void 0},render:function(){return v.div({className:"top-menu-container"},this.props.showSearchBar?b(i,{user:this.props.user,currentPath:this.props.currentPath,isMaestroDesign:!0,isSearchActive:!1,onSearch:this.props.onSearch||this.onSearch,onCancelSearch:this.props.onCancelSearch,onFileOrFolderOpen:this.props.onFileOrFolderOpen||this.onFileOrFolderOpen,limitedTeamBannerUpsell:this.props.limitedTeamBannerUpsell,trademarkBusiness:this.props.trademarkBusiness}):void 0,v.div({className:"notifications-widget-container"},b(a,{isMaestroDesign:!0,isPagelet:this.props.isPagelet})),v.div({className:"account-menu-widget-container"},b(n,{user:this.props.user,viewer:this.props.viewer,onSelectUser:this.props.onSelectUser,showAccountSwitcher:!0,showNameOnButton:!1,position:r.POSITIONS.BOTTOM_LEFT,dropdownHorizontalDisplacement:-36,openLinksInNewTab:!0,showProGiftingLink:!0,showProUpgradeLink:!0,isMaestroDesign:!0})))}}),g=o(g,["/static/css/pagelet-vflM20uiV.css"],[i,a]),m=t.createClass({displayName:"PageletTopMenuContainer",render:function(){return b(g,e.extend({onSelectUser:function(e,t){return ensemble.switchAccount(t)}},this.props))}}),{TopMenuContainer:g,PageletTopMenuContainer:m}})}.call(this),function(){define("modules/clean/react/pro/pro_onboarding_tour_modal",["external/react","jquery","external/classnames","modules/clean/ajax","modules/clean/react/button","modules/clean/react/css","modules/clean/react/image","modules/clean/react/modal"],function(e,t,s,r,o,n,i,a){var l,u,p,d,c,h,m,f;return l=a.Modal,m=e.createElement,f=s,h=e.addons.CSSTransitionGroup,c=e.createClass({displayName:"ProOnboardingWelcomeScreen",propTypes:{tourPaths:e.PropTypes.array,onTourPathChange:e.PropTypes.func,contentSource:e.PropTypes.object},getInitialState:function(){return{tourPath:null}},setTourPathState:function(e){return this.setState({tourPath:e}),this.props.onTourPathChange(e)},renderMainText:function(t){var s;return t instanceof Array?(s=t.map(function(s,r){return e.createElement("li",{key:r,className:"onboarding-panel__checkmark"},t[r])}),e.createElement("ul",{className:"onboarding-panel__list"},s)):e.createElement("p",null,t)},render:function(){var t;return t=this.props.tourPaths.map(function(t){return function(s,r){var n,a,l,u,p;return p=t.props.contentSource[s].welcome,n=p["image-path"],a=null!=p["image-path-retina"]?p["image-path-retina"]:n,l=r<t.props.tourPaths.length-1,u=f({"onboarding-panel__column":!0,"onboarding-panel__column--rb":l}),e.createElement("div",{key:r,className:u},e.createElement("h2",{className:"onboarding-panel__title"},p.title),e.createElement("div",{className:"onboarding-panel__image"},e.createElement(i,{src:n,srcHiRes:a})),e.createElement("div",{className:"onboarding-panel__content"},t.renderMainText(p["main-text"])),e.createElement(o.link_button,{onClick:t.setTourPathState.bind(t,s),className:"onboarding-panel__button c-btn c-btn--primary"},p["button-text"]))}}(this)),e.createElement("div",{className:"onboarding-panel onboarding-panel--welcome"},t)}}),u=e.createClass({displayName:"ProOnboardingFeatureContent",propTypes:{tourStep:e.PropTypes.number,className:e.PropTypes.string,contentSource:e.PropTypes.object.isRequired,handleFeatureLinkClick:e.PropTypes.func},render:function(){var t,s,r;return t=f({"onboarding-panel__image":!0,"onboarding-panel__image--center":!0,"onboarding-panel__image--b":!0}),s=this.props.contentSource["image-path"],r=null!=this.props.contentSource["image-path-retina"]?this.props.contentSource["image-path-retina"]:s,e.createElement("div",{key:this.props.tourStep,className:"onboarding-panel__column"},e.createElement("h2",{className:"onboarding-panel__title"},this.props.contentSource.title),e.createElement("div",{className:t},e.createElement(i,{src:s,srcHiRes:r})),e.createElement("div",{className:"onboarding-panel__text"},this.props.contentSource["main-text"]),e.createElement(o.link_button,{className:"onboarding-panel__button c-btn c-btn--primary",href:this.props.contentSource["button-href"],target:"_blank",onClick:this.props.handleFeatureLinkClick},this.props.contentSource["button-text"]))}}),p=e.createClass({displayName:"ProOnboardingNavigation",propTypes:{handleTourForward:e.PropTypes.func,handleTourBackward:e.PropTypes.func,handleTourEnd:e.PropTypes.func,atTourEnd:e.PropTypes.bool},render:function(){var t,s;return s=e.createElement("div",{className:"onboarding-panel__nav--next",onClick:this.props.handleTourForward}),this.props.atTourEnd&&(t=f({"c-btn":!0,"c-btn--secondary":!0,"c-btn--big":!0,"c-btn--full":!0,"onboarding-panel__button":!0,"onboarding-panel__nav--fin":!0}),s=e.createElement("button",{onClick:this.props.handleTourEnd,className:t},"Go to my Dropbox")),e.createElement("div",{className:"onboarding-panel__nav"},e.createElement("div",{className:"onboarding-panel__nav--prev",onClick:this.props.handleTourBackward}),s)}}),d=e.createClass({displayName:"ProOnboardingTourModal",propTypes:{className:e.PropTypes.string,modalId:e.PropTypes.string.isRequired,onboardingPaths:e.PropTypes.array.isRequired,contentSource:e.PropTypes.object.isRequired},statics:{renderWithProps:function(e){var s,r,o;return s=n(d,["/static/css/payments/pro_trial_onboarding_tour-vfl8U7rsY.css"]),o={style:"lightbox",onDismiss:t("#pro-trial-tour-header-bubble").removeClass("force-hidden")},r=m(s,e),l.showInstance(m(l,o,r))}},getInitialState:function(){return{tourStep:0,tourPath:null,tourPathNumStep:null,atTourStart:!0,atTourEnd:!1}},onTourPathChange:function(e){var t;return t={selected_path:e},this._log("pro_onboarding_path_selected",t),this.setState({tourPath:e,atTourStart:!1,tourPathNumStep:this.props.contentSource[e].features.length-1})},tourForward:function(){var e;return e={selected_path:this.state.tourPath,tour_step:this.state.tourStep},this._log("pro_onboarding_tour_forward",e),this.setState({tourStep:this.state.tourStep+1,atTourStart:!1,atTourEnd:this.state.tourStep===this.state.tourPathNumStep-1})},tourBackward:function(){var e;return e={selected_path:this.state.tourPath,tour_step:this.state.tourStep},this._log("pro_onboarding_tour_backward",e),0===this.state.tourStep?this.setState({atTourStart:!0}):this.setState({tourStep:this.state.tourStep-1,atTourEnd:!1})},tourEnd:function(){var e;return e={selected_path:this.state.tourPath,tour_step:this.state.tourStep},this._log("pro_onboarding_tour_finish",e),l.close()},logLinkClick:function(){var e;return e={selected_path:this.state.tourPath,tour_step:this.state.tourStep},this._log("pro_onboarding_tour_link_click",e)},_log:function(e){return function(e,t){return r.WebRequest({url:"/pro/trial_onboarding_tour_log",data:{evt:e,extra_data:JSON.stringify(t)}})}}(this),render:function(){var t,s;return s=[],this.state.atTourStart?(t={selected_path:this.state.tourPath,tour_step:this.state.tourStep},this._log("pro_onboarding_tour_start",t),s.push(e.createElement(c,{key:"onboardingWelcome",contentSource:this.props.contentSource,tourPaths:this.props.onboardingPaths,onTourPathChange:this.onTourPathChange}))):s.push(e.createElement(h,{component:"div",transitionName:"fade",transitionLeave:!1},e.createElement(u,{key:this.state.tourPath+"-"+this.state.tourStep,tourStep:this.state.tourStep,handleFeatureLinkClick:this.logLinkClick,contentSource:this.props.contentSource[this.state.tourPath].features[this.state.tourStep]})),e.createElement(p,{key:"onboardingNav",atTourEnd:this.state.atTourEnd,handleTourForward:this.tourForward,handleTourBackward:this.tourBackward,handleTourEnd:this.tourEnd})),e.createElement("div",{id:this.props.modalId,className:this.props.className},s)}}),{ProOnboardingTourModal:d,ProOnboardingFeatureContent:u,ProOnboardingNavigation:p,ProOnboardingWelcomeScreen:c}})}.call(this),function(){define("modules/clean/react/prompt/react_ha",["external/react","external/react-dom","modules/clean/upsell/prompt_event_emitter"],function(e,t,s){var r,o;return o=e.DOM,r=e.createClass({displayName:"ReactHA",emitUpdateEvent:function(){return s.Emitter.emit(s.Events.REACT_HA_DID_UPDATE)},componentDidMount:function(){return this.emitUpdateEvent()},componentDidUpdate:function(){return this.emitUpdateEvent()},render:function(){return o.div({})}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/radio",["external/classnames","external/react","external/react-dom","modules/clean/teams/prop_types"],function(t,s,r,o){var n,i,a,l,u,p,d;return p=s.DOM,d=s.PropTypes,a={Normal:"normal",Large:"large"},u=Object.keys(a).map(function(e){return a[e]}),l=d.oneOfType([d.string,d.number,d.bool]),i=s.createClass({displayName:"RadioItem",propTypes:{className:d.string,value:l,_radioGroupData:d.shape({variant:d.oneOf(u),name:d.string.isRequired,radioGroupValue:l,onSelect:d.func})},_handleClick:function(){var e;this._isSelected()||(r.findDOMNode(this.refs.input).focus(),"function"==typeof(e=this.props._radioGroupData).onSelect&&e.onSelect(this.props.value))},_handleChange:function(){var e;"function"==typeof(e=this.props._radioGroupData).onSelect&&e.onSelect(this.props.value)},_getId:function(){return this.props._radioGroupData.name+"_"+this.props.value},_isSelected:function(){return this.props._radioGroupData.radioGroupValue===this.props.value},render:function(){var r,o,n,i;return o=this.props._radioGroupData,i=["c-radio-wrapper",this.props.className],r={"c-radio":!0},n=o.variant,e.call(u,n)>=0&&o.variant!==a.Normal&&(r["c-radio--"+o.variant]=!0),s.createElement("div",{className:t(i),onClick:this._handleClick},s.createElement("input",{id:this._getId(),ref:"input",type:"radio",name:o.name,value:this.props.value,checked:this._isSelected(),onChange:this._handleChange}),s.createElement("div",{className:t(r)},s.createElement("div",{className:"c-radio__inner"})),s.createElement("label",{className:"c-radio-content",htmlFor:this._getId()},this.props.children))}}),n=s.createClass({displayName:"RadioGroup",propTypes:{className:d.string,variant:d.oneOf(u),name:d.string,legend:d.string.isRequired,align:d.oneOf(["top","bottom","middle","baseline"]),displayLegend:d.bool,valueLink:o.valueLink(l).isRequired},getDefaultProps:function(){return{className:null,type:a.Normal,align:"middle",displayLegend:!1}},_onRadioItemSelect:function(e){var t;null!=(t=this.props.valueLink)&&t.requestChange(e)},render:function(){var e,r,o,n;return r=this.props.name||"radio-"+Math.floor(1e9*Math.random()),e=s.Children.map(this.props.children,function(e){return function(t){return t.type===i?s.cloneElement(t,{_radioGroupData:{variant:e.props.variant,name:r,radioGroupValue:e.props.valueLink.value,onSelect:e._onRadioItemSelect}}):t}}(this)),o={"c-radio-group__legend":!0,"ax-visually-hidden":!this.props.displayLegend},n=["c-radio-group","align-"+this.props.align,this.props.className],s.createElement("fieldset",{className:t(n)},s.createElement("legend",{className:t(o)},this.props.legend),e)}}),{RadioGroup:n,RadioItem:i,RadioItemVariant:a}})}.call(this),function(){define("modules/clean/react/sharing/shared_with_view",["external/classnames","external/react","modules/clean/avatar/inherited_count_avatar","modules/clean/avatar/size","modules/clean/components/loading_indicator","modules/clean/components/title_bubble","modules/clean/sharing/constants","modules/clean/em_string","modules/clean/react/browse/models","modules/clean/sharing/member_avatars","modules/clean/sharing/ui_util","modules/clean/static_urls","modules/clean/viewer","modules/constants/viewer","modules/core/i18n"],function(e,t,s,r,o,n,i,a,l,u,p,d,c,h,m){var f,_,g,b,v,y,S,w,T,D,E,I,P,N;return _=r.AVATAR_DIMENSION_BY_SIZE,w=i.SNIPPET_SIZES,b=l.File,v=p.GoldenGate,P=d.static_url,D=m._,N=m.ungettext,I=t.DOM,E=t.createElement,y=5,f=_.SMALL,g=12,S="--",T=t.createClass({displayName:"SharedWithView",mixins:[u],propTypes:{user:t.PropTypes.object.isRequired,file:t.PropTypes.instanceOf(b),onOverflowCountClick:t.PropTypes.func,onAvatarClick:t.PropTypes.func,groups:t.PropTypes.array,invitations:t.PropTypes.array,joinedMembers:t.PropTypes.array,numUndisplayableUsersAndInvites:t.PropTypes.number,numInheritedMembers:t.PropTypes.number,parentFolderName:t.PropTypes.string,animation:t.PropTypes.bool,titleButtonDirection:t.PropTypes.string,avatarDimension:t.PropTypes.number,maxVisibleAvatars:t.PropTypes.number,sharedLinkInfo:t.PropTypes.object,onSharedLinkClick:t.PropTypes.func,isMaestroDesign:t.PropTypes.bool,isInAudienceBox:t.PropTypes.bool,audienceDescription:t.PropTypes.string,hasSharedDataLoaded:t.PropTypes.bool,
isCurrentlyInRoot:t.PropTypes.bool},getDefaultProps:function(){return{titleButtonDirection:"south",avatarDimension:f,maxVisibleAvatars:y,file:null}},render:function(){return this.props.isInAudienceBox&&v.hasAudienceBox(this.props.user.id)?this.props.isCurrentlyInRoot&&!this.props.file?I.div({}):I.div({className:this.getClassName()},this.props.hasSharedDataLoaded?this.renderAudienceBoxAvatars():E(o,{style:o.LoadingIndicatorStyle.DOTS})):this.props.isMaestroDesign&&v.hasAudienceBox(this.props.user.id)?I.div({className:this.getClassName()},this.props.sharedLinkInfo?this.renderSharedLinkInColumn():void 0,this.renderAudienceDescription()):I.div({className:this.getClassName()},this.renderAvatars())},getClassName:function(){return e({"shared-with-members":!0,"shared-with-members--golden-gate":v.hasNewMembershipUI(this.props.user.id),clearfix:!0,"audience-box u-pad-top-xs u-pad-bottom-s u-mar-buttom-xs":this.props.isInAudienceBox})},renderSharedLinkInColumn:function(){var e;return e=this.props.onSharedLinkClick,E(n,{key:"shared_link",text:this.getDescriptionForSharedLinkInfo(this.props.sharedLinkInfo),direction:this.props.titleButtonDirection,className:"shared-with-members--audience-box"},I.img({src:P("/static/images/avatar/shared-link-icon-vflHCU_m6.svg"),alt:this.props.alt||D("Shared link"),width:g,height:g,onClick:function(t){return e(),t.stopPropagation()}}))},renderAudienceDescription:function(){var e,t,s,r,o,i,l,u,p,d,c;return t=(null!=(d=this.props.file)?d.isDeleted:void 0)?D("Deleted"):this.props.audienceDescription?this.props.audienceDescription:this.props.hasSharedDataLoaded?D("Only you"):S,p=this.props.onAvatarClick,e=I.div({className:"audience-description",onClick:function(e){return p(),e.stopPropagation()}},t),s=this.props.groups?this.props.groups:[],this.props.joinedMembers&&(s=s.concat(this.props.joinedMembers)),this.props.invitations&&(s=s.concat(this.props.invitations)),s.length>0&&(1!==s.length||s[0].user_id!==this.props.user.id)&&(c=s.slice(0,this.props.maxVisibleAvatars),u=function(){var e,t,s;for(s=[],e=0,t=c.length;t>e;e++)o=c[e],s.push(a.em_snippet(o.display_name||o.name||o.email_or_fbname,w.DISPLAY_NAME));return s}(),s.length+this.props.numUndisplayableUsersAndInvites>this.props.maxVisibleAvatars&&(u.pop(),i=s.length+this.props.numUndisplayableUsersAndInvites-(this.props.maxVisibleAvatars-1),l=N("and %(num)s more...","and %(num)s more...",i,{comment:"Number of additional members in the file. Expected to be >= 2."}).format({num:i}),u.push(l)),r=u.join("\n")),r?E(n,{key:"membership_column_bubble",respectLineBreaks:!0,text:r,direction:this.props.titleButtonDirection},e):e},renderAudienceBoxAvatars:function(){var e,t,s,r,o,n,i,a;return e=[],r=this.props.joinedMembers?this.props.joinedMembers:[],t=this.props.groups?this.props.groups.slice():[],s=this.props.invitations?this.props.invitations.slice():[],this.props.sharedLinkInfo&&e.push(this.renderSharedLink(this.props.sharedLinkInfo)),a=[],i=this.findOwnerAndMeInJoinedMembers(r),n=i[0],o=i[1],null!=o&&(a.push(o.user_id),e.push(this.renderJoinedMember(o))),this.addGroupsMembersInvitations(e,t,r,s,a),this.renderAvatarList(e,"audience-box-avatar-padding")},renderAvatars:function(){var e,t,s,r,o,n,i,a,l,u;return(null!=(a=this.props.file)?a.isDeleted:void 0)?I.span({"aria-hidden":!0},D("deleted")):(o=this.props.joinedMembers?this.props.joinedMembers:[],s=this.props.groups?this.props.groups.slice():[],r=this.props.invitations?this.props.invitations.slice():[],e=[],this.props.sharedLinkInfo&&e.push(this.renderSharedLink(this.props.sharedLinkInfo)),u=[],l=this.findOwnerAndMeInJoinedMembers(o),i=l[0],n=l[1],v.hasNewMembershipUI(this.props.user.id)||(null!=i&&i===n&&(i=null),null!=i&&(u.push(i.user_id),e.push(this.renderJoinedMember(i)))),null!=n&&u.push(n.user_id),this.addGroupsMembersInvitations(e,s,o,r,u),t=0===e.length&&(0===this.props.numInheritedMembers||!v.hasNewMembershipUI(this.props.user.id)),t?this.props.hasSharedDataLoaded?I.span({"aria-hidden":!0},S):void 0:this.renderAvatarList(e))}}),{SharedWithView:T}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/search/actions",["external/immutable","modules/clean/filepath","modules/clean/flux/dispatcher","modules/clean/history","modules/clean/react/browse/models","modules/clean/search/api","modules/clean/search/constants","modules/clean/search/store","modules/constants/viewer","modules/core/uri"],function(t,s,r,o,n,i,a,l,u,p){var d,c,h,m,f;return d=n.File,h=a.SearchActionTypes,f=a.SearchLoadingStates,c=u.ROLE_WORK,new(m=function(){function t(){this._loadDeletedResults=e(this._loadDeletedResults,this),this.loadMoreResults=e(this.loadMoreResults,this),this.searchApi=new i}return t.prototype.focusSearchBar=function(){return r.dispatch({type:h.FOCUS_SEARCH_BAR})},t.prototype.blurSearchBar=function(){return r.dispatch({type:h.BLUR_SEARCH_BAR})},t.prototype.setSearchQuery=function(e){var t,s,o,n,i;return s=e.nsid,o=e.path,n=e.query,i=e.user,t=e.groupByType,n!==l.rawQuery()?(r.dispatch({type:h.SET_SEARCH_QUERY,data:{query:n}}),l.isSearchBarLoading()?this.searchApi.loadSuggestions({user:i,nsid:s,path:o,query:l.normalizedQuery(),onSuccess:function(e){return function(s){var r;return r=s.searchResults,e.setSearchSuggestions({searchResults:r,groupByType:t})}}(this)}):void 0):void 0},t.prototype.setSearchSuggestions=function(e){var t,s;return s=e.searchResults,t=e.groupByType,r.dispatch({type:h.SET_SEARCH_SUGGESTIONS,data:{searchResults:s,groupByType:t}})},t.prototype.setHighlightedRow=function(e){var t;return t=e.index,r.dispatch({type:h.SET_HIGHLIGHTED_ROW,data:{index:t}})},t.prototype.highlightPreviousRow=function(){return r.dispatch({type:h.HIGHLIGHT_PREVIOUS_ROW})},t.prototype.highlightNextRow=function(){return r.dispatch({type:h.HIGHLIGHT_NEXT_ROW})},t.prototype.runSearch=function(e){var t,s,o;return o=e.user,t=e.path,s=e.query,r.dispatch({type:h.START_SEARCH,data:{query:s}}),this.searchApi.loadResults({user:o,path:t,query:s,loadDeleted:!1,start:0,onSuccess:function(e){return function(s){var r,n;return n=s.searchResults,r=s.context,e._setSearchResults({searchResults:n,context:r}),e._loadDeletedResults({path:t,user:o})}}(this)})},t.prototype.loadMoreResults=function(e){var t,s,o;if(t=e.path,o=e.user,l.loadingState()===f.LOADED){if(l.hasMoreResults())s=!1;else{if(!l.hasMoreResults(!0))return;s=!0}return r.dispatch({type:h.CONTINUE_SEARCH,data:{didLoadDeletedResults:s}}),this.searchApi.loadResults({user:o,path:t,query:l.latestQuery(),loadDeleted:s,start:s?l.numDeletedResults():l.searchResults().size,onSuccess:function(e){return function(s){var r,n,i;return i=s.searchResults,r=s.context,n=s.deleted,e._appendSearchResults({searchResults:i,context:r,deleted:n}),e._loadDeletedResults({path:t,user:o})}}(this)})}},t.prototype._setSearchResults=function(e){var t,s;return s=e.searchResults,t=e.context,r.dispatch({type:h.SET_SEARCH_RESULTS,data:{searchResults:s,context:t}})},t.prototype._appendSearchResults=function(e){var t,s,o;return o=e.searchResults,t=e.context,s=e.deleted,r.dispatch({type:h.APPEND_SEARCH_RESULTS,data:{searchResults:o,context:t,deleted:s}})},t.prototype._loadDeletedResults=function(e){var t,s;return t=e.path,s=e.user,l.hasMoreResults()||l.didLoadDeletedResults()?void 0:this.loadMoreResults({path:t,user:s})},t.prototype.setSearchSelection=function(e){var t;return t=e.selection,r.dispatch({type:h.SET_SEARCH_SELECTION,data:{selection:t}})},t.prototype.applyUpdatesFromNotserver=function(e){var t,o,n,i,a,u,p,c,m,f,_,g,b,v,y,S,w,T,D,E;for(y=e.payload,v=e.path,t=y.added,g=y.moved,T=y.removed,i=[],E=l.searchResults(),u=0,m=t.length;m>u;u++)o=t[u],o.fq_path.startsWith(v)&&(n=E.find(function(e){return s.paths_are_equal(e.fq_path,o.fq_path)}),n&&n.isDeleted&&(a=n.filename_highlights,b=d.fromServerObject(o).set("filename_highlights",a),i.push({before:n.fq_path,after:b})),n||i.push({before:null,after:d.fromServerObject(o)}));for(p=0,f=g.length;f>p;p++)w=g[p],S=w[0],o=w[1],S.startsWith(v)&&(n=E.find(function(e){return s.paths_are_equal(e.fq_path,S)}),n&&(a=n.filename_highlights,b=d.fromServerObject(o).set("filename_highlights",a),i.push({before:n.fq_path,after:null}),i.push({before:null,after:b})));for(c=0,_=T.length;_>c;c++)D=T[c],D.startsWith(v)&&(n=E.find(function(e){return s.paths_are_equal(e.fq_path,D)}),n&&!n.isDeleted&&(a=n.filename_highlights,b=n.set("isDeleted",!0).set("filename_highlights",a),i.push({before:n.fq_path,after:b})));return r.dispatch({type:h.CHANGE_FILES,data:{fileDeltas:i}})},t.prototype.removeSearchResults=function(e){var t,s;return s=e.fq_paths,t=s.map(function(e){return{before:e,after:null}}).toArray(),r.dispatch({type:h.CHANGE_FILES,data:{fileDeltas:t}})},t.prototype.clearSearch=function(){return r.dispatch({type:h.CLEAR_SEARCH})},t}())})}.call(this),function(){define("modules/clean/search/api",["modules/clean/analytics","modules/clean/ajax","modules/clean/react/browse/models","modules/clean/search/constants","modules/clean/search/search_type","modules/clean/search/store","modules/constants/browse"],function(e,t,s,r,o,n,i){var a,l,u,p;return p=e.SearchClientActivityLogger,a=s.BrowseContext,l=r.MaxResults,u=function(){function e(){this._activeRequest=null}return e.prototype.loadSuggestions=function(e){var t,s,r,o,a,u,p;return p=e.user,t=e.nsid,o=e.path,a=e.query,r=e.onSuccess,s=e.onError,u={query:a,fq_path:o,filename_only:!0,max_results:l.MAX_SEARCH_SUGGESTIONS,show_paper_results:i.SHOW_PAPER_SEARCH_RESULTS,show_unmounted_results:!0,ns_id:t,is_admin_console:n.browseContext().isNonUserRelativeContext},this._fetchResults(u,p,!1,r,s)},e.prototype.loadResults=function(e){var t,s,r,o,n,a,u,p;return p=e.user,o=e.path,n=e.query,t=e.loadDeleted,u=e.start,r=e.onSuccess,s=e.onError,a={query:n,fq_path:o,filename_only:!1,max_results:l.MAX_SEARCH_RESULTS,deleted:t,start:u,show_paper_results:i.SHOW_PAPER_SEARCH_RESULTS,show_unmounted_results:!0},this._fetchResults(a,p,t,r,s)},e.prototype.getUpdatesForResults=function(e){var s,r,o,n,i,a,l,u;return i=e.query,s=e.namespaceToJournalIdMap,a=e.showDeleted,u=e.user,o=e.onSuccess,n={all_terms:i,ns_map:function(){var e;e=[];for(r in s)l=s[r],e.push(r+"_"+l);return e}().join(","),show_deleted:a},t.WebRequest({url:"/update/list_search",data:n,dataType:"json",subject_user:u,success:function(e){return o(e)}})},e.prototype._extractBrowseContext=function(e){return new a({isInFolderMode:e.inside_dir,inactiveNSIDByFQPath:e.old_path_to_ns_id,permanentDeletionDisabledStateByNSID:e.permanent_delete_is_disabled_by_ns_id})},e.prototype._fetchResults=function(e,s,r,n,i){var a,l,u;return null!=(l=this._activeRequest)&&l.abort(),a={firefly:!0,path_scoped:!1,search_type:o.COMPLETION,query_string:e.query,infinite_scroll:e.start>0},p.log("query_started",s.id,a),u=(new Date).getTime(),this._activeRequest=t.WebRequest({url:"/ajax_fulltext_search",data:e,dataType:"json",subject_user:s,success:function(t){return function(o,i,l){var d,c,h,m,f,_,g,b;for(d=t._extractBrowseContext(o),g=o.search_results,f=l.getResponseHeader("x-dropbox-request-id"),b=!1,h=0,m=g.length;m>h;h++)_=g[h],_.request_id=f,"FILE"===_.search_result_type&&_.used_spellcorrect===!0&&(b=!0);return n({context:d,searchResults:g,loadDeleted:r}),c=g.length>0?g[0]:null,a=p.create_completion_log_dict(a,b,f,u,e.query,!0,g.length,null,c),p.log("query_completed",s.id,a)}}(this),error:function(e,t,r){var o;return"abort"!==t&&"function"==typeof i&&i(r),o=e.getResponseHeader("x-dropbox-request-id"),a=p.create_completion_log_dict(a,null,o,u,null,null,null,t),p.log("query_failed",s.id,a)},complete:function(){return this._activeRequest=null}})},e}()})}.call(this),function(){define("modules/clean/search/constants",["modules/clean/flux/action_type"],function(e){var t,s;return s=e.withActionNamespace,t={},t.MaxResults={MAX_SEARCH_SUGGESTIONS:8,MAX_SEARCH_RESULTS:100},t.SearchActionTypes=s("search",{SET_USER:"SET_USER",FOCUS_SEARCH_BAR:"FOCUS_SEARCH_BAR",BLUR_SEARCH_BAR:"BLUR_SEARCH_BAR",SET_SEARCH_QUERY:"SET_SEARCH_QUERY",SET_SEARCH_SUGGESTIONS:"SET_SEARCH_SUGGESTIONS",SET_HIGHLIGHTED_ROW:"SET_HIGHLIGHTED_ROW",HIGHLIGHT_PREVIOUS_ROW:"HIGHLIGHT_PREVIOUS_ROW",HIGHLIGHT_NEXT_ROW:"HIGHLIGHT_NEXT_ROW",START_SEARCH:"START_SEARCH",SET_SEARCH_RESULTS:"SET_SEARCH_RESULTS",CONTINUE_SEARCH:"CONTINUE_SEARCH",APPEND_SEARCH_RESULTS:"APPEND_SEARCH_RESULTS",CLEAR_SEARCH:"CLEAR_SEARCH",SET_SEARCH_SELECTION:"SET_SEARCH_SELECTION",CHANGE_FILES:"CHANGE_SEARCH_FILES"}),t.SearchLoadingStates={LOADED:"LOADED",LOADING_FIRST_PAGE:"LOADING_FIRST_PAGE",LOADING_ADDITIONAL_PAGE:"LOADING_ADDITIONAL_PAGE"},t})}.call(this),function(){define("modules/clean/search/search_bar",["jquery","external/purify","external/classnames","external/react","external/react-dom","external/underscore","modules/core/uri","modules/clean/analytics","modules/clean/filepath","modules/clean/flux/store_mixin","modules/clean/keycode","modules/clean/react/browse/models","modules/clean/react/button","modules/clean/react/css","modules/clean/react/input","modules/clean/react_format","modules/clean/react/sprite","modules/clean/search/actions","modules/clean/search/search_helpers","modules/clean/search/store","modules/clean/search/util","modules/core/accessible_announce","modules/core/browser","modules/core/i18n"],function(e,t,s,r,o,n,i,a,l,u,p,d,c,h,m,f,_,g,b,v,y,S,w,T){var D,E,I,P,N,C,F,M,R,A,x,O,L,k,U,B,H,q,G;return x=a.TeamsWebActionsLogger,D=d.File,E=d.Paper,q=f.reactFormat,B=y.isSuggestionFolder,U=y.isSuggestionFile,H=y.isSuggestionPaper,O=T._,G=T.ungettext,L=r.createElement,k=r.DOM,I=r.createClass({displayName:"SearchBar",mixins:[u(v)],propTypes:{user:r.PropTypes.object.isRequired,currentPath:r.PropTypes.string.isRequired,onSearch:r.PropTypes.func.isRequired,onCancelSearch:r.PropTypes.func,onFileOrFolderOpen:r.PropTypes.func.isRequired,isMaestroDesign:r.PropTypes.bool,limitedTeamBannerUpsell:r.PropTypes.bool,trademarkBusiness:r.PropTypes.string,currentNSID:r.PropTypes.number},getDefaultProps:function(){return{onCancelSearch:function(){}}},_get_state_from_stores:function(){return{isFocused:v.isSearchBarFocused(),isActive:v.isSearchBarActive(),isSearchActive:!!v.latestQuery(),rawQuery:v.rawQuery(),normalizedQuery:v.normalizedQuery(),suggestions:v.searchSuggestions(),searchBarLoading:v.isSearchBarLoading(),isAdminConsole:v.browseContext().isNonUserRelativeContext}},_setSearchQuery:function(e){return g.setSearchQuery({nsid:this.props.currentNSID,path:this.props.currentPath,query:e,user:this.props.user,groupByType:this.props.isMaestroDesign})},_handleInputChange:function(e){return this._setSearchQuery(e.target.value)},_handleCancelSearch:function(){return this._setSearchQuery("")},_handleInputKeydown:function(e){return e.keyCode===p.ESC?(this._handleCancelSearch(),void this.props.onCancelSearch()):(e.stopPropagation(),e.keyCode===p.UP?(e.preventDefault(),g.highlightPreviousRow()):e.keyCode===p.DOWN?(e.preventDefault(),g.highlightNextRow()):void 0)},_handleInputSubmit:function(e,t){return e.preventDefault(),0===t?this.props.onSearch(this.state.normalizedQuery):this.props.onFileOrFolderOpen(v.searchSuggestions()[t-1])},_handleHighlightDropdownItem:function(e){return g.setHighlightedRow({index:e})},render:function(){var e;return e=n.extend({onInputChange:this._handleInputChange,onInputKeydown:this._handleInputKeydown,onInputSubmit:this._handleInputSubmit,onSearchBarFocus:g.focusSearchBar,onSearchBarBlur:g.blurSearchBar,onHighlightDropdownItem:this._handleHighlightDropdownItem,ref:"searchBarView",highlightedRow:v.highlightedSearchRow()},this.state,this.props),L(A,e)}}),A=r.createClass({displayName:"SearchBarView",propTypes:{isSearchActive:r.PropTypes.bool.isRequired,isActive:r.PropTypes.bool.isRequired,isFocused:r.PropTypes.bool.isRequired,isMaestroDesign:r.PropTypes.bool.isRequired,searchBarLoading:r.PropTypes.bool.isRequired,onFileOrFolderOpen:r.PropTypes.func.isRequired,onInputChange:r.PropTypes.func.isRequired,onInputKeydown:r.PropTypes.func.isRequired,onInputSubmit:r.PropTypes.func.isRequired,onSearch:r.PropTypes.func.isRequired,onSearchBarBlur:r.PropTypes.func.isRequired,onSearchBarFocus:r.PropTypes.func.isRequired,onHighlightDropdownItem:r.PropTypes.func.isRequired,currentPath:r.PropTypes.string.isRequired,highlightedRow:r.PropTypes.number.isRequired,suggestions:r.PropTypes.array.isRequired,rawQuery:r.PropTypes.string,normalizedQuery:r.PropTypes.string,limitedTeamBannerUpsell:r.PropTypes.bool,trademarkBusiness:r.PropTypes.string,isAdminConsole:r.PropTypes.bool},getDefaultProps:function(){return{rawQuery:"",normalizedQuery:"",isAdminConsole:!1}},handleNavigation:function(){var e;return e=o.findDOMNode(this.refs.searchBarInput.refs.searchBarTextInput),e.blur()},_renderUpsellBar:function(){return this.props.limitedTeamBannerUpsell?k.div({className:"search-bar__upsell"},k.div({className:"search-bar__upsell__message"},O("Search through file contents in addition to file names with %(trademark_business)s").format({trademark_business:this.props.trademarkBusiness})),k.div({className:"search-bar__upsell__action"},L(c.button,{className:"search-bar__upsell__cta-button",onMouseDown:function(e){return e.stopPropagation(),e.preventDefault(),w.redirect(i({path:"/team/upgrade",query:{tk:"search_upsell_bar",camp:"web"}}))}},O("Upgrade")))):void 0},render:function(){var e,t,r;return e={"search-bar":!0,"is-expanded":this.props.isSearchActive,"is-focused":this.props.isFocused,"is-active":this.props.isActive},k.div({className:"search-bar--container u-l-fr"},k.div({className:s(e)},r=L(R,{isActive:this.props.isActive,isFocused:this.props.isFocused,isMaestroDesign:this.props.isMaestroDesign,onFileOrFolderOpen:this.props.onFileOrFolderOpen,onInputChange:this.props.onInputChange,onInputKeydown:this.props.onInputKeydown,onInputSubmit:this.props.onInputSubmit,onSearchBarBlur:this.props.onSearchBarBlur,onSearchBarFocus:this.props.onSearchBarFocus,rawQuery:this.props.rawQuery,highlightedRow:this.props.highlightedRow,isAdminConsole:this.props.isAdminConsole,ref:"searchBarInput"}),(null!=(t=this.props.normalizedQuery)?t.length:void 0)?L(P,{onFileOrFolderOpen:function(e){return function(t){return e.props.onFileOrFolderOpen(t),e.handleNavigation()}}(this),onSearch:function(e){return function(t){return e.props.onSearch(t),e.handleNavigation()}}(this),currentPath:this.props.currentPath,highlightedRow:this.props.highlightedRow,isOpen:this.props.isFocused,isMaestroDesign:this.props.isMaestroDesign,normalizedQuery:this.props.normalizedQuery,onHighlightDropdownItem:this.props.onHighlightDropdownItem,ref:"searchBarDropdown",suggestions:this.props.suggestions,bottomBanner:this._renderUpsellBar(),searchBarLoading:this.props.searchBarLoading,isAdminConsole:this.props.isAdminConsole}):void 0))}}),R=r.createClass({displayName:"SearchBarInput",propTypes:{isActive:r.PropTypes.bool.isRequired,isFocused:r.PropTypes.bool.isRequired,isMaestroDesign:r.PropTypes.bool.isRequired,onFileOrFolderOpen:r.PropTypes.func.isRequired,onInputChange:r.PropTypes.func.isRequired,onInputKeydown:r.PropTypes.func.isRequired,onInputSubmit:r.PropTypes.func.isRequired,onSearchBarBlur:r.PropTypes.func.isRequired,onSearchBarFocus:r.PropTypes.func.isRequired,rawQuery:r.PropTypes.string,highlightedRow:r.PropTypes.number.isRequired,isAdminConsole:r.PropTypes.bool},componentDidMount:function(){return e(o.findDOMNode(this.refs.searchBarTextInput)).on("keydown.SearchBarInput",this._onKeydown),e(o.findDOMNode(this.refs.searchBarTextInput)).on("focusout.SearchBarInput",this.props.onSearchBarBlur)},componentWillUnmount:function(){return e(o.findDOMNode(this.refs.searchBarTextInput)).off(".SearchBarInput")},_onKeydown:function(e){return e.keyCode===p.ESC&&o.findDOMNode(this.refs.searchBarTextInput).blur(),this.props.onInputKeydown(e)},_onSubmit:function(e){var t;return t=v.highlightedSearchRow(),this.props.isAdminConsole||o.findDOMNode(this.refs.searchBarTextInput).blur(),this.props.onInputSubmit(e,t)},render:function(){return k.form({className:"search-bar__input",onSubmit:this._onSubmit},k.input({"aria-activedescendant":"search-dropdown-suggestion"+this.props.highlightedRow,"aria-autocomplete":"list","aria-expanded":this.props.isFocused&&this.props.isActive,"aria-label":O("Search"),"aria-owns":"search-bar__suggestions",className:"search-bar__text-input",onChange:this.props.onInputChange,onFocus:this.props.onSearchBarFocus,placeholder:O("Search"),ref:"searchBarTextInput",role:"combobox",value:this.props.rawQuery}),k.input({"aria-label":O("Search"),className:"search-bar__button",ref:"searchBarSearchButton",type:"submit",value:""}))}}),P=r.createClass({displayName:"SearchBarDropdown",propTypes:{isOpen:r.PropTypes.bool.isRequired,isMaestroDesign:r.PropTypes.bool.isRequired,onFileOrFolderOpen:r.PropTypes.func.isRequired,onSearch:r.PropTypes.func.isRequired,onHighlightDropdownItem:r.PropTypes.func.isRequired,currentPath:r.PropTypes.string.isRequired,normalizedQuery:r.PropTypes.string.isRequired,suggestions:r.PropTypes.array.isRequired,searchBarLoading:r.PropTypes.bool.isRequired,bottomBanner:r.PropTypes.element,isAdminConsole:r.PropTypes.bool},getDefaultProps:function(){return{isAdminConsole:!1}},componentDidMount:function(){return this.props.searchBarLoading?this._announceLoading():void 0},componentDidUpdate:function(e){return this.props.searchBarLoading&&!e.searchBarLoading&&this._announceLoading(),this.props.normalizedQuery&&e.searchBarLoading&&!this.props.searchBarLoading?S.polite(G("Found %(num)s search result","Found %(num)s search results",this.props.suggestions.length).format({num:this.props.suggestions.length})):void 0},_announceLoading:function(){return S.polite(O("Loading search…"))},render:function(){return!this.props.searchBarLoading&&this.props.isOpen&&this.props.bottomBanner&&!this._banner_view_logged&&(this._banner_view_logged=!0,x.log("banner_search_displayed",{location:"search_bar",item_count:this.props.suggestions.length})),this.props.isMaestroDesign?this._renderForMaestro():this._renderForDefault()},_renderForMaestro:function(){var e,t,r,o,n,i,a,l,u,p,d;for(l=function(e){return k.h3({className:"search-bar__filetype-title"},O(e))},p=[],r=!1,t=!1,o=!1,u=this.props.suggestions,n=i=0,a=u.length;a>i;n=++i)d=u[n],B(d)&&!r?(p.push(l("Folders")),r=!0):U(d)&&!t?(p.push(l("Files")),t=!0):H(d)&&!o&&(p.push(l("Paper Documents")),o=!0),d instanceof D?p.push(L(N,{resultObject:d,isMaestroDesign:!0,key:d.fq_path,onFileOrFolderOpen:this.props.onFileOrFolderOpen,onHighlightDropdownItem:this.props.onHighlightDropdownItem,rank:n,highlightedRow:this.props.highlightedRow})):d instanceof E&&p.push(L(C,{resultObject:d,isMaestroDesign:!0,key:d.pad_id,onFileOrFolderOpen:this.props.onFileOrFolderOpen,onHighlightDropdownItem:this.props.onHighlightDropdownItem,rank:n,highlightedRow:this.props.highlightedRow}));return e={"search-bar__dropdown":!0,"is-expanded":this.props.isOpen},k.div({className:s(e),"aria-hidden":!this.props.isOpen},k.div({className:"search-bar__suggestions",id:"search-bar__suggestions"},L(F,{isMaestroDesign:!0,onSearch:this.props.onSearch,onHighlightDropdownItem:this.props.onHighlightDropdownItem,currentPath:this.props.currentPath,normalizedQuery:this.props.normalizedQuery,highlightedRow:this.props.highlightedRow}),this.props.suggestions.length?k.hr({className:"search-bar__title-items-divider"}):void 0,p),this.props.searchBarLoading?k.div({className:"search-bar__loading"},k.span({className:"ax-visually-hidden"},O("Loading search..."))):this.props.bottomBanner)},_renderForDefault:function(){var e,t,r,o,n;return e={"search-bar__dropdown":!0,"is-expanded":this.props.isOpen},k.div({className:s(e),"aria-hidden":!this.props.isOpen},k.ul({className:"search-bar__suggestions",id:"search-bar__suggestions",role:"listbox"},this.props.isAdminConsole?void 0:L(F,{isMaestroDesign:!1,onSearch:this.props.onSearch,onHighlightDropdownItem:this.props.onHighlightDropdownItem,currentPath:this.props.currentPath,normalizedQuery:this.props.normalizedQuery,highlightedRow:this.props.highlightedRow}),function(){var e,s,i,a;if(this.props.suggestions.length){for(i=this.props.suggestions,a=[],o=e=0,s=i.length;s>e;o=++e)n=i[o],t=null,r=null,n instanceof D?(t=N,r=n.fq_path):n instanceof E&&(t=C,r=n.pad_id),t?a.push(L(t,{resultObject:n,isMaestroDesign:!1,key:r,onFileOrFolderOpen:this.props.onFileOrFolderOpen,onHighlightDropdownItem:this.props.onHighlightDropdownItem,rank:o,highlightedRow:this.props.highlightedRow})):a.push(void 0);return a}}.call(this)),this.props.searchBarLoading?k.div({className:"search-bar__loading"},k.span({className:"ax-visually-hidden"},O("Loading search..."))):this.props.bottomBanner)}}),F=r.createClass({displayName:"SearchBarDropdownSearchItem",propTypes:{isMaestroDesign:r.PropTypes.bool.isRequired,onSearch:r.PropTypes.func.isRequired,onHighlightDropdownItem:r.PropTypes.func.isRequired,currentPath:r.PropTypes.string.isRequired,normalizedQuery:r.PropTypes.string.isRequired,highlightedRow:r.PropTypes.number.isRequired},render:function(){var e,t,r;return r=0===this.props.highlightedRow,t=this.props.isMaestroDesign?q(O("Display all results for <strong>%(query)s</strong> in a page"),{query:this.props.normalizedQuery,strong:k.strong()}):q(O("Search for ‘<strong>%(query)s</strong>’ in %(current_path)s"),{current_path:l.filename(this.props.currentPath),query:this.props.normalizedQuery,strong:k.strong()}),e={"search-bar__suggestion":!0,"search-bar__suggestion--is-highlighted":r},k.div({className:s(e),id:"search-dropdown-suggestion0",onMouseDown:function(e){return function(){return e.props.onSearch(e.props.normalizedQuery)}}(this),onMouseEnter:function(e){return function(){return e.props.onHighlightDropdownItem(0)}}(this),role:"option","aria-selected":r},k.div({className:"search-bar__suggestion-icon--search"}),k.div({className:s({"search-bar__suggestion-name":!this.props.isMaestroDesign,"search-bar__suggestion-first-row-name":this.props.isMaestroDesign})},t))}}),C=r.createClass({displayName:"SearchBarDropdownPaperSuggestion",propTypes:{resultObject:r.PropTypes.instanceOf(E).isRequired,isMaestroDesign:r.PropTypes.bool.isRequired},render:function(){var t,s;return s=this.props.resultObject,t={icon:"paper_white_32",title:b.highlightMatchString(s.title,s.title_highlights),location:"Paper"},L(M,e.extend(t,this.props))}}),N=r.createClass({displayName:"SearchBarDropdownFileSuggestion",propTypes:{resultObject:r.PropTypes.instanceOf(D).isRequired,isMaestroDesign:r.PropTypes.bool.isRequired},render:function(){var t,s,r,o,n,i,a;return o=this.props.resultObject,n=l.filename(o.fq_path),i=l.parent_dir(o.fq_path),r=i,this.props.isMaestroDesign&&(r="Dropbox",s=i.split("/"),s.shift(),o.is_unmounted&&s.length>0&&(r=s.shift()),a=s[s.length-1],s.length>=2&&(r+="/..."),(null!=a?a.length:void 0)&&(r+="/"+a)),t={icon:o.icon,title:b.highlightMatchString(n,o.filename_highlights),location:r,isUnmounted:o.is_unmounted},L(M,e.extend(t,this.props))}}),M=r.createClass({displayName:"SearchBarDropdownSuggestion",propTypes:{resultObject:r.PropTypes.oneOfType([r.PropTypes.instanceOf(D),r.PropTypes.instanceOf(E)]).isRequired,isMaestroDesign:r.PropTypes.bool.isRequired,icon:r.PropTypes.string,title:r.PropTypes.string,location:r.PropTypes.string,isUnmounted:r.PropTypes.bool,onFileOrFolderOpen:r.PropTypes.func.isRequired,onHighlightDropdownItem:r.PropTypes.func.isRequired,rank:r.PropTypes.number.isRequired,highlightedRow:r.PropTypes.number.isRequired},render:function(){var e,r,o,n,i;return o=this.props.rank+1,r=o===this.props.highlightedRow,e={"search-bar__suggestion":!0,"search-bar__suggestion--is-highlighted":r},n=this.props.isMaestroDesign?this.props.isUnmounted?q(O("not added yet, in <locationSpan>%(location)s</locationSpan>",{comment:"Describes the mountable directory of a file in a list of search results."}),{location:this.props.location,locationSpan:k.span({title:this.props.location})}):q(O("<locationSpan>%(location)s</locationSpan>",{comment:"Describes the parent directory of a file in a list of search results."}),{location:this.props.location,locationSpan:k.span({title:this.props.location})}):q(O("<locationSpan>in %(location)s</locationSpan>",{comment:"Describes the parent directory of a file in a list of search results."}),{location:this.props.location,locationSpan:k.span({title:this.props.location})}),i=[k.div({className:"search-bar__suggestion-name"},k.span({dangerouslySetInnerHTML:{__html:t.sanitize(this.props.title)}}),!this.props.isMaestroDesign&&this.props.isUnmounted?[k.br({}),k.span({className:"u-font-meta"},O("Not added yet"))]:void 0),k.div({className:"search-bar__suggestion-desc"},n)],k.li({className:s(e),id:"search-dropdown-suggestion"+o,role:"option","aria-selected":r,onMouseDown:function(e){return function(){return e.props.onFileOrFolderOpen(e.props.resultObject)}}(this),onMouseEnter:function(e){return function(){return e.props.onHighlightDropdownItem(o)}}(this)},L(_,{group:"web",name:this.props.icon,className:"search-bar__suggestion-icon",alt:""}),this.props.isMaestroDesign?k.div({},i):i)}}),I=h(I,["/static/css/search/search_bar_react-vflnBiB0A.css"])})}.call(this),function(){define("modules/clean/search/search_results",["external/immutable","external/react","external/react-dom","external/underscore","modules/clean/flux/store_mixin","modules/clean/notserver","modules/clean/react/css","modules/clean/react/file_modal_controller","modules/clean/search/actions","modules/clean/search/api","modules/clean/search/search_results_view","modules/clean/search/store"],function(e,t,s,r,o,n,i,a,l,u,p,d){var c,h,m,f,_;return h=n.NotClients,c=a.FileModalController,_=t.DOM,f=t.createElement,m=t.createClass({displayName:"SearchResultsController",mixins:[o(d)],_get_state_from_stores:function(){return{context:d.browseContext(),hasMoreResults:d.hasMoreResults(),loadingState:d.loadingState(),latestQuery:d.latestQuery(),numDeletedResults:d.numDeletedResults(),searchResults:d.searchResults(),selection:d.selection(),selectedFiles:d.selectedFiles(),didLoadDeletedResults:d.didLoadDeletedResults()}},propTypes:{isMaestroDesign:t.PropTypes.bool,limitedTeamBannerUpsell:t.PropTypes.bool,onFullSearch:t.PropTypes.func,onPathOpen:t.PropTypes.func,path:t.PropTypes.string,topMenuItems:t.PropTypes.element.isRequired,trademarkBusiness:t.PropTypes.string,user:t.PropTypes.object},componentWillMount:function(){return this._setupFileEventListener(this.props.user.id)},componentWillUnmount:function(){return h[this.props.user.id].unsubscribe(this.handlerId)},_setupFileEventListener:function(){var e;return this.searchApi=new u,e=h[this.props.user.id],this.handlerId=e.subscribe_sfj({name:"SearchEventDispatcher",handler:function(t){return function(){return t.state.latestQuery?t.searchApi.getUpdatesForResults({query:t.state.latestQuery,namespaceToJournalIdMap:e.get_ns_map(),showDeleted:t.state.didLoadDeletedResults,user:t.props.user,onSuccess:function(s){return l.applyUpdatesFromNotserver({payload:s,path:t.props.path}),e.handler_success(t.handlerId,{ns_map:s.ns_map})}}):void e.handler_success(t.handlerId,{ns_map:e.get_ns_map()})}}(this)})},_handleScroll:function(){var e;return e=s.findDOMNode(this).getBoundingClientRect(),e.bottom<=window.innerHeight?l.loadMoreResults({path:this.props.path,user:this.props.user}):void 0},handleSelectionChange:function(e){return l.setSearchSelection({selection:e})},handleDelete:function(){var e;return e=this.state.selectedFiles.toArray(),c.showDelete(this.props.user,e,this.state.context,r.noop)},handleRestoreMulti:function(){var e;return e=this.state.selectedFiles.toArray(),c.showRestore(this.props.user,e,function(){})},handlePermanentDelete:function(){var e,t;return e=this.state.selectedFiles,t=function(){return l.removeSearchResults({fq_paths:e.map(function(e){return e.fq_path})})},c.showPermanentlyDelete(this.props.user,e.toArray(),t)},render:function(){return f(p,r.extend({},{isMaestroDesign:this.props.isMaestroDesign,limitedTeamBannerUpsell:this.props.limitedTeamBannerUpsell,onFullSearch:this.props.onFullSearch,onScroll:r.throttle(this._handleScroll,200),onSelectionChange:this.handleSelectionChange,path:this.props.path,topMenuItems:this.props.topMenuItems,
trademarkBusiness:this.props.trademarkBusiness,user:this.props.user,actionHandlers:{onDelete:this.handleDelete,onRestoreMulti:this.handleRestoreMulti,onPermanentDelete:this.handlePermanentDelete}},this.state))}}),m=i(m,["/static/css/browse/browse-vflc_FrK9.css","/static/css/scooter/scooter-scoped-vflATcSDK.css"])})}.call(this),function(){define("modules/clean/search/search_results_view",["jquery","external/classnames","external/immutable","external/react","external/underscore","modules/clean/analytics","modules/clean/browse_interface","modules/clean/filepath","modules/clean/history","modules/clean/react/maestro/secondary_sidebar","modules/clean/react/app_actions_view","modules/clean/react/browse/constants","modules/clean/react/browse/context_menu","modules/clean/react/browse/file_actions","modules/clean/react/browse/item_list","modules/clean/react/browse/selection_actions","modules/clean/react/file_viewer/controller","modules/clean/react/image","modules/clean/react/sprite","modules/clean/react/user_notifications/dropdown","modules/clean/search/constants","modules/clean/search/search_helpers","modules/clean/teams/team_promo_banner","modules/clean/static_urls","modules/constants/browse","modules/constants/viewer","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,s,r,o,n,i,a,l,u,p,d,c,h,m,f,_,g,b,v,y,S,w,T,D,E,I,P,N){var C,F,M,R,A,x,O,L,k,U,B,H,q,G,W,V,z,j;return H=n.TeamsWebActionsLogger,x=u.MaestroSecondarySidebar,M=d.DropTargetHighlightMode,A=d.LoadingStates,O=d.NewFolderCreationState,k=d.SEARCH_PREFIX,C=c.BrowseContextMenu,V=h.getActionsForFileCollection,R=m.ItemListController,F=f.BrowseSelectionMenu,U=y.SearchLoadingStates,z=T.static_url,L=E.ROLE_WORK,q=P._,j=P.ungettext,W=r.DOM,G=r.createElement,B=r.createClass({displayName:"SearchResultsView",propTypes:{hasMoreResults:r.PropTypes.bool,isMaestroDesign:r.PropTypes.bool,loadingState:r.PropTypes.oneOf(o.values(U)),latestQuery:r.PropTypes.string,limitedTeamBannerUpsell:r.PropTypes.bool,onFullSearch:r.PropTypes.func,onScroll:r.PropTypes.func,path:r.PropTypes.string,topMenuItems:r.PropTypes.element,searchResults:r.PropTypes.instanceOf(s.List),selection:r.PropTypes.object,selectedFiles:r.PropTypes.instanceOf(s.OrderedSet),trademarkBusiness:r.PropTypes.string,user:r.PropTypes.object,actionHandlers:r.PropTypes.object},componentDidMount:function(){return e(window).on("scroll.SearchResults",this.props.onScroll)},componentWillMount:function(){return l.add_callback(k,this._ensureFileViewerClosedIfNotPreviewing)},componentWillUnmount:function(){return e(window).off("scroll.SearchResults"),l.remove_callback(k,this._ensureFileViewerClosedIfNotPreviewing)},_ensureFileViewerClosedIfNotPreviewing:function(){var e,t,s;return t=null!=(s=l.deconstruct_url())?s.qargs:void 0,e=_.isShown(),!t.preview&&e?_.close():void 0},_getSelectionText:function(){var e;return e=this.props.selectedFiles.count(),e>0?j("%(count)d item selected","%(count)d items selected",e).format({count:e}):""},renderFullSearchLink:function(){var e,t;return t=this.props.user.role===L?i.WORK_ROOT:i.PERSONAL_ROOT,e=N.parse("/search"+t).setQuery({path:"/",query:this.props.latestQuery}).toString(),W.a({href:e,onClick:this.props.onFullSearch},q("Search all of my Dropbox instead"))},renderEmptyFolderView:function(){return W.div({className:"u-font-center u-pad-top-xl"},G(g,{src:z("/static/images/empty_states/search-vfl6DaX2I.png"),srcHiRes:z("/static/images/empty_states/search@2x-vflBsUhDE.png"),alt:""}),W.h2({className:"u-pad-top-l"},q("No results found")),W.div({},"/"===this.props.path?q("Please update your search and try again"):this.renderFullSearchLink()))},renderUpsellPromoBanner:function(){return this.props.loadingState!==A.LOADED||this.props.hasMoreResults||this._banner_view_logged||(this._banner_view_logged=!0,H.log("banner_search_displayed",{location:"search_results",item_count:this.props.searchResults.size})),G(w,{description:[q("Search through file contents in addition to file names with %(trademark_business)s").format({trademark_business:this.props.trademarkBusiness}),W.a({className:"upsell_info u-pad-xxs",href:"/help/6635",target:"_blank",key:"info-link"},G(b,{group:"web",name:"info",alt:"more info"}))],buttons:[{text:q("Upgrade"),handler:function(){return I.redirect(N({path:"/team/upgrade",query:{tk:"search_upsell_results",camp:"web"}}))}}]})},maybeRenderSearchResultsHeader:function(){var e;if(this.props.searchResults.size&&this.props.loadingState!==U.LOADING_FIRST_PAGE)return e="/"===this.props.path&&D.SHOW_PAPER_SEARCH_RESULTS?j("%(num_results)d result in files, folders, Paper docs, and content.","%(num_results)d results in files, folders, Paper docs, and content.",this.props.searchResults.size).format({num_results:this.props.searchResults.size}):j("%(num_results)d result in files, folders, and content.","%(num_results)d results in files, folders, and content.",this.props.searchResults.size).format({num_results:this.props.searchResults.size}),W.div({className:t({"search-results__info":!0,"o-grid--no-gutter":this.props.isMaestroDesign})},this.props.hasMoreResults?e:[W.span({className:t({"o-grid__col":this.props.isMaestroDesign,"o-grid__col--8-of-12":this.props.isMaestroDesign})},e),this.props.isMaestroDesign?W.span({},q("Modified")):"/"!==this.props.path?W.span({className:"u-pad-horizontal-xs"},this.renderFullSearchLink()):void 0])},renderLegacyActionsMenus:function(){return[G(C,{actionHandlers:this.props.actionHandlers,context:this.props.context,isSearchMode:!0,selectedFiles:this.props.selectedFiles,shouldShowGlobalActions:!1,user:this.props.user}),G(F,{actionHandlers:this.props.actionHandlers,context:this.props.context,isSearchMode:!0,selectedFiles:this.props.selectedFiles,user:this.props.user})]},render:function(){var e,s,r,n,i,l;return n=this.props.loadingState===U.LOADING_FIRST_PAGE?A.LOADING_FIRST_PAGE:this.props.loadingState===U.LOADING_ADDITIONAL_PAGE?A.LOADING_REMAINING_PAGES:A.LOADED,W.div({className:t({"search-results":!0,promo:this.props.limitedTeamBannerUpsell}),id:"browse-box"},W.div({className:"browse-header search-results__header"},W.h1({className:"search-results__title"},this.props.loadingState!==U.LOADED?q("Searching…"):this.props.isMaestroDesign?q("Search results"):"/"===this.props.path?q("Results for ‘%(query)s’ in ‘%(path)s’",{comment:"Path is a folder name in the user's Dropbox"}).format({query:this.props.latestQuery,path:a.filename(this.props.path)}):void 0),this.props.topMenuItems,this.props.limitedTeamBannerUpsell?this.renderUpsellPromoBanner():void 0,this.props.isMaestroDesign?void 0:this.maybeRenderSearchResultsHeader()),this.props.isMaestroDesign?this.maybeRenderSearchResultsHeader():void 0,this.props.isMaestroDesign?this.props.selectedFiles.size?(s=V({files:this.props.selectedFiles,context:this.props.context,user:this.props.user,actionHandlers:this.props.actionHandlers,isMaestroDesign:this.props.isMaestroDesign,isSearchMode:!0}),s.length>0?(i={displayName:s[0].label,handleClick:s[0].performAction},l=function(){var t,r,o,n;for(o=s.slice(1),n=[],t=0,r=o.length;r>t;t++)e=o[t],n.push({displayName:e.label,handleClick:e.performAction,iconName:e.spriteName});return n}(),r=this._getSelectionText(),G(x,{},G(p,{headerText:r,primaryMenuItem:i,secondaryMenuItems:l}))):void 0):void 0:this.renderLegacyActionsMenus(),G(R,{context:this.props.context,items:this.props.searchResults,loadingState:n,isMaestroDesign:this.props.isMaestroDesign,isSearchMode:!0,isColumnHeaderVisible:!1,isMultiColumnGroupVisible:!1,isPaginating:!1,isTextSelectable:!1,isDragAndDropEnabled:!1,shouldShowDeletedFiles:!1,showContainingPaths:!0,showFilenameHighlights:!0,user:this.props.user,path:this.props.path,selection:this.props.selection,selectedFiles:this.props.selectedFiles,onSelectionChange:this.props.onSelectionChange,customEmptyFolderView:this.renderEmptyFolderView,actionHandlers:this.props.actionHandlers,onOutsideMouseUp:this.props.isMaestroDesign?o.noop:void 0}))}})})}.call(this),function(){var e=function(e,s){function r(){this.constructor=e}for(var o in s)t.call(s,o)&&(e[o]=s[o]);return r.prototype=s.prototype,e.prototype=new r,e.__super__=s.prototype,e},t={}.hasOwnProperty;define("modules/clean/search/store",["external/immutable","modules/clean/ajax","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/selectable_list","modules/clean/search/constants","modules/clean/search/util","modules/clean/viewer"],function(t,s,r,o,n,i,a,l,u,p){var d,c,h,m,f,_,g,b,v,y,S,w,T,D;return d=n.BrowseActionTypes,h=i.File,c=i.BrowseContext,f=i.Paper,y=a.createSelection,m=l.MaxResults,_=l.SearchActionTypes,g=l.SearchLoadingStates,w=u.isSuggestionFile,T=u.isSuggestionFolder,D=u.isSuggestionPaper,S=u.groupSuggestionsByType,b={FILE:"FILE",PAPER:"PAPER"},new(v=function(s){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,s),o.prototype._init=function(){return this._resetSearchBar(),this._resetSearchResults()},o.prototype._resetSearchBar=function(){return this._isSearchBarFocused=!1,this._isSearchBarLoading=!1,this._rawQuery="",this._normalizedQuery="",this._searchSuggestions=[],this._highlightedSearchRow=0},o.prototype._resetSearchResults=function(){return this._browseContext=new c,this._latestQuery="",this._loadingState=g.LOADED,this._searchResults=t.List(),this._selection=y(),this._hasMoreLiveResults=!0,this._numDeletedResults=0,this._hasMoreDeletedResults=!0,this._didLoadDeletedResults=!1},o.prototype.isSearchBarFocused=function(){return this._isSearchBarFocused},o.prototype.isSearchBarActive=function(){return!!this._rawQuery},o.prototype.isSearchBarLoading=function(){return this._isSearchBarLoading},o.prototype.rawQuery=function(){return this._rawQuery},o.prototype.normalizedQuery=function(){return this._rawQuery.trim().replace(/\ +/g," ")},o.prototype.searchSuggestions=function(){return this._searchSuggestions},o.prototype.highlightedSearchRow=function(){return this._highlightedSearchRow},o.prototype.highlightedSuggestion=function(){var e,t;return t=this._highlightedSearchRow-1,e=this._searchSuggestions[t],this._searchSuggestions[t]},o.prototype.browseContext=function(){return this._browseContext},o.prototype.latestQuery=function(){return this._latestQuery},o.prototype.loadingState=function(){return this._loadingState},o.prototype.searchResults=function(){return this._searchResults},o.prototype.hasMoreResults=function(e){return null==e&&(e=!1),this._hasMoreLiveResults||e&&this._hasMoreDeletedResults},o.prototype.numDeletedResults=function(){return this._numDeletedResults},o.prototype.didLoadDeletedResults=function(){return this._didLoadDeletedResults},o.prototype.selection=function(){return this._selection},o.prototype.selectedFiles=function(){return this._searchResults.filter(function(e){return function(t){return e._selection.selected.has(t.fq_path)}}(this)).toOrderedSet()},o.prototype._focusSearchBar=function(){return this._isSearchBarFocused=!0,this._highlightedSearchRow=0,this.emit_change()},o.prototype._blurSearchBar=function(){return this._isSearchBarFocused=!1,this._highlightedSearchRow=0,this.emit_change()},o.prototype._setSearchQuery=function(e){var t;return t=e.query,this._rawQuery=t,this._searchSuggestions=[],this._highlightedSearchRow=0,this._isSearchBarLoading=!!this.normalizedQuery(),this.emit_change()},o.prototype._parseSearchResultsToList=function(e){var t,s,r,o,n;for(n=e.searchResults,o=[],t=0,s=n.length;s>t;t++)switch(r=n[t],r.search_result_type){case b.FILE:o.push(h.fromServerObject(r));break;case b.PAPER:o.push(f.fromServerObject(r))}return o},o.prototype._setSearchSuggestions=function(e){var t,s;return s=e.searchResults,t=e.groupByType,this._isSearchBarLoading=!1,this._searchSuggestions=this._parseSearchResultsToList({searchResults:s}),t&&(this._searchSuggestions=S(this._searchSuggestions)),this.emit_change()},o.prototype._setHighlightedSearchRow=function(e){var t;return t=e.index,this._highlightedSearchRow=t,this.emit_change()},o.prototype._highlightPreviousSearchRow=function(){return this._highlightedSearchRow=Math.max(0,this._highlightedSearchRow-1),this.emit_change()},o.prototype._highlightNextSearchRow=function(){return this._highlightedSearchRow=Math.min(this._searchSuggestions.length,this._highlightedSearchRow+1),this.emit_change()},o.prototype._startSearch=function(e){var t;return t=e.query,this._resetSearchResults(),this._rawQuery=t,this._latestQuery=this.normalizedQuery(),this._loadingState=g.LOADING_FIRST_PAGE,this.emit_change()},o.prototype._setSearchResults=function(e){var s,r;return r=e.searchResults,s=e.context,this._searchResults=t.List(this._parseSearchResultsToList({searchResults:r})),this._loadingState=g.LOADED,this._browseContext=s,this._updateMoreResults(r),this.emit_change()},o.prototype._continueSearch=function(e){var t;return t=e.didLoadDeletedResults,t&&(this._didLoadDeletedResults=!0),this._loadingState=g.LOADING_ADDITIONAL_PAGE,this.emit_change()},o.prototype._appendSearchResults=function(e){var t,s,r;return s=e.deleted,r=e.searchResults,t=e.context,s&&(this._numDeletedResults+=r.length),this._searchResults=this._searchResults.concat(this._parseSearchResultsToList({searchResults:r})),this._loadingState=g.LOADED,this._browseContext=t,this._updateMoreResults(r),this.emit_change()},o.prototype._clearSearch=function(){return this._resetSearchBar(),this._resetSearchResults(),this.emit_change()},o.prototype._updateMoreResults=function(e){var t;return t=e.length===m.MAX_SEARCH_RESULTS,this._hasMoreLiveResults?this._hasMoreLiveResults=t:this._hasMoreDeletedResults?this._hasMoreDeletedResults=t:void 0},o.prototype._setSearchSelection=function(e){var t;return t=e.selection,this._selection=t,this.emit_change()},o.prototype._applyFileDeltas=function(e){var t,s,o,n,i,a,l;if(n=e.fileDeltas){for(i=0,a=n.length;a>i;i++)l=n[i],s=l.before,t=l.after,!s&&t?this._searchResults=this._searchResults.push(t):s&&!t?(o=this._searchResults.findIndex(function(e){return r.paths_are_equal(e.fq_path,s)}),this._searchResults=this._searchResults.delete(o)):s&&t&&(o=this._searchResults.findIndex(function(e){return r.paths_are_equal(e.fq_path,s)}),o>-1?this._searchResults=this._searchResults.set(o,t):this._searchResults=this._searchResults.push(t));return this.emit_change()}},o.prototype._updateContext=function(e){return this._browseContext=e.context},o.prototype._new_payload=function(e){switch(e.action.type){case _.FOCUS_SEARCH_BAR:return this._focusSearchBar();case _.BLUR_SEARCH_BAR:return this._blurSearchBar();case _.SET_SEARCH_QUERY:return this._setSearchQuery(e.action.data);case _.SET_SEARCH_SUGGESTIONS:return this._setSearchSuggestions(e.action.data);case _.SET_HIGHLIGHTED_ROW:return this._setHighlightedSearchRow(e.action.data);case _.HIGHLIGHT_PREVIOUS_ROW:return this._highlightPreviousSearchRow();case _.HIGHLIGHT_NEXT_ROW:return this._highlightNextSearchRow();case _.START_SEARCH:return this._startSearch(e.action.data);case _.SET_SEARCH_RESULTS:return this._setSearchResults(e.action.data);case _.CONTINUE_SEARCH:return this._continueSearch(e.action.data);case _.APPEND_SEARCH_RESULTS:return this._appendSearchResults(e.action.data);case _.SET_SEARCH_SELECTION:return this._setSearchSelection(e.action.data);case _.CHANGE_FILES:return this._applyFileDeltas(e.action.data);case _.CLEAR_SEARCH:return this._clearSearch();case d.SET_URL:return this._clearSearch();case d.LOAD_PATH:return this._updateContext(e.action.data)}},o}(o))})}.call(this),function(){define("modules/clean/search/util",["modules/clean/react/browse/models"],function(e){var t,s,r,o,n,i,a;return s=e.File,t=e.BrowseContext,r=e.Paper,i=function(e){return e instanceof s&&e.is_dir},n=function(e){return e instanceof s&&!e.is_dir},a=function(e){return e instanceof r},o=function(e){var t,s,r,o;return s=function(){var t,s,r;for(r=[],t=0,s=e.length;s>t;t++)o=e[t],i(o)&&r.push(o);return r}(),t=function(){var t,s,r;for(r=[],t=0,s=e.length;s>t;t++)o=e[t],n(o)&&r.push(o);return r}(),r=function(){var t,s,r;for(r=[],t=0,s=e.length;s>t;t++)o=e[t],a(o)&&r.push(o);return r}(),s.concat(t).concat(r)},{isSuggestionFolder:i,isSuggestionFile:n,isSuggestionPaper:a,groupSuggestionsByType:o}})}.call(this),function(){var e=function(e,s){function r(){this.constructor=e}for(var o in s)t.call(s,o)&&(e[o]=s[o]);return r.prototype=s.prototype,e.prototype=new r,e.__super__=s.prototype,e},t={}.hasOwnProperty;define("modules/clean/sharing/wizard/share_a_folder_wizard_modal",["external/react","modules/clean/react/css","modules/clean/react/flag","modules/clean/react/image","modules/clean/react/input","modules/clean/react_format","modules/clean/react/modal","modules/clean/react/radio","modules/core/i18n","modules/clean/user","modules/clean/static_urls","modules/clean/viewer","modules/constants/viewer"],function(t,s,r,o,n,i,a,l,u,p,d,c,h){var m,f,_,g,b,v,y,S,w,T,D,E,I,P,N;return N=n.text,I=i.reactFormat,_=a.Modal,v=l.RadioGroup,y=l.RadioItem,S=l.RadioItemVariant,P=d.static_url,g=h.ROLE_PERSONAL,b=h.ROLE_WORK,D=t.createElement,E=t.DOM,T=u.i18n_default_project("sharing")._,w=t.createClass({displayName:"ShareAFolderWizardModal",propTypes:{onSubmit:t.PropTypes.func,user:t.PropTypes.instanceOf(p).isRequired},getInitialState:function(){return{option:"new-folder"}},render:function(){return D(_,{autoClose:!1,className:"shared-folder-wizard",buttonComponent:E.span(),title:function(){switch(this.props.user.role){case b:return T("Share a folder from your %(team_name)s Dropbox").format({team_name:c.get_viewer().team_name});case g:return T("Share a folder from your personal Dropbox")}}.call(this)},this._renderContent())},_renderContent:function(){return E.form({className:"shared-folder-wizard__contents",onSubmit:function(e){return function(t){var s;return"function"==typeof(s=t.nativeEvent).preventDefault&&s.preventDefault(),e.props.onSubmit(e.state.option)}}(this)},this._renderHeader(),this._renderRadio(),this._renderButtons())},_renderHeader:function(){return E.div({className:"shared-folder-wizard__header u-mar-bottom-s"},T("What would you like to do?"))},_renderRadio:function(){var e;return e={value:this.state.option,requestChange:this._handleChange},E.div({className:"radio-input"},D(v,{variant:S.Normal,legend:T("Share a Folder options"),displayLegend:!1,valueLink:e},this._renderRadioItems()))},_renderRadioItems:function(){var e,t;return t=D(y,{className:"u-pad-m",value:"new-folder",key:"new-folder-option"},E.div({className:"new-folder_title u-l-ib u-pad-left-xs"},T("I’d like to create and share a new folder"))),e=D(y,{className:"u-pad-m",value:"existing-folder",key:"existing-folder-option"},E.div({className:"existing-folder_title u-l-ib u-pad-left-xs"},T("I’d like to share an existing folder"))),[t,e]},_handleChange:function(e){return this.setState({option:e})},_renderButtons:function(){return E.div({className:"u-mar-top-m clearfix"},E.div({className:"u-l-fr"},E.button({className:"c-btn c-btn--primary",onClick:function(e){return function(t){var s;return"function"==typeof(s=t.nativeEvent).preventDefault&&s.preventDefault(),e.props.onSubmit(e.state.option)}}(this)},T("Next"))))}}),m=function(t){function s(e,t,r){s.__super__.constructor.call(this,e,t,r),this.state.showInterstitial=!0}return e(s,t),s.prototype.render=function(){return this.state.showInterstitial?D(_,{autoClose:!1,className:"shared-folder-wizard-interstitial",buttonComponent:E.span(),title:T("Your Dropbox is full")},this._renderInterstitial()):s.__super__.render.call(this)},s.prototype._renderInterstitial=function(){return E.div({className:"shared-folder-wizard-interstitial"},E.div({className:"shared-folder-wizard-interstitial__content"},E.div({className:"shared-folder-wizard-interstitial__header"},I(T("You currently have <warning>0 MB</warning> of personal Dropbox space left."),{warning:E.span({className:"shared-folder-wizard-interstitial__header--warning"})})),E.div({className:"shared-folder-wizard-interstitial__body"},T("If you create and share a new folder, you can add contents, but it will not sync to your Dropbox."))),E.div({className:"shared-folder-wizard-interstitial__image"},D(o,{src:P("/static/images/pro/overquota/spot-overquota-folder-vflUsxn3C.svg")})),D(r,{spacing:"s",rightAttachment:E.div({className:"shared-folder-wizard-interstitial__buttons u-mar-top-l"},E.button({className:"c-btn c-btn--secondary",onClick:function(e){return function(t){return t.nativeEvent.preventDefault(),e.setState({showInterstitial:!1})}}(this)},T("Share anyway")),E.a({className:"c-btn c-btn--primary u-mar-left-s",href:"/upgrade?oqa=sfcu"},T("Add more space")))}))},s}(w),f=function(t){function s(e,t,r){s.__super__.constructor.call(this,e,t,r)}return e(s,t),s.prototype.render=function(){return D(_,{autoClose:!1,className:"shared-folder-wizard",buttonComponent:E.span(),title:T("Share a folder from your personal Dropbox")},this._renderContentV2())},s.prototype._renderContentV2=function(){return E.form({className:"shared-folder-wizard__contents",onSubmit:function(e){return function(t){return t.nativeEvent.preventDefault(),e.props.onSubmit(e.state.option)}}(this)},this._renderHeader(),this._renderRadio(),this._renderUpsell())},s.prototype._renderUpsell=function(){return E.div({className:"shared-folder-wizard-upsell u-mar-top-l"},E.div({className:"shared-folder-wizard-upsell__content"},E.div({className:"shared-folder-wizard-upsell__header"},I(T("You currently have <warning>0 MB</warning> of personal Dropbox space left."),{warning:E.span({className:"shared-folder-wizard-upsell__header--warning"})})),E.div({className:"shared-folder-wizard-upsell__body"},"If you create and share a new folder, you can add contents, but it will not sync to your Dropbox.")),E.div({className:"shared-folder-wizard-upsell__image"},D(o,{src:P("/static/images/pro/overquota/spot-overquota-folder-vflUsxn3C.svg")})),D(r,{spacing:"s",rightAttachment:E.div({className:"shared-folder-wizard-upsell__buttons u-mar-top-l"},E.button({className:"c-btn c-btn--secondary"},T("Share anyway")),E.a({className:"c-btn c-btn--primary u-mar-left-s",href:"/upgrade?oqa=sfcu"},T("Add more space")))}))},s}(w),w=s(w,["/static/css/sharing/wizard_modals-vfl2L3rOp.css"]),m=s(m,["/static/css/sharing/wizard_modals-vfl2L3rOp.css","/static/css/sharing/exp_wizard_modals-vflKzVaas.css"]),f=s(f,["/static/css/sharing/wizard_modals-vfl2L3rOp.css","/static/css/sharing/exp_wizard_modals-vflKzVaas.css"]),{ShareAFolderWizardModal:w,ExpShareAFolderWizardModalV1:m,ExpShareAFolderWizardModalV2:f}})}.call(this),function(){define("modules/clean/sharing/wizard/share_existing_folder_wizard_modal",["external/react","modules/clean/react/css","modules/clean/react/input","modules/clean/react/modal","modules/clean/react/tree_view","modules/core/i18n","modules/clean/user","modules/clean/viewer","modules/constants/viewer"],function(e,t,s,r,o,n,i,a,l){var u,p,d,c,h,m,f,_,g;return g=s.text,p=r.Modal,u=o.FolderTreeView,d=l.ROLE_PERSONAL,c=l.ROLE_WORK,f=e.createElement,_=e.DOM,m=n.i18n_default_project("sharing")._,h=e.createClass({displayName:"ShareExistingFolderWizardModal",propTypes:{onBack:e.PropTypes.func,onSubmit:e.PropTypes.func,user:e.PropTypes.instanceOf(i).isRequired},getInitialState:function(){return{folderPath:null,errorMsg:null}},render:function(){return f(p,{autoClose:!1,className:"existing-shared-folder-wizard",buttonComponent:_.span(),onDismissCompleted:function(){return p.close()},title:function(){switch(this.props.user.role){case c:return m("Choose a folder from your %(team_name)s Dropbox").format({team_name:a.get_viewer().team_name});case d:return m("Choose a folder from your personal Dropbox")}}.call(this)},this._renderContent())},_renderContent:function(){return _.form({className:"existing-shared-folder-wizard__contents",onSubmit:function(e){return function(){return e.props.onSubmit(e.state.folderPath,e._setError)}}(this)},this._renderError(),this._renderTreeView(),this._renderButtons())},_renderError:function(){var e;return null!=this.state.folderPath&&(null!=(e=this.state.errorMsg)?e.length:void 0)>0?_.div({className:"text-input-error-wrapper"},_.div({className:"text-input-error-text u-font-danger"},this.state.errorMsg)):void 0},_renderTreeView:function(){return _.div({className:"wizard-tree-view"},f(u,{user:this.props.user,onFolderSelected:this._setFolderPath,ref:"treeView"}))},_renderButtons:function(){return _.div({className:"u-mar-top-m clearfix"},_.div({className:"u-l-fr"},_.button({className:"c-btn c-btn--primary",disabled:!this._isValid(),onClick:function(e){return function(t){var s;return"function"==typeof(s=t.nativeEvent).preventDefault&&s.preventDefault(),e.props.onSubmit(e.state.folderPath,e._setError)}}(this)},m("Next"))),_.div({className:"u-l-fl"},_.button({className:"button-as-link",style:{lineHeight:"32px"},onClick:function(e){return function(t){var s,r;return"function"==typeof(s=t.nativeEvent).preventDefault&&s.preventDefault(),p.close(),"function"==typeof(r=e.props).onBack?r.onBack():void 0}}(this)},m("Back"))))},_setFolderPath:function(e){return this.setState({folderPath:e,errorMsg:null})},_setError:function(e){var t;return this.setState({errorMsg:null!=e&&null!=(t=e.path)?t.message_text:void 0})},_isValid:function(){return null!=this.state.folderPath&&null==this.state.errorMsg}}),h=t(h,["/static/css/sharing/wizard_modals-vfl2L3rOp.css"]),{ShareExistingFolderWizardModal:h}})}.call(this),function(){var e=[].slice;define("modules/clean/sharing/wizard/wizard_modals",["external/react","modules/core/notify","modules/clean/account/email","modules/clean/account/email_verify_reasons","modules/clean/analytics","modules/clean/legacy_pyxl_controllers/ajax_form","modules/clean/react/modal","modules/clean/sharing/api","modules/constants/browse","modules/clean/sharing/share_modal_util","modules/clean/sharing/wizard/share_existing_folder_wizard_modal","modules/clean/sharing/wizard/share_a_folder_wizard_modal"],function(t,s,r,o,n,i,a,l,u,p,d,c){var h,m,f,_,g,b,v,y,S,w,T,D,E,I;return h=r.EmailVerification,y=n.SharingExperimentsLogger,_=a.Modal,v=l.SharingApi,S=p.generateModalSessionId,T=p.showNewFolderShareModal,I=p.showShareModal,b=d.ShareExistingFolderWizardModal,g=c.ShareAFolderWizardModal,m=c.ExpShareAFolderWizardModalV1,f=c.ExpShareAFolderWizardModalV2,w=function(e,t,r,o){var n,a,l;return l=function(){if(!I(e,{fqPath:t,isFolder:!0,exists:!0,origin:"WIZARD",shouldFetchNsId:!0,modalSessionId:null!=o?o:void 0}))throw new Error("Tiburon UI must be allowed")},n=function(e){var t;return t=i.extract_errors(e.responseText),t!==!1?"string"==typeof t?s.error(t):"function"==typeof r?r(t):void 0:void 0},a=new v(e),a.validate_shareable_existing_sf_path(t,l,n)},E=function(s,r,o){return null!=o&&y.log(s.id,"SIMPLIFIED_WIZARD_UI::BEGIN_SHARE_EXISTING_FOLDER_WIZARD",{modalSessionId:o}),_.showInstance(t.createElement(b,{user:s,onBack:r,onSubmit:function(t,r){var n;return n=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],null!=o&&y.log(s.id,"SIMPLIFIED_WIZARD_UI::SUBMIT_SHARE_EXISTING_FOLDER_WIZARD_ERROR",{modalSessionId:o}),r.apply(null,t)},null!=o&&y.log(s.id,"SIMPLIFIED_WIZARD_UI::SUBMIT_SHARE_EXISTING_FOLDER_WIZARD",{modalSessionId:o}),w(s,t,n)}}))},D=function(e){var s,r,n;if(h.get_for_user(e).verified_or_show(o.SHARE_FOLDER))return n=S(),y.log(e.id,"SIMPLIFIED_WIZARD_UI::BEGIN_SHARE_A_FOLDER_WIZARD",{modalSessionId:n}),s=u.EXP_SUBGROWTH_PRO_OQ_CREATE_SF,r="V1"===s?m:"V2"===s?f:g,_.showInstance(t.createElement(r,{user:e,onSubmit:function(t){return null!=n&&y.log(e.id,"SIMPLIFIED_WIZARD_UI::SUBMIT_SHARE_A_FOLDER_WIZARD",{target:t,modalSessionId:n}),"new-folder"===t?T(e,n):"existing-folder"===t?E(e,D.bind(this,e,n),n):void 0}}))},{shareExistingFolder:w,showShareAFolderWizardModal:D}})}.call(this),function(){define("modules/clean/teams/cdm_mve_quota_usage",["external/react","modules/clean/react/browse/models","modules/clean/teams/cdm_mve_util","modules/core/i18n"],function(e,t,s,r){var o,n,i,a,l,u;return n=t.QuotaStats,a=s.calculateQuotaClass,i=r._,u=r.format_percent,l=e.DOM,o=e.createClass({displayName:"CdmMveQuotaUsage",propTypes:{quotaStats:e.PropTypes.instanceOf(n).isRequired},mixins:[e.addons.PureRenderMixin],render:function(){var e,t,s,r,o,n,p;return p=this.props.quotaStats,r=p.quotaRawBytes,o=p.quotaRawBytesUsed,e=p.formattedQuota,n=o/r,s="cdm_mve_quota_percent_used "+a(n),t=u(Math.floor(100*n)),l.span({},l.span({className:"u-mar-horizontal-xs"},"•"),l.span({className:s},i("%(used_percent)s of %(available_quota)s used").format({used_percent:t,available_quota:e})))}})})}.call(this),function(){define("modules/clean/teams/cdm_mve_util",[],function(){return{calculateQuotaClass:function(e){return e>=1?"quota-status-overquota":e>=.9?"quota-status-nearquota":""}}})}.call(this),function(){define("modules/clean/teams/limited_team_invite_modal",["external/underscore","external/react","modules/core/html","modules/core/uri","modules/core/i18n","modules/core/notify","modules/clean/ajax","modules/clean/contacts/data","modules/clean/react/modal","modules/clean/teams/limited_team_invite_form","modules/clean/viewer","modules/clean/analytics"],function(e,t,s,r,o,n,i,a,l,u,p,d){var c,h,m,f,_,g,b,v,y;return _=o._,v=o.ungettext,c=a.Contact,m=l.Modal,f=d.TeamsWebActionsLogger,g=t.DOM,b=t.PropTypes,y=p.get_viewer(),h=t.createClass({displayName:"LimitedTeamInviteModal",propTypes:{onInvited:b.func,onDismiss:b.func,populatedCustomMessage:b.string,populatedContacts:b.arrayOf(b.instanceOf(c)),memberInviteLimit:b.number,maxTeamSize:b.number},getInitialState:function(){return{canProceed:!1,submitting:!1}},_canProceed:function(){var e,t;return(null!=(e=this.refs.members)?e.areAllContactsValid():void 0)&&!(null!=(t=this.refs.members)?t.isEmpty():void 0)},onClickInvite:function(t){return t.preventDefault(),this.refs.members.getFinalData(function(t){return function(o){var a,l,u;return u=o.emails,l=o.custom_message,a=t._canProceed(),t.setState({canProceed:a}),a?(t.setState({submitting:!0}),i.WebRequest({url:"/account/team/add_users",subject_user:y.work_user,data:{emails:u,custom_message:l,team_id:y.team_id},complete:function(){return t.isMounted()?t.setState({submitting:!1}):void 0},success:function(o){var i,a,l,u,p,d;return o=JSON.parse(o),a=e.values(o.users),a.length>0?(null!=t.props.memberInviteLimit?(l=t.props.memberInviteLimit-a.length,l>0&&(p={tk:t.props.memberInviteLimit,_camp:"flash"},d=r({path:"/team/upgrade",query:p}),u=v('Members invited. You can invite %(num_rem)s more member before you need to upgrade to Dropbox Business. <a href="%(upsell_url)s">Upgrade now.</a>','Members invited. You can invite %(num_rem)s more members before you need to upgrade to Dropbox Business. <a href="%(upsell_url)s">Upgrade now.</a>',l).format({num_rem:l,upsell_url:d.toString()}),n.success(new s(u)))):n.success(v("Member invited.","Members invited.",a.length)),"function"==typeof(i=t.props).onInvited&&i.onInvited(),t.refs.modal.close()):n.error()},error:function(e){return"rate-limit"===e.getResponseHeader("x-dropbox-app-error")?n.error(new s(_('%(team_name)s has reached the maximum number of team members allowed on Dropbox Basic. Please <a href="/business/contact">contact sales</a> to add more members to your team.').format({team_name:y.team_name}))):n.error()}})):void 0}}(this))},onDismissModal:function(){var e;return f.log("canceled_invite_team_members"),"function"==typeof(e=this.props).onDismiss?e.onDismiss():void 0},onMembersFormChange:function(){return this.setState({canProceed:this._canProceed()})},_getAcceptButtonText:function(){var e;return v("Send invite","Send invites",(null!=(e=this.refs.members)?e.getContacts().length:void 0)||0)},render:function(){return t.createElement(m,{title:_("Invite team members"),acceptButtonText:this._getAcceptButtonText(),dismissButtonText:_("Cancel"),onAccept:this.onClickInvite,onDismiss:this.onDismissModal,acceptButtonDisabled:!this.state.canProceed,submitting:this.state.submitting,className:"limited-team-invite-modal",ref:"modal"},t.createElement(u,{ref:"members",user:y.work_user,onChange:this.onMembersFormChange,errorMessageSpaceFixed:!0,populatedCustomMessage:this.props.populatedCustomMessage,populatedContacts:this.props.populatedContacts,autofocusTokenizer:!0,
memberInviteLimit:this.props.memberInviteLimit,maxTeamSize:this.props.maxTeamSize}))}})})}.call(this),function(){define("modules/clean/teams/prop_types",["external/react"],function(e){var t;return t=e.PropTypes,{joinableTeam:t.shape({team_id:t.number,team_name:t.string,num_members:t.number,is_invite:t.bool,is_limited:t.bool,join_request_state:t.number,signup_key:t.string,inviting_user_name:t.string,approver_display_name:t.string,members_to_display:t.arrayOf(t.shape({display_name:t.string.isRequired,avatar_url:t.string}))}),suggestedMember:t.shape({id:t.number,email:t.string,display_name:t.string,avatar_url:t.string}),valueLink:function(e){return null==e&&(e=t.any),t.shape({value:e,requestChange:t.func.isRequired})}}})}.call(this),function(){define("modules/clean/teams/suggest_invites_modal",["external/underscore","external/react","modules/core/i18n","modules/core/notify","modules/clean/ajax","modules/clean/react/modal","modules/clean/teams/limited_team_invite_form","modules/clean/viewer"],function(e,t,s,r,o,n,i,a){var l,u,p,d,c,h;return p=s._,l=n.Modal,d=t.createElement,c=t.DOM,h=a.get_viewer(),u=t.createClass({displayName:"SuggestInvitesModal",getInitialState:function(){return{canProceed:!1,submitting:!1}},_canProceed:function(){var e,t;return(null!=(e=this.refs.members)?e.areAllContactsValid():void 0)&&!(null!=(t=this.refs.members)?t.isEmpty():void 0)},onClickInvite:function(e){return e.preventDefault(),this.refs.members.getFinalData(function(e){return function(t){var s,n;return n=t.emails,s=e._canProceed(),e.setState({canProceed:s}),s?(e.setState({submitting:!0}),o.WebRequest({url:"/team/manage/suggest-members",data:{emails:n},complete:function(){return e.setState({submitting:!1})},success:function(){return r.success(p("Thanks for your suggestions! We’ve sent them to the team admin.")),e.refs.modal.close()}})):void 0}}(this))},onMembersFormChange:function(){return this.setState({canProceed:this._canProceed()})},render:function(){return d(l,{className:"no-scroll-modal",title:p("Suggest %(team_name)s team members").format({team_name:h.team_name}),acceptButtonText:p("Send suggestions"),dismissButtonText:p("Cancel"),onAccept:this.onClickInvite,acceptButtonDisabled:!this.state.canProceed,submitting:this.state.submitting,ref:"modal"},c.div({className:"suggest_invite_modal_notice"},p("We’ll email your suggestions to your team admin, so they can send out invitations.")),d(i,{ref:"members",user:h.work_user,onChange:this.onMembersFormChange,errorMessageSpaceFixed:!1,includeCustomMessage:!1,emailPlaceholder:p("Email addresses"),autofocusTokenizer:!0}))}})})}.call(this),function(){define("modules/clean/teams/team_promo_banner",["external/classnames","external/react","modules/clean/react/button"],function(e,t,s){var r,o,n,i;return n=t.DOM,o=t.createElement,i=t.PropTypes,r=t.createClass({displayName:"TeamPromoBanner",propTypes:{className:i.string,title:i.string,description:i.node,buttons:i.arrayOf(i.shape({text:i.string,handler:i.func}))},render:function(){var t,r;return n.div({className:e("team-promo-banner",this.props.className)},n.div({className:"team-promo-banner-contents"},n.div({className:"team-promo-banner-body"},n.div({className:"team-promo-banner-title"},this.props.title),n.div({className:"team-promo-banner-description"},this.props.description)),n.div({className:"team-promo-banner-buttons"},function(){var e,i,a,l;for(a=this.props.buttons,l=[],r=e=0,i=a.length;i>e;r=++e)t=a[r],l.push(n.span({className:"team-promo-banner-button",key:"button-"+r},o(s.button,{importance:"tertiary",onClick:t.handler},t.text)));return l}.call(this))))}})})}.call(this),function(){define("modules/clean/unity_browse_interface",["jquery","modules/clean/unity/check_file_cache","modules/clean/unity/features"],function(e,t,s){var r;if(null!=t&&null!=s)return r=function(){function e(){}return e.BATCH_SIZE_LIMIT=100,e.CHECK_FILES_PADDING=50,e.check_file_callback=function(e){return t.set_batch(e)},e.browse_visible_change_callback=function(t,r,o,n){var i,a,l,u,p,d;if(t.length&&(u=Math.max(0,o-e.CHECK_FILES_PADDING),d=Math.min(t.length-1,n+e.CHECK_FILES_PADDING),a=t.slice(u,+d+1||9e9),l=e._get_files_to_check(a),l.length)){for(e._remove_unneeded_items_from_cache(a),p=[];l.length;)i=l.splice(0,e.BATCH_SIZE_LIMIT),p.push(s.check_file_batch(i,r,e.check_file_callback));return p}},e._get_files_to_check=function(e){var s;return function(){var r,o,n;for(n=[],r=0,o=e.length;o>r;r++)s=e[r],s.bytes>=0&&t.is_cached_and_locally_available(s.ns_id,s.ns_path)!==!0&&n.push(s);return n}()},e._remove_unneeded_items_from_cache=function(e){var r,o,n,i,a;for(o={},i=0,a=e.length;a>i;i++)n=e[i],t.is_cached_and_locally_available(n.ns_id,n.ns_path)===!0&&(r=t.get(n.ns_id,n.ns_path),o[s.server_path(n.ns_id,n.ns_path)]=r);return t.clear(),t.set_batch(o)},e}()})}.call(this),function(){define("modules/clean/upsell/prompt_loader",["jquery","modules/clean/uirequest"],function(e,t){var s,r,o,n;return s={init:function(s,r,o,n,i){var a;if(s)return a=e(i?"#prompt-silo .ha-silo":"#ha-container"),new t(a,"/prompt/ha",{data:{ref_controller:r,ref_action:o,campaign_id:n,is_maestro:i},subject_user:s})}},r={init:function(s,r,o,n,i,a,l){var u;return null==l&&(l={}),u=e(a?"#prompt-silo .main-silo":"#outer-frame"),new t(u,"/prompt/main_campaign",{data:{ref_controller:r,ref_action:o,in_app:n,sprite_group:i,skip_main_campaign:l.skip_main_campaign,is_maestro:a},dataType:"json",subject_user:s,success:function(t){return e(".db-modal-overlay").is(":visible")||e("#db-modal-upsell-home-modal").addClass("show-upsell-modal").trigger("show-upsell-modal"),"function"==typeof l.success?l.success(t):void 0}})}},n={init:function(s,r){return new t(e("#page-header"),"/prompt/top_notification_bar",{data:{ref_controller:s,ref_action:r},success:function(t){return e("body").addClass(e("[data-body-class]").data("body-class"))}})}},o={_didCampaignLoad:function(e,t,s){var r,o,n,i,a,l,u;for(null==s&&(s=null),a=e.actions||[],l=0,u=a.length;u>l;l++)if(r=a[l],i=r[0],o=r[1],n=r[2],n===t&&o)return s?o.indexOf(s)>=0:!0;return!1},_didHeaderBubbleLoad:function(e){return this._didCampaignLoad(e,"^body #notification-feed-nav-link","header-bubble-container")||this._didCampaignLoad(e,"^body #prompt-silo .account-header-silo","header-bubble-container")},_didHeaderLinkLoad:function(e){return!this._didHeaderBubbleLoad(e)&&this._didCampaignLoad(e,"^body #notification-feed-nav-link","header-link")||this._didCampaignLoad(e,"^body #prompt-silo .account-header-silo","header-link")},didMainCampaignLoad:function(e){return this._didHeaderBubbleLoad(e)||this._didCampaignLoad(e,"^body #outer-frame")||this._didCampaignLoad(e,"^body #prompt-silo .main-silo")},didAccountHeaderCampaignLoad:function(e){return this._didHeaderBubbleLoad(e)||this._didHeaderLinkLoad(e)},didTopNotificationLoad:function(){return!!e("#top-notification-bar-container").length},init:function(e,t,o,n,i,a){var l;return l=this.didTopNotificationLoad()?{skip_main_campaign:!0,success:function(r){return function(n){return r.didAccountHeaderCampaignLoad(n)?void 0:s.init(e,t,o,null,a)}}(this)}:{success:function(r){return function(n){return r.didMainCampaignLoad(n)?void 0:s.init(e,t,o,null,a)}}(this)},r.init(e,t,o,n,i,a,l)}},{HALoader:s,MainAndAccountHeaderLoader:r,MutuallyExclusiveLoader:o,TopNotificationBarLoader:n,initialize_module:function(e){var t;return e.mutually_exclusive_loading?t=o:(t=r,s.init(e.user_id,e.controller,e.action,null,e.is_maestro)),t.init(e.user_id,e.controller,e.action,e.in_app,e.sprite_group,e.is_maestro)}}})}.call(this);var __extends=this&&this.__extends||function(e,t){function s(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)};define("modules/clean/user_education/user_education_client",["require","exports","external/react","external/react-dom","external/eventemitter3","modules/clean/user_education/user_education_interface"],function(e,t,s,r,o,n){"use strict";t.eventEmitter=window.ensemble?window.ensemble.eventEmitter:new o;var i=function(){function e(){this.controllerReady=!1,this.eventQueue=[],this.handleUpdate=this.handleUpdate.bind(this),t.eventEmitter.on(n.UserEducationStateChannel,this.handleUpdate,this),this._sendEvent({containerName:"UEClient",name:n.UEEventType.Subscribe,data:{}})}return e.prototype.sendEvent=function(e,t,s){var r=this;if(void 0===s&&(s={}),!this._isUserEducationDisabled()){var o={containerName:e,name:t,data:s};this.controllerReady?this._shouldSendEventAsynchronously()?setTimeout(function(){return r._sendEvent(o)},0):this._sendEvent(o):this.eventQueue.push(o)}},e.prototype._sendEvent=function(e){this._isUserEducationDisabled()||t.eventEmitter.emit(n.UserEducationEventChannel,e)},e.prototype._isUserEducationDisabled=function(){return!window.ensemble},e.prototype._shouldSendEventAsynchronously=function(){return!0},e.prototype.handleUpdate=function(e){if(e.state===n.UEEventType.Ready)for(this.controllerReady=!0;this.eventQueue.length>0;)this._sendEvent(this.eventQueue.shift())},e}();t.UEClient=new i;var a=function(){function e(e,t){this._thunk=e,this._fps=t,this._cleanup_func=function(){},this._is_running=!1}return e.prototype.start=function(){if(!this._is_running){this._is_running=!0;var e=this._thunk,t=-1,s=-1,r=1e3/this._fps,o=function(e,t){var n=Date.now(),i=n-t;i>r&&e(),t=n-i%r,s=requestAnimationFrame(function(){return o(e,t)})};t=requestAnimationFrame(function(){o(e,0)}),this._cleanup_func=function(){cancelAnimationFrame(t),cancelAnimationFrame(s)}}},e.prototype.stop=function(){this._is_running&&(this._is_running=!1,this._cleanup_func())},e.prototype.isRunning=function(){return this._is_running},e}(),l=15,u=function(e){function o(t){e.call(this,t),this.state={effect:null,rect:{bottom:0,height:0,left:0,right:0,top:0,width:0}},this.handleUpdate=this.handleUpdate.bind(this),this._updateSize=this._updateSize.bind(this)}return __extends(o,e),o.prototype.componentDidMount=function(){t.eventEmitter.on(n.UserEducationStateChannel,this.handleUpdate,this),t.UEClient.sendEvent(this.props.containerName+"."+this.props.name,n.UEEventType.Subscribe,{}),t.UEClient.sendEvent(this.props.containerName,this.props.name+".componentDidMount",{}),this._updateSize()},o.prototype.componentDidUpdate=function(){this._updateSize()},o.prototype._updateSize=function(){var e=r.findDOMNode(this.refs.container);if(e){var t=e.getBoundingClientRect();this.isRectEqual(t)||this.setState({rect:t})}this._requestOverlay()},o.prototype.isRectEqual=function(e){var t=this.state.rect;return t.top===e.top&&t.bottom===e.bottom&&t.left===e.left&&t.right===e.right&&t.width===e.width&&t.height===e.height},o.prototype._requestOverlay=function(){this.state.effect&&t.eventEmitter.emit(n.UserEducationEffectChannel,{requester:this.props.containerName+"."+this.props.name,rect:this.state.rect})},o.prototype.componentWillUnmount=function(){this.stopRectUpdateLoop(),t.eventEmitter.removeListener(n.UserEducationStateChannel,this.handleUpdate,this)},o.prototype.startRectUpdateLoop=function(){this._boundaryPoller?this._boundaryPoller.isRunning()||this._boundaryPoller.start():(this._boundaryPoller=new a(this._updateSize,l),this._boundaryPoller.start())},o.prototype.stopRectUpdateLoop=function(){this._boundaryPoller&&this._boundaryPoller.stop()},o.prototype.handleUpdate=function(e){if(e.state===n.UEEventType.ShowStep){var t=e.step.effect||null;if(t&&t.containerName===this.props.containerName&&t.elementName===this.props.name)return this.startRectUpdateLoop(),void this.setState({effect:t})}null!=this.state.effect&&(this.stopRectUpdateLoop(),this.setState({effect:null}))},o.prototype.render=function(){return this.props.useSpan?s.createElement("span",{ref:"container",className:"ue-effect-container"},this.props.children):s.createElement("div",{ref:"container",className:"ue-effect-container"},this.props.children)},o.displayName="UserEducationEffect",o}(s.Component);t.UserEducationEffect=u}),define("modules/clean/user_education/user_education_interface",["require","exports"],function(e,t){"use strict";var s="UE.event";t.UserEducationEventChannel=s;var r="UE.state";t.UserEducationStateChannel=r;var o="UE.effect";t.UserEducationEffectChannel=o;var n={Ready:"Ready",ShowStep:"ShowStep",Finished:"Finished",Subscribe:"Subscribe"};t.UEEventType=n;var i;!function(e){e[e.Spotlight=0]="Spotlight",e[e.Pulsar=1]="Pulsar"}(i||(i={})),t.UEEffectType=i;var a;!function(e){e[e.Small=1]="Small",e[e.Medium=2]="Medium",e[e.Large=3]="Large",e[e.XLarge=4]="XLarge"}(a||(a={})),t.UserEducationSpotlightSize=a;var l=24;t.UserEducationPulsarSize=l;var u;!function(e){e[e.Center=1]="Center",e[e.LeftCenter=2]="LeftCenter",e[e.RightCenter=3]="RightCenter"}(u||(u={})),t.UserEducationEffectPosition=u}),function(){define("modules/dirty/react/browse/browse",["jquery","external/immutable","external/react","external/underscore","external/classnames","modules/clean/account/email","modules/clean/browse_interface","modules/clean/contacts/bloodhound_contacts_v2","modules/clean/contacts/cache","modules/clean/contacts/data","modules/clean/em_string","modules/clean/flux/store_mixin","modules/clean/history","modules/clean/keycode","modules/clean/notserver","modules/clean/pagination_manager","modules/clean/react/app_actions_view","modules/clean/react/browse/api","modules/clean/react/browse/cdm_mve_work_usage_banner","modules/clean/react/browse/constants","modules/clean/react/browse/file_actions","modules/clean/react/browse/action_logger","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/css","modules/clean/react/file_modal_controller","modules/clean/react/file_uploader/uploader","modules/clean/react/file_uploader/store","modules/clean/react/maestro/top_menu_container","modules/clean/search/actions","modules/clean/search/search_bar","modules/clean/search/search_helpers","modules/clean/search/store","modules/clean/sharing/shared_content_link_sync_utils","modules/clean/sharing/share_modal_util","modules/clean/sharing/ui_util","modules/clean/user_education/user_education_client","modules/clean/viewer","modules/clean/web_timing_logger","modules/clean/zendesk_feedback","modules/clean/react/maestro/secondary_sidebar","modules/constants/comments_panel","modules/constants/contacts","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/react/browse/actions","modules/clean/react/browse/browse_location","modules/clean/react/browse/comment_status","modules/clean/react/browse/context_menu","modules/clean/react/browse/global_actions","modules/clean/react/browse/item_list","modules/clean/react/browse/selection_actions","modules/clean/react/browse/preview_sf_members","modules/clean/react/browse/pinned_team_folder","modules/clean/react/browse/shared_with","modules/clean/react/file_viewer/controller","modules/clean/search/search_results","modules/clean/require_wrapper"],function(e,t,s,r,o,n,i,a,l,u,p,d,c,h,m,f,_,g,b,v,y,S,w,T,D,E,I,P,N,C,F,M,R,A,x,O,L,k,U,B,H,q,G,W,V,z,j,Q,K,Y,X,Z,$,J,ee,te,se,re,oe,ne){var ie,ae,le,ue,pe,de,ce,he,me,fe,_e,ge,be,ve,ye,Se,we,Te,De,Ee,Ie,Pe,Ne,Ce,Fe,Me,Re,Ae,xe,Oe,Le,ke,Ue,Be,He,qe,Ge,We,Ve,ze,je,Qe,Ke,Ye,Xe,Ze;return Se=n.EmailVerification,ie=a.BloodhoundContactsV2,ve=l.DefaultContactsCache,ge=u.Contact,be=u.ContactTypes,Re=m.NotClients,ke=v.REACT_FILE_VIEWER_ELEMENT_ID,ye=v.DropTargetHighlightMode,De=v.FileTypes,Ce=v.LoadingStates,Me=v.NameSpaceAccess,Be=v.SEARCH_PREFIX,he=v.BrowseSortField,de=S.BrowseLogger,pe=S.BrowseLogEventSources,we=w.File,le=w.BrowseContext,xe=w.Paper,me=T.BrowseStore,Te=E.FileModalController,Ee=I.FileUploader,We=P.UploaderStore,Ge=P.UploadErrorType,Ae=N.PageletTopMenuContainer,Ye=x.showShareModal,Xe=x.showSharedContentLinkSyncModal,Pe=O.GoldenGate,qe=L.UEClient,Ke=B.showQualitativeFeedbackForm,Fe=H.MaestroSecondarySidebar,Ve=V._,Ze=V.ungettext,ue=X.BrowseContextMenu,Ie=Z.GlobalActions,Qe=Z.getGlobalActions,Ne=$.ItemListController,ce=J.BrowseSelectionMenu,Le=ee.PreviewSFMembersPanel,Oe=te.PinnedTeamFolder,He=se.SharedWithController,Ue=ne.RequireWrapper,je=s.DOM,ze=s.createElement,ae=s.createClass({displayName:"BrowseAppController",mixins:[d(me,We,R)],propTypes:{"init-data":s.PropTypes.object,"limited-team-banner-upsell":s.PropTypes.bool,"notify-path-does-not-exist":s.PropTypes.string,"notify-path-is-deleted":s.PropTypes.string,"share-link":s.PropTypes.bool,"share-prefill-email":s.PropTypes.string,"trademark-business":s.PropTypes.string,"email-just-verified":s.PropTypes.bool,"email-just-verified-and-changed":s.PropTypes.bool,"send-verification-email":s.PropTypes.bool,"show-qualitative-feedback-form":s.PropTypes.bool,"is-pagelet":s.PropTypes.bool,"account-photo-url":s.PropTypes.string,"exp-pro-out-of-quota-drag-drop-variant":s.PropTypes.string,"exp-biz-team-folder-onboarding-variant":s.PropTypes.string,"exp-oq-file-delete-upsell-variant":s.PropTypes.string},_get_state_from_stores:function(){var e;return e=me.path(),{context:me.context(),files:me.files(),filesWithoutTeamFolders:"/"===e?me.filesWithoutTeamFolders():t.List(),teamFolders:me.teamFolders(),loadingState:me.loadingState(),path:e,selection:me.selection(),selectedFiles:me.selectedFiles(),fileRename:me.fileRename(),user:me.user(),shouldShowDeletedFiles:me.shouldShowDeletedFiles(),isDraggingInternalFiles:We.numDraggingFiles()>0&&We.isInternalTransfer(),isDraggingExternalFiles:We.numDraggingFiles()>0&&!We.isInternalTransfer(),activeDropTarget:me.activeDropTarget(),isUploadModalOpen:We.isUploadModalOpen(),isTextSelectable:!!me.fileRename(),inCopyMode:me.inCopyMode(),createNewFolderState:me.newFolderCreationState(),isSearchMode:!!R.latestQuery(),currentSort:me.currentSort()}},_preloadLargeModules:function(){return Ue.require(["dropbox"])},componentWillMount:function(){var e,t,s,r,o,n,a,l,u,p,d,h,m,_,g,b,v,y,S,w;return me.startSpan(this.constructor.displayName),this.previousHistoryCallbackPath=null,this.hasLoadedFilesForTheVeryFirstTime=!1,e=this.props["is-pagelet"]?["ItemListController","AppActionsView"]:["ItemListController","BrowseSelectionMenu"],me.initTTIComponents(e),w=k.get_viewer().get_user_by_id(this.props["user-id"]),S=i.get_browse_root(w),_=this.props["init-fq-path"]||"/",g=Boolean(this.props["should-show-deleted-files"]),o=Boolean(this.props["search-query"]),o||this._setupFileEventListener(w.id),a=this.props["init-data"],a?(t=le.fromServerObject(a),p=Boolean(a.paginated)?Ce.LOADING_REMAINING_PAGES:Ce.LOADED,l=p===Ce.LOADING_REMAINING_PAGES,s=l?[]:a.file_info,d=a.ns_id_to_mount_point,r=this.props["select-fq-paths"],v=a.team_folders_js_info,Q.initializeEverything({user:w,path:_,files:s,urlPrefix:S,context:t,mountPoints:d,fqPathsToSelect:r,loadingState:p,shouldShowDeletedFiles:g,teamFolders:v}),l&&(m=new f,h=function(e,t){return Q.add({path:_,files:t}),e.areAllItemsReady()?(Q.setLoadingState({loadingState:Ce.LOADED,path:_}),e.stopAutoFetching()):void 0},m.initialize(a.first_page,"sjid","/browse_get_next",w.id,h),"undefined"!=typeof RUNNING_IN_REACTSERVER&&null!==RUNNING_IN_REACTSERVER||m.startAutoFetching())):(Q.setUrlPrefix({prefix:S}),Q.setUser({user:w}),Q.setShouldShowDeletedFiles({shouldShowDeletedFiles:g,shouldReloadFolder:!1}),r=this.props["select-fq-paths"],Q.setFilePathsToSelectOnNextUpdate({fqPathsToSelect:r}),this.hasTTVBeenLogged=!1,this.props["search-query"]||this.navigateToPath(_)),this.props["search-query"]||(u=this.props["share-link"],n=Boolean(this.props["preview-file-info"]),u||n||(y=this._getUrlForFQPath(_),this._sanitizeBrowserLocation(y))),b=!o,c.add_callback(S,this.handleFileLocationChange,!0),c.add_callback(Be,this.handleSearchLocationChange,b),c.add_exit_callback(Be,C.clearSearch),this.setState(this._get_state_from_stores())},componentDidMount:function(){var e,t,s,r,o,n,i,a,l,u,d;return me.endSpan(this.constructor.displayName),this.props["init-data"]&&(this.hasTTVBeenLogged||(U.mark_time_to_view(),this.hasTTVBeenLogged=!0,this._preloadLargeModules())),G.V2_SEARCH_ALLOWED[this.state.user.id]?ie.getOrCreateForUser(this.state.user):ve.load_contacts(),this._mountFileViewerTarget(),this.props["show-qualitative-feedback-form"]&&Ke(t=!0),d=this.props["show-share-modal"],i=this.props["preview-file-info"],Boolean(this.props["loaded-with-explicit-preview"])&&!i&&(l=c.deconstruct_url(),r=l.path,a=l.qargs,delete a.preview,c.replace_state(r,a)),i?(n=we.fromServerObject(i),Q.openPreviewForFile({file:n,onCloseViewer:this._restoreUrlAfterFileViewClose}),d&&(u=this.props["share-prefill-email"],u?(s="GRANT_ACCESS",o=[new ge({type:be.EMAIL,email:u})]):(s="DESKTOP_CLIENT",o=[]),Ye(this.state.user,n,{origin:s,prefillContacts:o}))):d&&this._showShareModal(this.state.path,this.state.user),null!=this.props["notify-path-is-deleted"]?(e=Ve("The folder ‘%(folder_name)s’ is deleted.").format({folder_name:p.em_snippet(this.props["notify-path-is-deleted"],15)}),z.error(e)):null!=this.props["notify-path-does-not-exist"]&&(e=Ve("The folder ‘%(folder_name)s’ doesn’t exist.").format({folder_name:p.em_snippet(this.props["notify-path-does-not-exist"],15)}),z.error(e)),this.props["email-just-verified"]?Se.getForRole(this.state.user.role).show_verified_modal():this.props["email-just-verified-and-changed"]?Se.getForRole(this.state.user.role).show_verified_and_changed_modal():this.props["send-verification-email"]&&Se.getForRole(this.state.user.role).show_sent_modal(),Y.setup()},handleComponentTTI:function(e){return me.componentReadyForTTI(e)},componentWillUpdate:function(e,t){return t.isSearchMode&&!this.state.isSearchMode?Re[this.state.user.id].unsubscribe(this.handlerId):!t.isSearchMode&&this.state.isSearchMode&&this._setupFileEventListener(this.state.user.id),t.files.equals(this.state.files)?void 0:setTimeout(function(e){return function(){return e.handleFileListUpdated()}}(this),0)},componentWillUnmount:function(){return Y.teardown()},_restoreUrlAfterFileViewClose:function(){var e,t;return t=this._getUrlForFQPath(this.state.path),Boolean(this.props["loaded-with-explicit-preview"])?(e=c.deconstruct_url().qargs,e=r.omit(e,"preview","select")):e={},c.replace_state(t,e)},_getUrlForFQPath:function(e){var t;return t="/"===e?"":j.encode_parts(e),me.urlPrefix()+t},_sanitizeBrowserLocation:function(e){var t,s;return t=c.deconstruct_url().qargs,s=r.pick(t,"d","select","preview"),c.replace_state(e,s)},_mountFileViewerTarget:function(){var e;return e=document.getElementById(ke),e?void 0:(e=document.createElement("div"),e.id=ke,document.body.insertBefore(e,document.body.children[0]))},_showShareModal:function(e,t){var s,r,o;return o=this.props["share-prefill-email"],o?(s="GRANT_ACCESS",r=[new ge({type:be.EMAIL,email:o})]):(s="DESKTOP_CLIENT",r=[]),Ye(t,{fqPath:this.props["init-fq-path"],isFolder:!0,nsId:this.props["ns-id"]&&this.props["ns-path"]?this.props["ns-id"]:null,origin:s,targetNsId:this.props["ns-id"]&&!this.props["ns-path"]?this.props["ns-id"]:null,prefillContacts:r})},_setupFileEventListener:function(e){var t,s;return t=Re[e],t.handler_failure(this.handlerId),null!=(s=this.getChangesRequest)&&s.abort(),this.handlerId=t.subscribe_sfj({name:"BrowseEventDispatcher",handler:function(s){return function(){var r;return r=s.state.path,s.getChangesRequest=g.getChangesForDirectory({path:r,userId:e,namespaceToJournalIdMap:t.get_ns_map(),includeDeletedFiles:s.state.shouldShowDeletedFiles,onSuccess:function(e){return s.getChangesRequest=null,Q.computeAndApplyDeltasFromNotServer({payload:e,path:r}),t.handler_success(s.handlerId,{ns_map:e.ns_map})}})}}(this)})},_ensureFileViewerIsOpenedOrClosedIfNeeded:function(e){var t,s;if(null==e&&(e={}),t=re.isShown(),e.preview&&!t){if(s=me.getFileByFilename(e.preview))return Q.navigateToFileOrFolder({file:s})}else if(t&&!e.preview)return Q.closeFileViewer()},handleFileLocationChange:function(e,t){return e="undefined"!=typeof RUNNING_IN_REACTSERVER&&null!==RUNNING_IN_REACTSERVER?this.props["init-fq-path"]||"/":"/"+j.decode(e),this._ensureFileViewerIsOpenedOrClosedIfNeeded(t),e!==this.previousHistoryCallbackPath?(this.previousHistoryCallbackPath=e,e!==me.path()?this.navigateToPath(e):void 0):void 0},handleSearchLocationChange:function(e,t){var s,r,o;if(t&&(s=t.query||t.query_unnormalized,e=t.path||t.last_fq_path||"/",s&&(e!==this.state.path||s!==R.latestQuery())))return o=null!=(r=this.state.user)?r:k.get_viewer().get_user_by_id(this.props["user-id"]),this.previousHistoryCallbackPath=e,e!==me.path()&&Q.setPath({path:e}),C.runSearch({user:o,path:e,query:s})},navigateToPath:function(e){var t;return t=function(e){return function(){return e.hasTTVBeenLogged?void 0:(U.mark_time_to_view(),e.hasTTIBeenLogged=!0,e._preloadLargeModules())}}(this),Q.setPath({path:e,onPathLoaded:t})},handleFileListUpdated:function(){var e,t;return re.isShown()?this.state.files.isEmpty()?Q.closeFileViewer():Q.updatePreview({files:this.state.files.toJS()}):(e=null!=(t=c.deconstruct_url())?t.qargs:void 0,this._ensureFileViewerIsOpenedOrClosedIfNeeded(e))},handleDelete:function(){var e,t;if(0!==this.state.selectedFiles.length)return e=Pe.canDeepNest(this.state.user.id)&&this.state.selectedFiles.toArray().some(function(e){return we.isTeamSharedFolder(e)}),this.state.context.isCurrentPathWriteable()&&!e?(t=this.state.selectedFiles.toArray(),Te.showDelete(this.state.user,t,this.state.context,function(){return Q.selectRowsFromNotServer(t)},this.props["exp-oq-file-delete-upsell-variant"])):e?z.error(Ve("Team folders can’t be deleted.")):z.warning(Ve("You don’t have permission to delete files in this folder."))},handleRestoreMulti:function(){return Te.showRestore(this.state.user,this.state.selectedFiles.toArray())},handlePermanentDelete:function(){var e;return e=function(){return Q.reloadCurrentPath()},Te.showPermanentlyDelete(this.state.user,this.state.selectedFiles.toArray(),e)},render:function(){var e,t;return e=this.props["sync-vars"],e.sync_user_role=this.state.user.role,t=r.extend({},{isMaestroDesign:this.props["is-pagelet"],syncVars:e,limitedTeamBannerUpsell:this.props["limited-team-banner-upsell"],trademarkBusiness:this.props["trademark-business"],shouldOpenUploadModal:this.props["should-open-upload-modal"],actionHandlers:{onDelete:this.handleDelete,onRestoreMulti:this.handleRestoreMulti,onPermanentDelete:this.handlePermanentDelete},handleComponentTTI:this.handleComponentTTI,expProDragDropOverquotaModal:this.props["exp-pro-out-of-quota-drag-drop-variant"],expBizTeamFolderOnboardingVariant:this.props["exp-biz-team-folder-onboarding-variant"]},this.state),ze(_e,t)}}),fe=s.createClass({displayName:"BrowseView",mixins:[s.addons.PureRenderMixin],propTypes:{context:s.PropTypes.instanceOf(le).isRequired,files:s.PropTypes.instanceOf(t.List).isRequired,filesWithoutTeamFolder:s.PropTypes.instanceOf(t.List),teamFolders:s.PropTypes.object,path:s.PropTypes.string.isRequired,shouldShowDeletedFiles:s.PropTypes.bool.isRequired,isUploadModalOpen:s.PropTypes.bool.isRequired,isTextSelectable:s.PropTypes.bool.isRequired,inCopyMode:s.PropTypes.bool.isRequired,user:s.PropTypes.object.isRequired,selection:s.PropTypes.object,loadingState:s.PropTypes.oneOf(r.values(Ce)),selectedFiles:s.PropTypes.instanceOf(t.OrderedSet),isDraggingInternalFiles:s.PropTypes.bool,isDraggingExternalFiles:s.PropTypes.bool,activeDropTarget:s.PropTypes.instanceOf(we),isSearchMode:s.PropTypes.bool,isMaestroDesign:s.PropTypes.bool,syncVars:s.PropTypes.object,limitedTeamBannerUpsell:s.PropTypes.bool,trademarkBusiness:s.PropTypes.string,actionHandlers:s.PropTypes.object,handleComponentTTI:s.PropTypes.func,expProDragDropOverquotaModal:s.PropTypes.string,expBizTeamFolderOnboardingVariant:s.PropTypes.string},getDefaultProps:function(){return{selectedFiles:t.OrderedSet(),selection:void 0}},getInitialState:function(){return{currentMultiColumnSortField:he.SHARED_WITH}},componentWillMount:function(){return me.startSpan(this.constructor.displayName)},componentDidMount:function(){return this._maybeRenderSyncFolderModal(),this._maybeOpenUploaderOnMount(),me.endSpan(this.constructor.displayName),qe.sendEvent(this.constructor.displayName,"componentDidMount",this.props.context.toJSON())},componentDidUpdate:function(){return this.props.isMaestroDesign&&this.props.loadingState===Ce.LOADED?qe.sendEvent(this.constructor.displayName,"componentDidUpdate",this.props.context.toJSON()):void 0},componentWillUnmount:function(){return this._unmountFileViewerTarget()},_maybeRenderSyncFolderModal:function(){var e;return(null!=(e=this.props.syncVars)?e.sync_ns_id:void 0)?A.showSharedContentSyncModal(this.props.syncVars):void 0},_maybeOpenUploaderOnMount:function(){return this.props.shouldOpenUploadModal?this.showFileUploader():void 0},_unmountFileViewerTarget:function(){var e;return e=document.getElementById(ke),e?document.body.removeChild(e):void 0},_getCurrentDropTargetHighlightMode:function(){var e;return!this.props.context.isInsideSharedFolder||(e=this.props.context.currentSharedFolderPermissionRole)!==Me.ACCESS_NO_ACCESS&&e!==Me.ACCESS_READER&&e!==Me.ACCESS_READER_NO_COMMENT?this.props.isDraggingInternalFiles?this.props.selectedFiles.count(function(e){return e.isDeleted})?ye.NONE:this.props.selectedFiles.count(function(e){return e.type===De.TEAM_SHARED_FOLDER})?ye.NONSELECTED_NONSHARED_NONTEAM_FOLDERS:this.props.selectedFiles.count(function(e){return e.type===De.SHARED_FOLDER})?ye.NONSELECTED_NONSHARED_FOLDERS:ye.NONSELECTED_FOLDERS:this.props.isDraggingExternalFiles&&!this.props.isUploadModalOpen?ye.ALL_FOLDERS:ye.NONE:ye.NONE},_getCurrentAppActionsProps:function(){var e,t,s,r,o;return r=this.props.selectedFiles.count(),o=r>0?Ze("%(count)d item selected","%(count)d items selected",r).format({count:r}):"",s=je.div({}),r>0?(e=y.getActionsForFileCollection({files:this.props.selectedFiles,context:this.props.context,user:this.props.user,skipSharing:!0,actionHandlers:this.props.actionHandlers,isMaestroDesign:this.props.isMaestroDesign,source:this.props.isMaestroDesign?pe.MAESTRO_RIGHT_SIDEBAR:pe.LEGACY_HEADER_ACTIONS}),1===r&&this.props.isMaestroDesign&&Pe.hasAudienceBox(this.props.user.id)&&(s=ze(He,{file:this.props.selectedFiles.toArray()[0],browseContext:this.props.context,tabIndex:-1,isInAudienceBox:!0,isMaestroDesign:this.props.isMaestroDesign}))):(e=Qe({context:this.props.context,user:this.props.user,showDeletedFiles:this.props.shouldShowDeletedFiles,onFileUpload:this.showFileUploader,isMaestroDesign:this.props.isMaestroDesign,isContextMenu:!1}),this.props.isMaestroDesign&&Pe.hasAudienceBox(this.props.user.id)&&(s=ze(He,{browseContext:this.props.context,tabIndex:-1,isInAudienceBox:!0,isMaestroDesign:this.props.isMaestroDesign}))),t=e.map(function(e,t){var s;return s={displayName:e.label,handleClick:e.performAction,disabled:e.disabled},t>0&&(s.iconName=e.spriteName),s}),{key:"maestro-app-actions",ref:"appActionsView",headerText:o,primaryMenuItem:t[0],primarySubnode:s,secondaryMenuItems:t.slice(1),handleComponentTTI:this.props.handleComponentTTI}},showFileUploader:function(){var e;return this.props.isMaestroDesign||this.refs.contextMenu.closeMenu(),null!=(e=this.refs.fileUploader)?e.showModal():void 0},openContextMenuAtPosition:function(e,t,s){return null==s&&(s=null),this.props.isMaestroDesign?void 0:this.refs.contextMenu.openMenuAtPosition(e,t,s)},handleSelectionChange:function(e){var t;return t=me.getFileByFullPath(e.selected.first()),t&&de.logSelectRow({uid:this.props.user.id,entity_type:t.is_dir?"folder":"file"}),Q.setSelection({selection:e})},handleFileListSortChange:function(e,t){return de.logSortRecords({uid:this.props.user.id,sort_by:e,sort_direction:t}),Q.sortFiles({sortField:e,direction:t})},handleKeyDown:function(e){var t,s;return t=null!=(s=e.which)?s:e.keyCode,this.props.isMaestroDesign&&t===h.A&&e.altKey?this.refs.appActionsView.getWrappedComponent().focusOnButton():void 0},_handleSearch:function(e){return e?Q.setUrl({prefix:Be,qargs:{path:me.path(),query:e}}):this._handleCancelSearch()},_handleCancelSearch:function(){return Q.setUrl({path:me.path()})},_handleSearchSuggestionOpen:function(e){return e instanceof we?e.is_unmounted?Xe(this.props.user,e):(M.logSearchAction(e,this.props.user,e.is_dir?"folder_open":"file_view","dropdown-view"),
Q.navigateToFileOrFolder({file:e})):e instanceof xe?W.open_tab(e.url):void 0},_shouldShowPinnedTeamFolder:function(){var e;return e=this.props.loadingState===Ce.LOADED,this.props.context.showPinnedTeamFolder&&null!=this.props.teamFolders.first()&&e},_renderSearchResults:function(e){return ze(oe,{path:this.props.path,user:this.props.user,topMenuItems:e,limitedTeamBannerUpsell:this.props.limitedTeamBannerUpsell,trademarkBusiness:this.props.trademarkBusiness,isMaestroDesign:this.props.isMaestroDesign,onFullSearch:function(e){var t;return e.preventDefault(),t={path:"/",query:R.latestQuery()},Q.setUrl({prefix:Be,qargs:t})}})},_handleAllFileUploadsComplete:function(e){var t,s,r;return t=e.find(function(e){return e.errorType===Ge.OVER_QUOTA_ERROR}),"V1"!==(s=this.props.expProDragDropOverquotaModal)&&"V2"!==s&&"V3"!==s||!t?void 0:null!=(r=this.refs.fileUploader)?r.showOOQVariantModal():void 0},render:function(){var e,t,s,r,n,i,a,l,u,p,d,c,h;return h=this.props.isMaestroDesign?ze(Ae,{user:this.props.user,viewer:k.get_viewer(),showSearchBar:!0,currentPath:this.props.path,onSearch:this._handleSearch,onCancelSearch:this._handleCancelSearch,onFileOrFolderOpen:this._handleSearchSuggestionOpen,limitedTeamBannerUpsell:this.props.limitedTeamBannerUpsell,trademarkBusiness:this.props.trademarkBusiness}):ze(F,{user:this.props.user,currentPath:this.props.path,isMaestroDesign:this.props.isMaestroDesign,isSearchActive:this.props.isSearchMode&&!this.props.isMaestroDesign,onSearch:this._handleSearch,onCancelSearch:this._handleCancelSearch,onFileOrFolderOpen:this._handleSearchSuggestionOpen,limitedTeamBannerUpsell:this.props.limitedTeamBannerUpsell,trademarkBusiness:this.props.trademarkBusiness}),this.props.isSearchMode?this._renderSearchResults(h):(p=this.props.loadingState!==Ce.LOADING_FIRST_PAGE&&!this.props.context.isInsideDeletedFolder,s=p&&this.props.context.isInFolderMode&&this.props.context.isInsideSharedFolder,t=p&&this.props.context.isInFolderMode&&"/"!==this.props.context.currentFQPath,e=p&&this.props.context.cdmMveQuotaStats&&"work"===this.props.user.role&&!this.props.context.isInsideSharedFolder,a=s&&!Pe.hasNewMembershipUI(this.props.user.id)&&!(this.props.isMaestroDesign&&Pe.hasAudienceBox(this.props.user.id)),i=t&&Pe.hasNewMembershipUI(this.props.user.id)&&!(this.props.isMaestroDesign&&Pe.hasAudienceBox(this.props.user.id)),u=a||i,n=this.props.context.showSharedFolderCreateTeamPromo,r={"browse-box":!0,list_view:!0,"file-browse":!0,"has-preview-sf-members":a,"has-preview-sf-members--golden-gate":i,"has-preview-sf-members--with-team-promo":s&&n,"has-pinned-team-folder":this._shouldShowPinnedTeamFolder(),"has-cdm-mve-banner":e},je.div({id:"browse-box",className:o(r),onKeyDown:this.handleKeyDown},je.header({},je.div({id:"browse-header",className:"browse-header"},je.div({id:"browse-global-actions-bar",className:"browse__global-actions clearfix u-mar-bottom-m"},ze(K,{path:this.props.path,user:this.props.user,selectedFiles:this.props.selectedFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,shouldHighlightDropTargets:this.props.isDraggingInternalFiles||this.props.isDraggingExternalFiles&&!this.props.isUploadModalOpen}),h,je.div({id:"browse-rightmenu",className:"u-l-fr"},l=null!=this.props.context.currentFQPath,this.props.user&&l?[ze(Ee,{ref:"fileUploader",key:1,expProDragDropOverquotaModal:this.props.expProDragDropOverquotaModal,onAllFileUploadsComplete:this._handleAllFileUploadsComplete})]:void 0,!this.props.isMaestroDesign&&this.props.user&&l?[ze(Ie,{shouldShowDeletedFiles:this.props.shouldShowDeletedFiles,isActionsBarDisabled:this.props.loadingState===Ce.LOADING_FIRST_PAGE,context:this.props.context,user:this.props.user,onFileUpload:this.showFileUploader,key:0})]:void 0)),u?ze(Le,{context:this.props.context,user:this.props.user,isMaestroDesign:this.props.isMaestroDesign}):void 0,e?je.div({className:"browse-cdm-quota-stats"},ze(b,{userQuota:this.props.context.cdmMveQuotaStats})):void 0,this._shouldShowPinnedTeamFolder()?ze(Oe,{teamFolder:this.props.teamFolders.first(),context:this.props.context,user:this.props.user,selection:this.props.selection,loadingState:this.props.loadingState,activeDropTarget:this.props.activeDropTarget,dropTargetHighlightMode:this._getCurrentDropTargetHighlightMode(),isDraggingInternalFiles:this.props.isDraggingInternalFiles,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isTextSelectable:this.props.isTextSelectable,isPagelet:this.props.isPagelet}):void 0)),je.main({},this.props.isMaestroDesign?void 0:[ze(ce,{onActionButtonClick:function(e){return function(){return e.refs.itemListController.getWrappedComponent().focusSelectedRow()}}(this),selectedFiles:this.props.selectedFiles,user:this.props.user,context:this.props.context,actionHandlers:this.props.actionHandlers,handleComponentTTI:this.props.handleComponentTTI,key:"browse-selection-menu"})],ze(Ne,{ref:"itemListController",items:this.props.context.showPinnedTeamFolder?this.props.filesWithoutTeamFolders:this.props.files,selection:this.props.selection,selectedFiles:this.props.selectedFiles,onSelectionChange:this.handleSelectionChange,fileRename:this.props.fileRename,user:this.props.user,path:this.props.path,context:this.props.context,loadingState:this.props.loadingState,isTextSelectable:this.props.isTextSelectable,shouldShowDeletedFiles:this.props.shouldShowDeletedFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isMaestroDesign:this.props.isMaestroDesign,activeDropTarget:this.props.activeDropTarget,dropTargetHighlightMode:this._getCurrentDropTargetHighlightMode(),createNewFolderState:this.props.createNewFolderState,openContextMenuAtPosition:this.openContextMenuAtPosition,activeSortField:null!=(d=this.props.currentSort)?d.sortField:void 0,activeSortDirection:null!=(c=this.props.currentSort)?c.direction:void 0,onSortChange:this.handleFileListSortChange,initialMultiColumnSortField:this.state.currentMultiColumnSortField,actionHandlers:this.props.actionHandlers,handleComponentTTI:this.props.handleComponentTTI,expBizTeamFolderOnboardingVariant:this.props.expBizTeamFolderOnboardingVariant}),this.props.isMaestroDesign?void 0:ze(ue,{user:this.props.user,selectedFiles:this.props.selectedFiles,context:this.props.context,shouldShowDeletedFiles:this.props.shouldShowDeletedFiles,onFileUpload:this.showFileUploader,actionHandlers:this.props.actionHandlers,ref:"contextMenu"}),this.props.isMaestroDesign?ze(Fe,{},ze(_,this._getCurrentAppActionsProps())):void 0)))}}),_e=D(fe,["/static/css/browse/browse-vflc_FrK9.css"]),{BrowseApp:ae,BrowseView:fe}})}.call(this),function(){define("modules/dirty/sharing/sharing_model_modals",["jquery","modules/clean/analytics","modules/clean/require_wrapper"],function(e,t,s){var r;return r=s.RequireWrapper,{initialize_module:function(s){return t.LegacySharingVortexLogger.log("initialize-sharing-model-modals"),r.require(["dropbox"],function(t){var r,o;return o=t.SharingModel,r=t.Modal,s.instances.forEach(function(t){return e("#"+t.accept_button_dom_id).on("click",function(e){return o.do_remove(r.vars)}),e("#"+t.cancel_button_dom_id).on("click",function(e){return r.hide()})})})}}})}.call(this);
//# sourceMappingURL=pkg-ag.min.js-vflh-WyFo.map